import{A as Qo,a as vh,N as Vl,L as un,F as gt,S as Ee,b as te,B as dn,c as Te,C as oe,d as to,T as bh,e as so,f as ql,g as Xs,h as Th,P as Kl,D as zl,M as Ge,i as ze,V as Re,j as Ve,k as F,I as Mh,l as Rh,O as hs,m as Yl,n as Dh,o as _h,p as ae,q as ms,R as mt,r as Lh,s as Gi,t as Fh,u as ji,v as ft,w as ti,x as Nh,y as Ae,z as kh,E as io,G as Uh,H as Gh,J as Oi,K as si,Q as Xi,U as gn,W as Oh,X as Ph,Y as Hh,Z as So,_ as Is,$ as Es,a0 as fn,a1 as pn,a2 as mn,a3 as Me,a4 as In,a5 as Jl,a6 as xo,a7 as $h,a8 as Oe,a9 as Ho,aa as $o,ab as Vo,ac as Rt,ad as vo,ae as Vh,af as qh,ag as Be,ah as Kh,ai as Zs,aj as Qe,ak as Wl,al as zh,am as Yh,an as Jh,ao as Wh,ap as jh,aq as Xh,ar as Zh,as as eu,at as $e,au as ye,av as jl,aw as tu,ax as su,ay as iu,az as Zi,aA as $s,aB as Vs,aC as qo,aD as En,aE as Cs,aF as us,aG as nu,aH as It,aI as bo,aJ as Xl,aK as ru,aL as ou,aM as au,aN as Zl,aO as Au,aP as Cn,aQ as Pi,aR as To,aS as ec,aT as ii,aU as en,aV as lu,aW as cu,aX as hu,aY as uu,aZ as du,a_ as Ko,a$ as tc,b0 as gu,b1 as ci,b2 as Mo,b3 as fu,b4 as zo,b5 as pu,b6 as mu,b7 as Iu,b8 as sc,b9 as Eu,ba as Cu,bb as Bu,bc as ic,bd as nc,be as yu}from"./three-gVxoFSaK.js";/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const wu=(o,e)=>e.kind==="method"&&e.descriptor&&!("value"in e.descriptor)?{...e,finisher(t){t.createProperty(e.key,o)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){typeof e.initializer=="function"&&(this[e.key]=e.initializer.call(this))},finisher(t){t.createProperty(e.key,o)}},Qu=(o,e,t)=>{e.constructor.createProperty(t,o)};function k(o){return(e,t)=>t!==void 0?Qu(o,e,t):wu(o,e)}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Tn;((Tn=window.HTMLSlotElement)===null||Tn===void 0?void 0:Tn.prototype.assignedElements)!=null;/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Hi=window,Ro=Hi.ShadowRoot&&(Hi.ShadyCSS===void 0||Hi.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,rc=Symbol(),Yo=new WeakMap;let Su=class{constructor(e,t,s){if(this._$cssResult$=!0,s!==rc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Ro&&e===void 0){const s=t!==void 0&&t.length===1;s&&(e=Yo.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&Yo.set(t,e))}return e}toString(){return this.cssText}};const xu=o=>new Su(typeof o=="string"?o:o+"",void 0,rc),vu=(o,e)=>{Ro?o.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet):e.forEach(t=>{const s=document.createElement("style"),i=Hi.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=t.cssText,o.appendChild(s)})},Jo=Ro?o=>o:o=>o instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return xu(t)})(o):o;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Mn;const tn=window,Wo=tn.trustedTypes,bu=Wo?Wo.emptyScript:"",jo=tn.reactiveElementPolyfillSupport,no={toAttribute(o,e){switch(e){case Boolean:o=o?bu:null;break;case Object:case Array:o=o==null?o:JSON.stringify(o)}return o},fromAttribute(o,e){let t=o;switch(e){case Boolean:t=o!==null;break;case Number:t=o===null?null:Number(o);break;case Object:case Array:try{t=JSON.parse(o)}catch{t=null}}return t}},oc=(o,e)=>e!==o&&(e==e||o==o),Rn={attribute:!0,type:String,converter:no,reflect:!1,hasChanged:oc},ro="finalized";let Dt=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(e){var t;this.finalize(),((t=this.h)!==null&&t!==void 0?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach((t,s)=>{const i=this._$Ep(s,t);i!==void 0&&(this._$Ev.set(i,s),e.push(i))}),e}static createProperty(e,t=Rn){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const s=typeof e=="symbol"?Symbol():"__"+e,i=this.getPropertyDescriptor(e,s,t);i!==void 0&&Object.defineProperty(this.prototype,e,i)}}static getPropertyDescriptor(e,t,s){return{get(){return this[t]},set(i){const n=this[e];this[t]=i,this.requestUpdate(e,n,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Rn}static finalize(){if(this.hasOwnProperty(ro))return!1;this[ro]=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),e.h!==void 0&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,s=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const i of s)this.createProperty(i,t[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const i of s)t.unshift(Jo(i))}else e!==void 0&&t.push(Jo(e));return t}static _$Ep(e,t){const s=t.attribute;return s===!1?void 0:typeof s=="string"?s:typeof e=="string"?e.toLowerCase():void 0}_$Eu(){var e;this._$E_=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(e=this.constructor.h)===null||e===void 0||e.forEach(t=>t(this))}addController(e){var t,s;((t=this._$ES)!==null&&t!==void 0?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((s=e.hostConnected)===null||s===void 0||s.call(e))}removeController(e){var t;(t=this._$ES)===null||t===void 0||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])})}createRenderRoot(){var e;const t=(e=this.shadowRoot)!==null&&e!==void 0?e:this.attachShadow(this.constructor.shadowRootOptions);return vu(t,this.constructor.elementStyles),t}connectedCallback(){var e;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)===null||e===void 0||e.forEach(t=>{var s;return(s=t.hostConnected)===null||s===void 0?void 0:s.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)===null||e===void 0||e.forEach(t=>{var s;return(s=t.hostDisconnected)===null||s===void 0?void 0:s.call(t)})}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$EO(e,t,s=Rn){var i;const n=this.constructor._$Ep(e,s);if(n!==void 0&&s.reflect===!0){const r=(((i=s.converter)===null||i===void 0?void 0:i.toAttribute)!==void 0?s.converter:no).toAttribute(t,s.type);this._$El=e,r==null?this.removeAttribute(n):this.setAttribute(n,r),this._$El=null}}_$AK(e,t){var s;const i=this.constructor,n=i._$Ev.get(e);if(n!==void 0&&this._$El!==n){const r=i.getPropertyOptions(n),a=typeof r.converter=="function"?{fromAttribute:r.converter}:((s=r.converter)===null||s===void 0?void 0:s.fromAttribute)!==void 0?r.converter:no;this._$El=n,this[n]=a.fromAttribute(t,r.type),this._$El=null}}requestUpdate(e,t,s){let i=!0;e!==void 0&&(((s=s||this.constructor.getPropertyOptions(e)).hasChanged||oc)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),s.reflect===!0&&this._$El!==e&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(e,s))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((i,n)=>this[n]=i),this._$Ei=void 0);let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),(e=this._$ES)===null||e===void 0||e.forEach(i=>{var n;return(n=i.hostUpdate)===null||n===void 0?void 0:n.call(i)}),this.update(s)):this._$Ek()}catch(i){throw t=!1,this._$Ek(),i}t&&this._$AE(s)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)===null||t===void 0||t.forEach(s=>{var i;return(i=s.hostUpdated)===null||i===void 0?void 0:i.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){this._$EC!==void 0&&(this._$EC.forEach((t,s)=>this._$EO(s,this[s],t)),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}};Dt[ro]=!0,Dt.elementProperties=new Map,Dt.elementStyles=[],Dt.shadowRootOptions={mode:"open"},jo==null||jo({ReactiveElement:Dt}),((Mn=tn.reactiveElementVersions)!==null&&Mn!==void 0?Mn:tn.reactiveElementVersions=[]).push("1.6.3");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Dn;const sn=window,ds=sn.trustedTypes,Xo=ds?ds.createPolicy("lit-html",{createHTML:o=>o}):void 0,oo="$lit$",ct=`lit$${(Math.random()+"").slice(9)}$`,ac="?"+ct,Tu=`<${ac}>`,Lt=document,ni=()=>Lt.createComment(""),ri=o=>o===null||typeof o!="object"&&typeof o!="function",Ac=Array.isArray,Mu=o=>Ac(o)||typeof(o==null?void 0:o[Symbol.iterator])=="function",_n=`[ 	
\f\r]`,ys=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Zo=/-->/g,ea=/>/g,Ct=RegExp(`>|${_n}(?:([^\\s"'>=/]+)(${_n}*=${_n}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),ta=/'/g,sa=/"/g,lc=/^(?:script|style|textarea|title)$/i,Ru=o=>(e,...t)=>({_$litType$:o,strings:e,values:t}),Bn=Ru(1),gs=Symbol.for("lit-noChange"),ie=Symbol.for("lit-nothing"),ia=new WeakMap,_t=Lt.createTreeWalker(Lt,129,null,!1);function cc(o,e){if(!Array.isArray(o)||!o.hasOwnProperty("raw"))throw Error("invalid template strings array");return Xo!==void 0?Xo.createHTML(e):e}const Du=(o,e)=>{const t=o.length-1,s=[];let i,n=e===2?"<svg>":"",r=ys;for(let a=0;a<t;a++){const A=o[a];let l,h,c=-1,u=0;for(;u<A.length&&(r.lastIndex=u,h=r.exec(A),h!==null);)u=r.lastIndex,r===ys?h[1]==="!--"?r=Zo:h[1]!==void 0?r=ea:h[2]!==void 0?(lc.test(h[2])&&(i=RegExp("</"+h[2],"g")),r=Ct):h[3]!==void 0&&(r=Ct):r===Ct?h[0]===">"?(r=i??ys,c=-1):h[1]===void 0?c=-2:(c=r.lastIndex-h[2].length,l=h[1],r=h[3]===void 0?Ct:h[3]==='"'?sa:ta):r===sa||r===ta?r=Ct:r===Zo||r===ea?r=ys:(r=Ct,i=void 0);const d=r===Ct&&o[a+1].startsWith("/>")?" ":"";n+=r===ys?A+Tu:c>=0?(s.push(l),A.slice(0,c)+oo+A.slice(c)+ct+d):A+ct+(c===-2?(s.push(void 0),a):d)}return[cc(o,n+(o[t]||"<?>")+(e===2?"</svg>":"")),s]};class oi{constructor({strings:e,_$litType$:t},s){let i;this.parts=[];let n=0,r=0;const a=e.length-1,A=this.parts,[l,h]=Du(e,t);if(this.el=oi.createElement(l,s),_t.currentNode=this.el.content,t===2){const c=this.el.content,u=c.firstChild;u.remove(),c.append(...u.childNodes)}for(;(i=_t.nextNode())!==null&&A.length<a;){if(i.nodeType===1){if(i.hasAttributes()){const c=[];for(const u of i.getAttributeNames())if(u.endsWith(oo)||u.startsWith(ct)){const d=h[r++];if(c.push(u),d!==void 0){const g=i.getAttribute(d.toLowerCase()+oo).split(ct),f=/([.?@])?(.*)/.exec(d);A.push({type:1,index:n,name:f[2],strings:g,ctor:f[1]==="."?Lu:f[1]==="?"?Nu:f[1]==="@"?ku:yn})}else A.push({type:6,index:n})}for(const u of c)i.removeAttribute(u)}if(lc.test(i.tagName)){const c=i.textContent.split(ct),u=c.length-1;if(u>0){i.textContent=ds?ds.emptyScript:"";for(let d=0;d<u;d++)i.append(c[d],ni()),_t.nextNode(),A.push({type:2,index:++n});i.append(c[u],ni())}}}else if(i.nodeType===8)if(i.data===ac)A.push({type:2,index:n});else{let c=-1;for(;(c=i.data.indexOf(ct,c+1))!==-1;)A.push({type:7,index:n}),c+=ct.length-1}n++}}static createElement(e,t){const s=Lt.createElement("template");return s.innerHTML=e,s}}function fs(o,e,t=o,s){var i,n,r,a;if(e===gs)return e;let A=s!==void 0?(i=t._$Co)===null||i===void 0?void 0:i[s]:t._$Cl;const l=ri(e)?void 0:e._$litDirective$;return(A==null?void 0:A.constructor)!==l&&((n=A==null?void 0:A._$AO)===null||n===void 0||n.call(A,!1),l===void 0?A=void 0:(A=new l(o),A._$AT(o,t,s)),s!==void 0?((r=(a=t)._$Co)!==null&&r!==void 0?r:a._$Co=[])[s]=A:t._$Cl=A),A!==void 0&&(e=fs(o,A._$AS(o,e.values),A,s)),e}class _u{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:s},parts:i}=this._$AD,n=((t=e==null?void 0:e.creationScope)!==null&&t!==void 0?t:Lt).importNode(s,!0);_t.currentNode=n;let r=_t.nextNode(),a=0,A=0,l=i[0];for(;l!==void 0;){if(a===l.index){let h;l.type===2?h=new Do(r,r.nextSibling,this,e):l.type===1?h=new l.ctor(r,l.name,l.strings,this,e):l.type===6&&(h=new Uu(r,this,e)),this._$AV.push(h),l=i[++A]}a!==(l==null?void 0:l.index)&&(r=_t.nextNode(),a++)}return _t.currentNode=Lt,n}v(e){let t=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}let Do=class hc{constructor(e,t,s,i){var n;this.type=2,this._$AH=ie,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=i,this._$Cp=(n=i==null?void 0:i.isConnected)===null||n===void 0||n}get _$AU(){var e,t;return(t=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&t!==void 0?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=fs(this,e,t),ri(e)?e===ie||e==null||e===""?(this._$AH!==ie&&this._$AR(),this._$AH=ie):e!==this._$AH&&e!==gs&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):Mu(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==ie&&ri(this._$AH)?this._$AA.nextSibling.data=e:this.$(Lt.createTextNode(e)),this._$AH=e}g(e){var t;const{values:s,_$litType$:i}=e,n=typeof i=="number"?this._$AC(e):(i.el===void 0&&(i.el=oi.createElement(cc(i.h,i.h[0]),this.options)),i);if(((t=this._$AH)===null||t===void 0?void 0:t._$AD)===n)this._$AH.v(s);else{const r=new _u(n,this),a=r.u(this.options);r.v(s),this.$(a),this._$AH=r}}_$AC(e){let t=ia.get(e.strings);return t===void 0&&ia.set(e.strings,t=new oi(e)),t}T(e){Ac(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,i=0;for(const n of e)i===t.length?t.push(s=new hc(this.k(ni()),this.k(ni()),this,this.options)):s=t[i],s._$AI(n),i++;i<t.length&&(this._$AR(s&&s._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var s;for((s=this._$AP)===null||s===void 0||s.call(this,!1,!0,t);e&&e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cp=e,(t=this._$AP)===null||t===void 0||t.call(this,e))}};class yn{constructor(e,t,s,i,n){this.type=1,this._$AH=ie,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=n,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=ie}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,s,i){const n=this.strings;let r=!1;if(n===void 0)e=fs(this,e,t,0),r=!ri(e)||e!==this._$AH&&e!==gs,r&&(this._$AH=e);else{const a=e;let A,l;for(e=n[0],A=0;A<n.length-1;A++)l=fs(this,a[s+A],t,A),l===gs&&(l=this._$AH[A]),r||(r=!ri(l)||l!==this._$AH[A]),l===ie?e=ie:e!==ie&&(e+=(l??"")+n[A+1]),this._$AH[A]=l}r&&!i&&this.j(e)}j(e){e===ie?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Lu extends yn{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===ie?void 0:e}}const Fu=ds?ds.emptyScript:"";class Nu extends yn{constructor(){super(...arguments),this.type=4}j(e){e&&e!==ie?this.element.setAttribute(this.name,Fu):this.element.removeAttribute(this.name)}}class ku extends yn{constructor(e,t,s,i,n){super(e,t,s,i,n),this.type=5}_$AI(e,t=this){var s;if((e=(s=fs(this,e,t,0))!==null&&s!==void 0?s:ie)===gs)return;const i=this._$AH,n=e===ie&&i!==ie||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,r=e!==ie&&(i===ie||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,s;typeof this._$AH=="function"?this._$AH.call((s=(t=this.options)===null||t===void 0?void 0:t.host)!==null&&s!==void 0?s:this.element,e):this._$AH.handleEvent(e)}}class Uu{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){fs(this,e)}}const na=sn.litHtmlPolyfillSupport;na==null||na(oi,Do),((Dn=sn.litHtmlVersions)!==null&&Dn!==void 0?Dn:sn.litHtmlVersions=[]).push("2.8.0");const uc=(o,e,t)=>{var s,i;const n=(s=t==null?void 0:t.renderBefore)!==null&&s!==void 0?s:e;let r=n._$litPart$;if(r===void 0){const a=(i=t==null?void 0:t.renderBefore)!==null&&i!==void 0?i:null;n._$litPart$=r=new Do(e.insertBefore(ni(),a),a,void 0,t??{})}return r._$AI(o),r};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Ln,Fn;class $i extends Dt{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const s=super.createRenderRoot();return(e=(t=this.renderOptions).renderBefore)!==null&&e!==void 0||(t.renderBefore=s.firstChild),s}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=uc(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!1)}render(){return gs}}$i.finalized=!0,$i._$litElement$=!0,(Ln=globalThis.litElementHydrateSupport)===null||Ln===void 0||Ln.call(globalThis,{LitElement:$i});const ra=globalThis.litElementPolyfillSupport;ra==null||ra({LitElement:$i});((Fn=globalThis.litElementVersions)!==null&&Fn!==void 0?Fn:globalThis.litElementVersions=[]).push("3.3.3");/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dc=navigator.xr!=null&&self.XRSession!=null&&navigator.xr.isSessionSupported!=null,gc=dc&&self.XRSession.prototype.requestHitTestSource!=null,Nn=self.ResizeObserver!=null,kn=self.IntersectionObserver!=null,fc=gc;(()=>{const o=navigator.userAgent||navigator.vendor||self.opera;let e=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(o)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(o.substr(0,4)))&&(e=!0),e})();const Gu=/android/i.test(navigator.userAgent),Ou=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,Pu=/firefox/i.test(navigator.userAgent),Hu=/OculusBrowser/.test(navigator.userAgent),$u=Gu&&!Pu&&!Hu,Vu=!!(window.webkit&&window.webkit.messageHandlers),oa=(()=>{if(Ou){if(Vu)return!!/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent);{const o=document.createElement("a");return!!(o.relList&&o.relList.supports&&o.relList.supports("ar"))}}else return!1})();/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pc=o=>o&&o!=="null"?qu(o):null,aa=()=>{if(fc)return;const o=[];throw dc||o.push("WebXR Device API"),gc||o.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${o.join(", ")}`)},qu=o=>new URL(o,window.location.toString()).toString(),Ku=(o,e)=>{let t=null;const s=(...i)=>{t==null&&(o(...i),t=self.setTimeout(()=>t=null,e))};return s.flush=()=>{t!=null&&(self.clearTimeout(t),t=null)},s},Aa=(o,e)=>{let t=null;return(...s)=>{t!=null&&self.clearTimeout(t),t=self.setTimeout(()=>{t=null,o(...s)},e)}},Ue=(o,e,t)=>Math.max(e,Math.min(t,o)),la=(()=>{const o="model-viewer-debug-mode",e=new RegExp(`[?&]${o}(&|$)`);return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(e)})(),zu=(o=0)=>new Promise(e=>setTimeout(e,o)),Yu=(o,e,t=null)=>new Promise(s=>{function i(n){(!t||t(n))&&(s(n),o.removeEventListener(e,i))}o.addEventListener(e,i)});/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bt=function(o,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(o,e,t,s);else for(var a=o.length-1;a>=0;a--)(r=o[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const Ju=.5,Wu=0,ju=1,Xu=1,qs=Symbol("currentEnvironmentMap"),Ks=Symbol("currentBackground"),nn=Symbol("updateEnvironment"),hi=Symbol("cancelEnvironmentUpdate"),Zu=o=>{var e,t,s;class i extends o{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=Wu,this.shadowSoftness=ju,this.exposure=Xu,this.toneMapping="auto",this.skyboxHeight="0",this[e]=null,this[t]=null,this[s]=null}updated(r){super.updated(r),r.has("shadowIntensity")&&(this[x].setShadowIntensity(this.shadowIntensity*Ju),this[ue]()),r.has("shadowSoftness")&&(this[x].setShadowSoftness(this.shadowSoftness),this[ue]()),r.has("exposure")&&(this[x].exposure=this.exposure,this[ue]()),r.has("toneMapping")&&(this[x].toneMapping=this.toneMapping==="aces"?Qo:this.toneMapping==="agx"?vh:Vl,this[ue]()),(r.has("environmentImage")||r.has("skyboxImage"))&&this[ps]()&&this[nn](),r.has("skyboxHeight")&&(this[x].setGroundedSkybox(),this[ue]())}hasBakedShadow(){return this[x].bakedShadows.size>0}async[(e=qs,t=Ks,s=hi,nn)](){const{skyboxImage:r,environmentImage:a}=this;this[hi]!=null&&(this[hi](),this[hi]=null);const{textureUtils:A}=this[Y];if(A==null)return;const l=this[Ft].beginActivity("environment-update");try{const{environmentMap:h,skybox:c}=await A.generateEnvironmentMapAndSkybox(pc(r),a,u=>l(Ue(u,0,1)),this.withCredentials);this[qs]!==h&&(this[qs]=h,this.dispatchEvent(new CustomEvent("environment-change"))),c!=null?this[Ks]=c.name===h.name?h:c:this[Ks]=null,this[x].setEnvironmentAndSkybox(this[qs],this[Ks])}catch(h){if(h instanceof Error)throw this[x].setEnvironmentAndSkybox(null,null),h}finally{l(1)}}}return Bt([k({type:String,attribute:"environment-image"})],i.prototype,"environmentImage",void 0),Bt([k({type:String,attribute:"skybox-image"})],i.prototype,"skyboxImage",void 0),Bt([k({type:Number,attribute:"shadow-intensity"})],i.prototype,"shadowIntensity",void 0),Bt([k({type:Number,attribute:"shadow-softness"})],i.prototype,"shadowSoftness",void 0),Bt([k({type:Number})],i.prototype,"exposure",void 0),Bt([k({type:String,attribute:"tone-mapping"})],i.prototype,"toneMapping",void 0),Bt([k({type:String,attribute:"skybox-height"})],i.prototype,"skyboxHeight",void 0),i};/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ed=Bn`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`;/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const td=Bn`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`;/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sd=Bn`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`;/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const id=Bn`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

.container {
  position: relative;
  overflow: hidden;
}

.userInput {
  width: 100%;
  height: 100%;
  display: none;
  position: relative;
  outline-offset: -1px;
  outline-width: 1px;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  left: 0;
  top: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
  pointer-events: none;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  display: none;
  background-color: inherit;
}

.slot.poster.show {
  display: inherit;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: #fff0;
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.centered {
  align-items: center;
  justify-content: center;
}

.cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  overflow: hidden;
  opacity: 0;
  will-change: opacity;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.animated-container {
  will-change: transform, opacity;
  opacity: 0;
  transition: opacity 0.3s;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.pan-target {
  display: block;
  position: absolute;
  width: 0;
  height: 0;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  background-color: transparent;
  opacity: 0;
  transition: opacity 0.3s;
}

#default-pan-target {
  width: 6px;
  height: 6px;
  border-radius: 6px;
  border: 1px solid white;
  box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: env(safe-area-inset-top, 16px);
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>

  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Loading 3D model"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          role="button"
          href="javascript:void(0);"
          aria-label="View in your space">
        ${sd}
      </a>
    </slot>
  </div>

  <div class="slot pan-target">
    <slot name="pan-target">
      <div id="default-pan-target">
      </div>
    </slot>
  </div>

  <div class="slot interaction-prompt cover centered">
    <div id="prompt" class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${td}
      </slot>
    </div>
  </div>

  <div id="finger0" class="animated-container cover">
    <slot name="finger0" aria-hidden="true">
    </slot>
  </div>
  <div id="finger1" class="animated-container cover">
    <slot name="finger1" aria-hidden="true">
    </slot>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>

    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${ed}
        </a>
      </slot>
    </div>
  </div>
</div>
<div class="screen-reader-only" role="region" aria-label="Live announcements">
  <span id="status" role="status"></span>
</div>`,nd=o=>{uc(id,o)},Un=new WeakMap;class rd extends un{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,s,i){const n=new gt(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,r=>{this.parse(r,t,i)},s,i)}parse(e,t,s=()=>{}){this.decodeDracoFile(e,t,null,null,Ee,s).catch(s)}decodeDracoFile(e,t,s,i,n=te,r=()=>{}){const a={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:n};return this.decodeGeometry(e,a).then(t).catch(r)}decodeGeometry(e,t){const s=JSON.stringify(t);if(Un.has(e)){const A=Un.get(e);if(A.key===s)return A.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const n=this.workerNextTaskID++,r=e.byteLength,a=this._getWorker(n,r).then(A=>(i=A,new Promise((l,h)=>{i._callbacks[n]={resolve:l,reject:h},i.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(A=>this._createGeometry(A.geometry));return a.catch(()=>!0).then(()=>{i&&n&&this._releaseTask(i,n)}),Un.set(e,{key:s,promise:a}),a}_createGeometry(e){const t=new dn;e.index&&t.setIndex(new Te(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const i=e.attributes[s],n=i.name,r=i.array,a=i.itemSize,A=new Te(r,a);n==="color"&&(this._assignVertexColorSpace(A,i.vertexColorSpace),A.normalized=!(r instanceof Float32Array)),t.setAttribute(n,A)}return t}_assignVertexColorSpace(e,t){if(t!==Ee)return;const s=new oe;for(let i=0,n=e.count;i<n;i++)s.fromBufferAttribute(e,i),to.toWorkingColorSpace(s,Ee),e.setXYZ(i,s.r,s.g,s.b)}_loadLibrary(e,t){const s=new gt(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise((i,n)=>{s.load(e,i,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(s=>{const i=s[0];e||(this.decoderConfig.wasmBinary=s[1]);const n=od.toString(),r=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(n){const r=n.data;switch(r.type){case"decode":i._callbacks[r.id].resolve(r);break;case"error":i._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,n){return i._taskLoad>n._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=t,s._taskLoad+=t,s})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function od(){let o,e;onmessage=function(r){const a=r.data;switch(a.type){case"init":o=a.decoderConfig,e=new Promise(function(h){o.onModuleLoaded=function(c){h({draco:c})},DracoDecoderModule(o)});break;case"decode":const A=a.buffer,l=a.taskConfig;e.then(h=>{const c=h.draco,u=new c.Decoder;try{const d=t(c,u,new Int8Array(A),l),g=d.attributes.map(f=>f.array.buffer);d.index&&g.push(d.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:d},g)}catch(d){console.error(d),self.postMessage({type:"error",id:a.id,error:d.message})}finally{c.destroy(u)}});break}};function t(r,a,A,l){const h=l.attributeIDs,c=l.attributeTypes;let u,d;const g=a.GetEncodedGeometryType(A);if(g===r.TRIANGULAR_MESH)u=new r.Mesh,d=a.DecodeArrayToMesh(A,A.byteLength,u);else if(g===r.POINT_CLOUD)u=new r.PointCloud,d=a.DecodeArrayToPointCloud(A,A.byteLength,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!d.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const f={index:null,attributes:[]};for(const p in h){const I=self[c[p]];let C,w;if(l.useUniqueIDs)w=h[p],C=a.GetAttributeByUniqueId(u,w);else{if(w=a.GetAttributeId(u,r[h[p]]),w===-1)continue;C=a.GetAttribute(u,w)}const B=i(r,a,u,p,I,C);p==="color"&&(B.vertexColorSpace=l.vertexColorSpace),f.attributes.push(B)}return g===r.TRIANGULAR_MESH&&(f.index=s(r,a,u)),r.destroy(u),f}function s(r,a,A){const h=A.num_faces()*3,c=h*4,u=r._malloc(c);a.GetTrianglesUInt32Array(A,c,u);const d=new Uint32Array(r.HEAPF32.buffer,u,h).slice();return r._free(u),{array:d,itemSize:1}}function i(r,a,A,l,h,c){const u=c.num_components(),g=A.num_points()*u,f=g*h.BYTES_PER_ELEMENT,p=n(r,h),I=r._malloc(f);a.GetAttributeDataArrayForAllPoints(A,c,p,f,I);const C=new h(r.HEAPF32.buffer,I,g).slice();return r._free(I),{name:l,array:C,itemSize:u}}function n(r,a){switch(a){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}function ca(o,e){if(e===bh)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===so||e===ql){let t=o.getIndex();if(t===null){const r=[],a=o.getAttribute("position");if(a!==void 0){for(let A=0;A<a.count;A++)r.push(A);o.setIndex(r),t=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const s=t.count-2,i=[];if(e===so)for(let r=1;r<=s;r++)i.push(t.getX(0)),i.push(t.getX(r)),i.push(t.getX(r+1));else for(let r=0;r<s;r++)r%2===0?(i.push(t.getX(r)),i.push(t.getX(r+1)),i.push(t.getX(r+2))):(i.push(t.getX(r+2)),i.push(t.getX(r+1)),i.push(t.getX(r)));i.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const n=o.clone();return n.setIndex(i),n.clearGroups(),n}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}class ad extends un{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new ud(t)}),this.register(function(t){return new dd(t)}),this.register(function(t){return new yd(t)}),this.register(function(t){return new wd(t)}),this.register(function(t){return new Qd(t)}),this.register(function(t){return new fd(t)}),this.register(function(t){return new pd(t)}),this.register(function(t){return new md(t)}),this.register(function(t){return new Id(t)}),this.register(function(t){return new hd(t)}),this.register(function(t){return new Ed(t)}),this.register(function(t){return new gd(t)}),this.register(function(t){return new Bd(t)}),this.register(function(t){return new Cd(t)}),this.register(function(t){return new ld(t)}),this.register(function(t){return new Sd(t)}),this.register(function(t){return new xd(t)})}load(e,t,s,i){const n=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const l=Xs.extractUrlBase(e);r=Xs.resolveURL(l,this.path)}else r=Xs.extractUrlBase(e);this.manager.itemStart(e);const a=function(l){i?i(l):console.error(l),n.manager.itemError(e),n.manager.itemEnd(e)},A=new gt(this.manager);A.setPath(this.path),A.setResponseType("arraybuffer"),A.setRequestHeader(this.requestHeader),A.setWithCredentials(this.withCredentials),A.load(e,function(l){try{n.parse(l,r,function(h){t(h),n.manager.itemEnd(e)},a)}catch(h){a(h)}},s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let n;const r={},a={},A=new TextDecoder;if(typeof e=="string")n=JSON.parse(e);else if(e instanceof ArrayBuffer)if(A.decode(new Uint8Array(e,0,4))===mc){try{r[P.KHR_BINARY_GLTF]=new vd(e)}catch(c){i&&i(c);return}n=JSON.parse(r[P.KHR_BINARY_GLTF].content)}else n=JSON.parse(A.decode(e));else n=e;if(n.asset===void 0||n.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Od(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const c=this.pluginCallbacks[h](l);c.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[c.name]=c,r[c.name]=!0}if(n.extensionsUsed)for(let h=0;h<n.extensionsUsed.length;++h){const c=n.extensionsUsed[h],u=n.extensionsRequired||[];switch(c){case P.KHR_MATERIALS_UNLIT:r[c]=new cd;break;case P.KHR_DRACO_MESH_COMPRESSION:r[c]=new bd(n,this.dracoLoader);break;case P.KHR_TEXTURE_TRANSFORM:r[c]=new Td;break;case P.KHR_MESH_QUANTIZATION:r[c]=new Md;break;default:u.indexOf(c)>=0&&a[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(s,i)}parseAsync(e,t){const s=this;return new Promise(function(i,n){s.parse(e,t,i,n)})}}function Ad(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const P={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ld{constructor(e){this.parser=e,this.name=P.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,i=t.length;s<i;s++){const n=t[s];n.extensions&&n.extensions[this.name]&&n.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let i=t.cache.get(s);if(i)return i;const n=t.json,A=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let l;const h=new oe(16777215);A.color!==void 0&&h.setRGB(A.color[0],A.color[1],A.color[2],te);const c=A.range!==void 0?A.range:0;switch(A.type){case"directional":l=new zl(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Kl(h),l.distance=c;break;case"spot":l=new Th(h),l.distance=c,A.spot=A.spot||{},A.spot.innerConeAngle=A.spot.innerConeAngle!==void 0?A.spot.innerConeAngle:0,A.spot.outerConeAngle=A.spot.outerConeAngle!==void 0?A.spot.outerConeAngle:Math.PI/4,l.angle=A.spot.outerConeAngle,l.penumbra=1-A.spot.innerConeAngle/A.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+A.type)}return l.position.set(0,0,0),l.decay=2,it(l,A),A.intensity!==void 0&&(l.intensity=A.intensity),l.name=t.createUniqueName(A.name||"light_"+e),i=Promise.resolve(l),t.cache.add(s,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,n=s.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(A){return s._getNodeRef(t.cache,a,A)})}}let cd=class{constructor(){this.name=P.KHR_MATERIALS_UNLIT}getMaterialType(){return Ge}extendParams(e,t,s){const i=[];e.color=new oe(1,1,1),e.opacity=1;const n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const r=n.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],te),e.opacity=r[3]}n.baseColorTexture!==void 0&&i.push(s.assignTexture(e,"map",n.baseColorTexture,Ee))}return Promise.all(i)}},hd=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return n!==void 0&&(t.emissiveIntensity=n),Promise.resolve()}},ud=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&n.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&n.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(n.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Re(a,a)}return Promise.all(n)}},dd=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_DISPERSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.dispersion=n.dispersion!==void 0?n.dispersion:0,Promise.resolve()}},gd=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&n.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&n.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(n)}},fd=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[];t.sheenColor=new oe(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=i.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],te)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&n.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,Ee)),r.sheenRoughnessTexture!==void 0&&n.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(n)}},pd=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&n.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(n)}},md=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&n.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new oe().setRGB(a[0],a[1],a[2],te),Promise.all(n)}},Id=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.ior=n.ior!==void 0?n.ior:1.5,Promise.resolve()}},Ed=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&n.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new oe().setRGB(a[0],a[1],a[2],te),r.specularColorTexture!==void 0&&n.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,Ee)),Promise.all(n)}},Cd=class{constructor(e){this.parser=e,this.name=P.EXT_MATERIALS_BUMP}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&n.push(s.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(n)}},Bd=class{constructor(e){this.parser=e,this.name=P.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:ze}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&n.push(s.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(n)}};class yd{constructor(e){this.parser=e,this.name=P.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const n=i.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,r)}}class wd{constructor(e){this.parser=e,this.name=P.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],a=i.images[r.source];let A=s.textureLoader;if(a.uri){const l=s.options.manager.getHandler(a.uri);l!==null&&(A=l)}return this.detectSupport().then(function(l){if(l)return s.loadTextureImage(e,r.source,A);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Qd{constructor(e){this.parser=e,this.name=P.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],a=i.images[r.source];let A=s.textureLoader;if(a.uri){const l=s.options.manager.getHandler(a.uri);l!==null&&(A=l)}return this.detectSupport().then(function(l){if(l)return s.loadTextureImage(e,r.source,A);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Sd{constructor(e){this.name=P.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const i=s.extensions[this.name],n=this.parser.getDependency("buffer",i.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then(function(a){const A=i.byteOffset||0,l=i.byteLength||0,h=i.count,c=i.byteStride,u=new Uint8Array(a,A,l);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(h,c,u,i.mode,i.filter).then(function(d){return d.buffer}):r.ready.then(function(){const d=new ArrayBuffer(h*c);return r.decodeGltfBuffer(new Uint8Array(d),h,c,u,i.mode,i.filter),d})})}else return null}}let xd=class{constructor(e){this.name=P.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const i=t.meshes[s.mesh];for(const l of i.primitives)if(l.mode!==be.TRIANGLES&&l.mode!==be.TRIANGLE_STRIP&&l.mode!==be.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=s.extensions[this.name].attributes,a=[],A={};for(const l in r)a.push(this.parser.getDependency("accessor",r[l]).then(h=>(A[l]=h,A[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const h=l.pop(),c=h.isGroup?h.children:[h],u=l[0].count,d=[];for(const g of c){const f=new Ve,p=new F,I=new Is,C=new F(1,1,1),w=new Mh(g.geometry,g.material,u);for(let B=0;B<u;B++)A.TRANSLATION&&p.fromBufferAttribute(A.TRANSLATION,B),A.ROTATION&&I.fromBufferAttribute(A.ROTATION,B),A.SCALE&&C.fromBufferAttribute(A.SCALE,B),w.setMatrixAt(B,f.compose(p,I,C));for(const B in A)if(B==="_COLOR_0"){const m=A[B];w.instanceColor=new Rh(m.array,m.itemSize,m.normalized)}else B!=="TRANSLATION"&&B!=="ROTATION"&&B!=="SCALE"&&g.geometry.setAttribute(B,A[B]);hs.prototype.copy.call(w,g),this.parser.assignFinalMaterial(w),d.push(w)}return h.isGroup?(h.clear(),h.add(...d),h):d[0]}))}};const mc="glTF",ws=12,ha={JSON:1313821514,BIN:5130562};class vd{constructor(e){this.name=P.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,ws),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==mc)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-ws,n=new DataView(e,ws);let r=0;for(;r<i;){const a=n.getUint32(r,!0);r+=4;const A=n.getUint32(r,!0);if(r+=4,A===ha.JSON){const l=new Uint8Array(e,ws+r,a);this.content=s.decode(l)}else if(A===ha.BIN){const l=ws+r;this.body=e.slice(l,l+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class bd{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=P.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},A={},l={};for(const h in r){const c=ao[h]||h.toLowerCase();a[c]=r[h]}for(const h in e.attributes){const c=ao[h]||h.toLowerCase();if(r[h]!==void 0){const u=s.accessors[e.attributes[h]],d=As[u.componentType];l[c]=d.name,A[c]=u.normalized===!0}}return t.getDependency("bufferView",n).then(function(h){return new Promise(function(c,u){i.decodeDracoFile(h,function(d){for(const g in d.attributes){const f=d.attributes[g],p=A[g];p!==void 0&&(f.normalized=p)}c(d)},a,l,te,u)})})}}class Td{constructor(){this.name=P.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Md{constructor(){this.name=P.KHR_MESH_QUANTIZATION}}class Ic extends Vh{constructor(e,t,s,i){super(e,t,s,i)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let r=0;r!==i;r++)t[r]=s[n+r];return t}interpolate_(e,t,s,i){const n=this.resultBuffer,r=this.sampleValues,a=this.valueSize,A=a*2,l=a*3,h=i-t,c=(s-t)/h,u=c*c,d=u*c,g=e*l,f=g-l,p=-2*d+3*u,I=d-u,C=1-p,w=I-u+c;for(let B=0;B!==a;B++){const m=r[f+B+a],y=r[f+B+A]*h,Q=r[g+B+a],E=r[g+B]*h;n[B]=C*m+w*y+p*Q+I*E}return n}}const Rd=new Is;class Dd extends Ic{interpolate_(e,t,s,i){const n=super.interpolate_(e,t,s,i);return Rd.fromArray(n).normalize().toArray(n),n}}const be={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},As={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ua={9728:Es,9729:ae,9984:fn,9985:pn,9986:mn,9987:ms},da={33071:Me,33648:In,10497:mt},Gn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ao={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},rt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},_d={CUBICSPLINE:void 0,LINEAR:So,STEP:Jl},On={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ld(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new ji({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:xo})),o.DefaultMaterial}function yt(o,e,t){for(const s in t.extensions)o[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function it(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Fd(o,e,t){let s=!1,i=!1,n=!1;for(let l=0,h=e.length;l<h;l++){const c=e[l];if(c.POSITION!==void 0&&(s=!0),c.NORMAL!==void 0&&(i=!0),c.COLOR_0!==void 0&&(n=!0),s&&i&&n)break}if(!s&&!i&&!n)return Promise.resolve(o);const r=[],a=[],A=[];for(let l=0,h=e.length;l<h;l++){const c=e[l];if(s){const u=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):o.attributes.position;r.push(u)}if(i){const u=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):o.attributes.normal;a.push(u)}if(n){const u=c.COLOR_0!==void 0?t.getDependency("accessor",c.COLOR_0):o.attributes.color;A.push(u)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(A)]).then(function(l){const h=l[0],c=l[1],u=l[2];return s&&(o.morphAttributes.position=h),i&&(o.morphAttributes.normal=c),n&&(o.morphAttributes.color=u),o.morphTargetsRelative=!0,o})}function Nd(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let s=0,i=t.length;s<i;s++)o.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function kd(o){let e;const t=o.extensions&&o.extensions[P.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Pn(t.attributes):e=o.indices+":"+Pn(o.attributes)+":"+o.mode,o.targets!==void 0)for(let s=0,i=o.targets.length;s<i;s++)e+=":"+Pn(o.targets[s]);return e}function Pn(o){let e="";const t=Object.keys(o).sort();for(let s=0,i=t.length;s<i;s++)e+=t[s]+":"+o[t[s]]+";";return e}function Ao(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ud(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Gd=new Ve;class Od{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ad,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,i=-1,n=!1,r=-1;if(typeof navigator<"u"){const a=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(a)===!0;const A=a.match(/Version\/(\d+)/);i=s&&A?parseInt(A[1],10):-1,n=a.indexOf("Firefox")>-1,r=n?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&i<17||n&&r<98?this.textureLoader=new Yl(this.options.manager):this.textureLoader=new Dh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new gt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(r){const a={scene:r[0][i.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:i.asset,parser:s,userData:{}};return yt(n,a,i),it(a,i),Promise.all(s._invokeAll(function(A){return A.afterRoot&&A.afterRoot(a)})).then(function(){for(const A of a.scenes)A.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let i=0,n=t.length;i<n;i++){const r=t[i].joints;for(let a=0,A=r.length;a<A;a++)e[r[a]].isBone=!0}for(let i=0,n=e.length;i<n;i++){const r=e[i];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(s[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const i=s.clone(),n=(r,a)=>{const A=this.associations.get(r);A!=null&&this.associations.set(a,A);for(const[l,h]of r.children.entries())n(h,a.children[l])};return n(s,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const i=e(t[s]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let i=0;i<t.length;i++){const n=e(t[i]);n&&s.push(n)}return s}getDependency(e,t){const s=e+":"+t;let i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(n){return n.loadNode&&n.loadNode(t)});break;case"mesh":i=this._invokeOne(function(n){return n.loadMesh&&n.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(n){return n.loadBufferView&&n.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(n){return n.loadMaterial&&n.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(n){return n.loadTexture&&n.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(n){return n.loadAnimation&&n.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(s,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(n,r){return s.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[P.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(n,r){s.load(Xs.resolveURL(t.uri,i.path),n,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const i=t.byteLength||0,n=t.byteOffset||0;return s.slice(n,n+i)})}loadAccessor(e){const t=this,s=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const r=Gn[i.type],a=As[i.componentType],A=i.normalized===!0,l=new a(i.count*r);return Promise.resolve(new Te(l,r,A))}const n=[];return i.bufferView!==void 0?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),i.sparse!==void 0&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(r){const a=r[0],A=Gn[i.type],l=As[i.componentType],h=l.BYTES_PER_ELEMENT,c=h*A,u=i.byteOffset||0,d=i.bufferView!==void 0?s.bufferViews[i.bufferView].byteStride:void 0,g=i.normalized===!0;let f,p;if(d&&d!==c){const I=Math.floor(u/d),C="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+I+":"+i.count;let w=t.cache.get(C);w||(f=new l(a,I*d,i.count*d/h),w=new _h(f,d/h),t.cache.add(C,w)),p=new $h(w,A,u%d/h,g)}else a===null?f=new l(i.count*A):f=new l(a,u,i.count*A),p=new Te(f,A,g);if(i.sparse!==void 0){const I=Gn.SCALAR,C=As[i.sparse.indices.componentType],w=i.sparse.indices.byteOffset||0,B=i.sparse.values.byteOffset||0,m=new C(r[1],w,i.sparse.count*I),y=new l(r[2],B,i.sparse.count*A);a!==null&&(p=new Te(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let Q=0,E=m.length;Q<E;Q++){const S=m[Q];if(p.setX(S,y[Q*A]),A>=2&&p.setY(S,y[Q*A+1]),A>=3&&p.setZ(S,y[Q*A+2]),A>=4&&p.setW(S,y[Q*A+3]),A>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=g}return p})}loadTexture(e){const t=this.json,s=this.options,n=t.textures[e].source,r=t.images[n];let a=this.textureLoader;if(r.uri){const A=s.manager.getHandler(r.uri);A!==null&&(a=A)}return this.loadTextureImage(e,n,a)}loadTextureImage(e,t,s){const i=this,n=this.json,r=n.textures[e],a=n.images[t],A=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[A])return this.textureCache[A];const l=this.loadImageSource(t,s).then(function(h){h.flipY=!1,h.name=r.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const u=(n.samplers||{})[r.sampler]||{};return h.magFilter=ua[u.magFilter]||ae,h.minFilter=ua[u.minFilter]||ms,h.wrapS=da[u.wrapS]||mt,h.wrapT=da[u.wrapT]||mt,i.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[A]=l,l}loadImageSource(e,t){const s=this,i=this.json,n=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(c=>c.clone());const r=i.images[e],a=self.URL||self.webkitURL;let A=r.uri||"",l=!1;if(r.bufferView!==void 0)A=s.getDependency("bufferView",r.bufferView).then(function(c){l=!0;const u=new Blob([c],{type:r.mimeType});return A=a.createObjectURL(u),A});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(A).then(function(c){return new Promise(function(u,d){let g=u;t.isImageBitmapLoader===!0&&(g=function(f){const p=new Oe(f);p.needsUpdate=!0,u(p)}),t.load(Xs.resolveURL(c,n.path),g,void 0,d)})}).then(function(c){return l===!0&&a.revokeObjectURL(A),it(c,r),c.userData.mimeType=r.mimeType||Ud(r.uri),c}).catch(function(c){throw console.error("THREE.GLTFLoader: Couldn't load texture",A),c});return this.sourceCache[e]=h,h}assignTexture(e,t,s,i){const n=this;return this.getDependency("texture",s.index).then(function(r){if(!r)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(r=r.clone(),r.channel=s.texCoord),n.extensions[P.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[P.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const A=n.associations.get(r);r=n.extensions[P.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),n.associations.set(r,A)}}return i!==void 0&&(r.colorSpace=i),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const i=t.attributes.tangent===void 0,n=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+s.uuid;let A=this.cache.get(a);A||(A=new Lh,Gi.prototype.copy.call(A,s),A.color.copy(s.color),A.map=s.map,A.sizeAttenuation=!1,this.cache.add(a,A)),s=A}else if(e.isLine){const a="LineBasicMaterial:"+s.uuid;let A=this.cache.get(a);A||(A=new Fh,Gi.prototype.copy.call(A,s),A.color.copy(s.color),A.map=s.map,this.cache.add(a,A)),s=A}if(i||n||r){let a="ClonedMaterial:"+s.uuid+":";i&&(a+="derivative-tangents:"),n&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let A=this.cache.get(a);A||(A=s.clone(),n&&(A.vertexColors=!0),r&&(A.flatShading=!0),i&&(A.normalScale&&(A.normalScale.y*=-1),A.clearcoatNormalScale&&(A.clearcoatNormalScale.y*=-1)),this.cache.add(a,A),this.associations.set(A,this.associations.get(s))),s=A}e.material=s}getMaterialType(){return ji}loadMaterial(e){const t=this,s=this.json,i=this.extensions,n=s.materials[e];let r;const a={},A=n.extensions||{},l=[];if(A[P.KHR_MATERIALS_UNLIT]){const c=i[P.KHR_MATERIALS_UNLIT];r=c.getMaterialType(),l.push(c.extendParams(a,n,t))}else{const c=n.pbrMetallicRoughness||{};if(a.color=new oe(1,1,1),a.opacity=1,Array.isArray(c.baseColorFactor)){const u=c.baseColorFactor;a.color.setRGB(u[0],u[1],u[2],te),a.opacity=u[3]}c.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",c.baseColorTexture,Ee)),a.metalness=c.metallicFactor!==void 0?c.metallicFactor:1,a.roughness=c.roughnessFactor!==void 0?c.roughnessFactor:1,c.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",c.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",c.metallicRoughnessTexture))),r=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,a)})))}n.doubleSided===!0&&(a.side=ft);const h=n.alphaMode||On.OPAQUE;if(h===On.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===On.MASK&&(a.alphaTest=n.alphaCutoff!==void 0?n.alphaCutoff:.5)),n.normalTexture!==void 0&&r!==Ge&&(l.push(t.assignTexture(a,"normalMap",n.normalTexture)),a.normalScale=new Re(1,1),n.normalTexture.scale!==void 0)){const c=n.normalTexture.scale;a.normalScale.set(c,c)}if(n.occlusionTexture!==void 0&&r!==Ge&&(l.push(t.assignTexture(a,"aoMap",n.occlusionTexture)),n.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=n.occlusionTexture.strength)),n.emissiveFactor!==void 0&&r!==Ge){const c=n.emissiveFactor;a.emissive=new oe().setRGB(c[0],c[1],c[2],te)}return n.emissiveTexture!==void 0&&r!==Ge&&l.push(t.assignTexture(a,"emissiveMap",n.emissiveTexture,Ee)),Promise.all(l).then(function(){const c=new r(a);return n.name&&(c.name=n.name),it(c,n),t.associations.set(c,{materials:e}),n.extensions&&yt(i,c,n),c})}createUniqueName(e){const t=ti.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,i=this.primitiveCache;function n(a){return s[P.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(A){return ga(A,a,t)})}const r=[];for(let a=0,A=e.length;a<A;a++){const l=e[a],h=kd(l),c=i[h];if(c)r.push(c.promise);else{let u;l.extensions&&l.extensions[P.KHR_DRACO_MESH_COMPRESSION]?u=n(l):u=ga(new dn,l,t),i[h]={primitive:l,promise:u},r.push(u)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,i=this.extensions,n=s.meshes[e],r=n.primitives,a=[];for(let A=0,l=r.length;A<l;A++){const h=r[A].material===void 0?Ld(this.cache):this.getDependency("material",r[A].material);a.push(h)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(A){const l=A.slice(0,A.length-1),h=A[A.length-1],c=[];for(let d=0,g=h.length;d<g;d++){const f=h[d],p=r[d];let I;const C=l[d];if(p.mode===be.TRIANGLES||p.mode===be.TRIANGLE_STRIP||p.mode===be.TRIANGLE_FAN||p.mode===void 0)I=n.isSkinnedMesh===!0?new Nh(f,C):new Ae(f,C),I.isSkinnedMesh===!0&&I.normalizeSkinWeights(),p.mode===be.TRIANGLE_STRIP?I.geometry=ca(I.geometry,ql):p.mode===be.TRIANGLE_FAN&&(I.geometry=ca(I.geometry,so));else if(p.mode===be.LINES)I=new kh(f,C);else if(p.mode===be.LINE_STRIP)I=new io(f,C);else if(p.mode===be.LINE_LOOP)I=new Uh(f,C);else if(p.mode===be.POINTS)I=new Gh(f,C);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(I.geometry.morphAttributes).length>0&&Nd(I,n),I.name=t.createUniqueName(n.name||"mesh_"+e),it(I,n),p.extensions&&yt(i,I,p),t.assignFinalMaterial(I),c.push(I)}for(let d=0,g=c.length;d<g;d++)t.associations.set(c[d],{meshes:e,primitives:d});if(c.length===1)return n.extensions&&yt(i,c[0],n),c[0];const u=new Oi;n.extensions&&yt(i,u,n),t.associations.set(u,{meshes:e});for(let d=0,g=c.length;d<g;d++)u.add(c[d]);return u})}loadCamera(e){let t;const s=this.json.cameras[e],i=s[s.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new si(Xi.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):s.type==="orthographic"&&(t=new gn(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),it(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let i=0,n=t.joints.length;i<n;i++)s.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(i){const n=i.pop(),r=i,a=[],A=[];for(let l=0,h=r.length;l<h;l++){const c=r[l];if(c){a.push(c);const u=new Ve;n!==null&&u.fromArray(n.array,l*16),A.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new Oh(a,A)})}loadAnimation(e){const t=this.json,s=this,i=t.animations[e],n=i.name?i.name:"animation_"+e,r=[],a=[],A=[],l=[],h=[];for(let c=0,u=i.channels.length;c<u;c++){const d=i.channels[c],g=i.samplers[d.sampler],f=d.target,p=f.node,I=i.parameters!==void 0?i.parameters[g.input]:g.input,C=i.parameters!==void 0?i.parameters[g.output]:g.output;f.node!==void 0&&(r.push(this.getDependency("node",p)),a.push(this.getDependency("accessor",I)),A.push(this.getDependency("accessor",C)),l.push(g),h.push(f))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(A),Promise.all(l),Promise.all(h)]).then(function(c){const u=c[0],d=c[1],g=c[2],f=c[3],p=c[4],I=[];for(let C=0,w=u.length;C<w;C++){const B=u[C],m=d[C],y=g[C],Q=f[C],E=p[C];if(B===void 0)continue;B.updateMatrix&&B.updateMatrix();const S=s._createAnimationTracks(B,m,y,Q,E);if(S)for(let v=0;v<S.length;v++)I.push(S[v])}return new Ph(n,void 0,I)})}createNodeMesh(e){const t=this.json,s=this,i=t.nodes[e];return i.mesh===void 0?null:s.getDependency("mesh",i.mesh).then(function(n){const r=s._getNodeRef(s.meshCache,i.mesh,n);return i.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let A=0,l=i.weights.length;A<l;A++)a.morphTargetInfluences[A]=i.weights[A]}),r})}loadNode(e){const t=this.json,s=this,i=t.nodes[e],n=s._loadNodeShallow(e),r=[],a=i.children||[];for(let l=0,h=a.length;l<h;l++)r.push(s.getDependency("node",a[l]));const A=i.skin===void 0?Promise.resolve(null):s.getDependency("skin",i.skin);return Promise.all([n,Promise.all(r),A]).then(function(l){const h=l[0],c=l[1],u=l[2];u!==null&&h.traverse(function(d){d.isSkinnedMesh&&d.bind(u,Gd)});for(let d=0,g=c.length;d<g;d++)h.add(c[d]);return h})}_loadNodeShallow(e){const t=this.json,s=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const n=t.nodes[e],r=n.name?i.createUniqueName(n.name):"",a=[],A=i._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return A&&a.push(A),n.camera!==void 0&&a.push(i.getDependency("camera",n.camera).then(function(l){return i._getNodeRef(i.cameraCache,n.camera,l)})),i._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),this.nodeCache[e]=Promise.all(a).then(function(l){let h;if(n.isBone===!0?h=new Hh:l.length>1?h=new Oi:l.length===1?h=l[0]:h=new hs,h!==l[0])for(let c=0,u=l.length;c<u;c++)h.add(l[c]);if(n.name&&(h.userData.name=n.name,h.name=r),it(h,n),n.extensions&&yt(s,h,n),n.matrix!==void 0){const c=new Ve;c.fromArray(n.matrix),h.applyMatrix4(c)}else n.translation!==void 0&&h.position.fromArray(n.translation),n.rotation!==void 0&&h.quaternion.fromArray(n.rotation),n.scale!==void 0&&h.scale.fromArray(n.scale);return i.associations.has(h)||i.associations.set(h,{}),i.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],i=this,n=new Oi;s.name&&(n.name=i.createUniqueName(s.name)),it(n,s),s.extensions&&yt(t,n,s);const r=s.nodes||[],a=[];for(let A=0,l=r.length;A<l;A++)a.push(i.getDependency("node",r[A]));return Promise.all(a).then(function(A){for(let h=0,c=A.length;h<c;h++)n.add(A[h]);const l=h=>{const c=new Map;for(const[u,d]of i.associations)(u instanceof Gi||u instanceof Oe)&&c.set(u,d);return h.traverse(u=>{const d=i.associations.get(u);d!=null&&c.set(u,d)}),c};return i.associations=l(n),n})}_createAnimationTracks(e,t,s,i,n){const r=[],a=e.name?e.name:e.uuid,A=[];rt[n.path]===rt.weights?e.traverse(function(u){u.morphTargetInfluences&&A.push(u.name?u.name:u.uuid)}):A.push(a);let l;switch(rt[n.path]){case rt.weights:l=$o;break;case rt.rotation:l=Vo;break;case rt.position:case rt.scale:l=Ho;break;default:switch(s.itemSize){case 1:l=$o;break;case 2:case 3:default:l=Ho;break}break}const h=i.interpolation!==void 0?_d[i.interpolation]:So,c=this._getArrayFromAccessor(s);for(let u=0,d=A.length;u<d;u++){const g=new l(A[u]+"."+rt[n.path],t.array,c,h);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),r.push(g)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const s=Ao(t.constructor),i=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n++)i[n]=t[n]*s;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(s){const i=this instanceof Vo?Dd:Ic;return new i(this.times,this.values,this.getValueSize()/3,s)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Pd(o,e,t){const s=e.attributes,i=new Rt;if(s.POSITION!==void 0){const a=t.json.accessors[s.POSITION],A=a.min,l=a.max;if(A!==void 0&&l!==void 0){if(i.set(new F(A[0],A[1],A[2]),new F(l[0],l[1],l[2])),a.normalized){const h=Ao(As[a.componentType]);i.min.multiplyScalar(h),i.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const n=e.targets;if(n!==void 0){const a=new F,A=new F;for(let l=0,h=n.length;l<h;l++){const c=n[l];if(c.POSITION!==void 0){const u=t.json.accessors[c.POSITION],d=u.min,g=u.max;if(d!==void 0&&g!==void 0){if(A.setX(Math.max(Math.abs(d[0]),Math.abs(g[0]))),A.setY(Math.max(Math.abs(d[1]),Math.abs(g[1]))),A.setZ(Math.max(Math.abs(d[2]),Math.abs(g[2]))),u.normalized){const f=Ao(As[u.componentType]);A.multiplyScalar(f)}a.max(A)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}o.boundingBox=i;const r=new vo;i.getCenter(r.center),r.radius=i.min.distanceTo(i.max)/2,o.boundingSphere=r}function ga(o,e,t){const s=e.attributes,i=[];function n(r,a){return t.getDependency("accessor",r).then(function(A){o.setAttribute(a,A)})}for(const r in s){const a=ao[r]||r.toLowerCase();a in o.attributes||i.push(n(s[r],a))}if(e.indices!==void 0&&!o.index){const r=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});i.push(r)}return to.workingColorSpace!==te&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${to.workingColorSpace}" not supported.`),it(o,e),Pd(o,e,t),Promise.all(i).then(function(){return e.targets!==void 0?Fd(o,e.targets,t):o})}class Hd{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const s=this.workersResolve[e];if(s&&s(t),this.queue.length){const{resolve:i,msg:n,transfer:r}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(n,r)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(s=>{const i=this._getIdleWorker();i!==-1?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=s,this.workers[i].postMessage(e,t)):this.queue.push({resolve:s,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const $d=0,fa=2,Vd=1,pa=2,qd=0,Kd=1,zd=10,Yd=0,Ec=9,Cc=15,Bc=16,yc=22,wc=37,Qc=43,Sc=76,xc=83,vc=97,bc=100,Tc=103,Mc=109,Rc=165,Dc=166,_c=1000066e3;class Jd{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Qs{constructor(e,t,s,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,s),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const s=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,i)}}const fe=[171,75,84,88,32,50,48,187,13,10,26,10];function ma(o){return new TextDecoder().decode(o)}function Wd(o){const e=new Uint8Array(o.buffer,o.byteOffset,fe.length);if(e[0]!==fe[0]||e[1]!==fe[1]||e[2]!==fe[2]||e[3]!==fe[3]||e[4]!==fe[4]||e[5]!==fe[5]||e[6]!==fe[6]||e[7]!==fe[7]||e[8]!==fe[8]||e[9]!==fe[9]||e[10]!==fe[10]||e[11]!==fe[11])throw new Error("Missing KTX 2.0 identifier.");const t=new Jd,s=17*Uint32Array.BYTES_PER_ELEMENT,i=new Qs(o,fe.length,s,!0);t.vkFormat=i._nextUint32(),t.typeSize=i._nextUint32(),t.pixelWidth=i._nextUint32(),t.pixelHeight=i._nextUint32(),t.pixelDepth=i._nextUint32(),t.layerCount=i._nextUint32(),t.faceCount=i._nextUint32();const n=i._nextUint32();t.supercompressionScheme=i._nextUint32();const r=i._nextUint32(),a=i._nextUint32(),A=i._nextUint32(),l=i._nextUint32(),h=i._nextUint64(),c=i._nextUint64(),u=new Qs(o,fe.length+s,3*n*8,!0);for(let D=0;D<n;D++)t.levels.push({levelData:new Uint8Array(o.buffer,o.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const d=new Qs(o,r,a,!0),g={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},f=(g.descriptorBlockSize/4-6)/4;for(let D=0;D<f;D++){const H={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&H.channelType?(H.sampleLower=d._nextInt32(),H.sampleUpper=d._nextInt32()):(H.sampleLower=d._nextUint32(),H.sampleUpper=d._nextUint32()),g.samples[D]=H}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(g);const p=new Qs(o,A,l,!0);for(;p._offset<l;){const D=p._nextUint32(),H=p._scan(D),$=ma(H);if(t.keyValue[$]=p._nextUint8Array(D-H.byteLength-1),$.match(/^ktx/i)){const V=ma(t.keyValue[$]);t.keyValue[$]=V.substring(0,V.lastIndexOf("\0"))}p._skip(D%4?4-D%4:0)}if(c<=0)return t;const I=new Qs(o,h,c,!0),C=I._nextUint16(),w=I._nextUint16(),B=I._nextUint32(),m=I._nextUint32(),y=I._nextUint32(),Q=I._nextUint32(),E=[];for(let D=0;D<n;D++)E.push({imageFlags:I._nextUint32(),rgbSliceByteOffset:I._nextUint32(),rgbSliceByteLength:I._nextUint32(),alphaSliceByteOffset:I._nextUint32(),alphaSliceByteLength:I._nextUint32()});const S=h+I._offset,v=S+B,R=v+m,_=R+y,N=new Uint8Array(o.buffer,o.byteOffset+S,B),T=new Uint8Array(o.buffer,o.byteOffset+v,m),M=new Uint8Array(o.buffer,o.byteOffset+R,y),L=new Uint8Array(o.buffer,o.byteOffset+_,Q);return t.globalData={endpointCount:C,selectorCount:w,imageDescs:E,endpointsData:N,selectorsData:T,tablesData:M,extendedData:L},t}let Hn,st,lo;const $n={env:{emscripten_notify_memory_growth:function(o){lo=new Uint8Array(st.exports.memory.buffer)}}};class jd{init(){return Hn||(Hn=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Ia).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,$n)).then(this._init):WebAssembly.instantiate(Buffer.from(Ia,"base64"),$n).then(this._init),Hn)}_init(e){st=e.instance,$n.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!st)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,i=st.exports.malloc(s);lo.set(e,i),t=t||Number(st.exports.ZSTD_findDecompressedSize(i,s));const n=st.exports.malloc(t),r=st.exports.ZSTD_decompress(n,t,i,s),a=lo.slice(n,n+r);return st.exports.free(i),st.exports.free(n),a}}const Ia="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",Vn=new WeakMap;let qn=0,Kn;class Pe extends un{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Hd,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new gt(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),s=new gt(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const i=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([n,r])=>{const a=Pe.BasisWorker.toString(),A=["/* constants */","let _EngineFormat = "+JSON.stringify(Pe.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Pe.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Pe.BasisFormat),"/* basis_transcoder.js */",n,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([A])),this.transcoderBinary=r,this.workerPool.setWorkerCreator(()=>{const l=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),l})}),qn>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),qn++}return this.transcoderPending}load(e,t,s,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const n=new gt(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials),n.load(e,r=>{this.parse(r,t,i)},s,i)}parse(e,t,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(Vn.has(e))return Vn.get(e).promise.then(t).catch(s);this._createTexture(e).then(i=>t?t(i):null).catch(s)}_createTextureFrom(e,t){const{faces:s,width:i,height:n,format:r,type:a,error:A,dfdFlags:l}=e;if(a==="error")return Promise.reject(A);let h;if(t.faceCount===6)h=new qh(s,r,Be);else{const c=s[0].mipmaps;h=t.layerCount>1?new Kh(c,i,n,t.layerCount,r,Be):new Zs(c,i,n,r,Be)}return h.minFilter=s[0].mipmaps.length===1?ae:ms,h.magFilter=ae,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=Lc(t),h.premultiplyAlpha=!!(l&Vd),h}async _createTexture(e,t={}){const s=Wd(new Uint8Array(e));if(s.vkFormat!==Yd)return Zd(s);const i=t,n=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e])).then(r=>this._createTextureFrom(r.data,s));return Vn.set(e,{promise:n}),n}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),qn--,this}}Pe.BasisFormat={ETC1S:0,UASTC_4x4:1};Pe.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Pe.EngineFormat={RGBAFormat:Qe,RGBA_ASTC_4x4_Format:Wl,RGBA_BPTC_Format:zh,RGBA_ETC2_EAC_Format:Yh,RGBA_PVRTC_4BPPV1_Format:Jh,RGBA_S3TC_DXT5_Format:Wh,RGB_ETC1_Format:jh,RGB_ETC2_Format:Xh,RGB_PVRTC_4BPPV1_Format:Zh,RGBA_S3TC_DXT1_Format:eu};Pe.BasisWorker=function(){let o,e,t;const s=_EngineFormat,i=_TranscoderFormat,n=_BasisFormat;self.addEventListener("message",function(g){const f=g.data;switch(f.type){case"init":o=f.config,r(f.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:p,buffers:I,width:C,height:w,hasAlpha:B,format:m,dfdFlags:y}=a(f.buffer);self.postMessage({type:"transcode",id:f.id,faces:p,width:C,height:w,hasAlpha:B,format:m,dfdFlags:y},I)}catch(p){console.error(p),self.postMessage({type:"error",id:f.id,error:p.message})}});break}});function r(g){e=new Promise(f=>{t={wasmBinary:g,onRuntimeInitialized:f},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(g){const f=new t.KTX2File(new Uint8Array(g));function p(){f.close(),f.delete()}if(!f.isValid())throw p(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const I=f.isUASTC()?n.UASTC_4x4:n.ETC1S,C=f.getWidth(),w=f.getHeight(),B=f.getLayers()||1,m=f.getLevels(),y=f.getFaces(),Q=f.getHasAlpha(),E=f.getDFDFlags(),{transcoderFormat:S,engineFormat:v}=c(I,C,w,Q);if(!C||!w||!m)throw p(),new Error("THREE.KTX2Loader:	Invalid texture");if(!f.startTranscoding())throw p(),new Error("THREE.KTX2Loader: .startTranscoding failed");const R=[],_=[];for(let N=0;N<y;N++){const T=[];for(let M=0;M<m;M++){const L=[];let D,H;for(let V=0;V<B;V++){const K=f.getImageLevelInfo(M,V,N);N===0&&M===0&&V===0&&(K.origWidth%4!==0||K.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),m>1?(D=K.origWidth,H=K.origHeight):(D=K.width,H=K.height);const J=new Uint8Array(f.getImageTranscodedSizeInBytes(M,V,0,S));if(!f.transcodeImage(J,M,V,N,S,0,-1,-1))throw p(),new Error("THREE.KTX2Loader: .transcodeImage failed.");L.push(J)}const $=d(L);T.push({data:$,width:D,height:H}),_.push($.buffer)}R.push({mipmaps:T,width:C,height:w,format:v})}return p(),{faces:R,buffers:_,width:C,height:w,hasAlpha:Q,format:v,dfdFlags:E}}const A=[{if:"astcSupported",basisFormat:[n.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[i.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=A.sort(function(g,f){return g.priorityETC1S-f.priorityETC1S}),h=A.sort(function(g,f){return g.priorityUASTC-f.priorityUASTC});function c(g,f,p,I){let C,w;const B=g===n.ETC1S?l:h;for(let m=0;m<B.length;m++){const y=B[m];if(o[y.if]&&y.basisFormat.includes(g)&&!(I&&y.transcoderFormat.length<2)&&!(y.needsPowerOfTwo&&!(u(f)&&u(p))))return C=y.transcoderFormat[I?1:0],w=y.engineFormat[I?1:0],{transcoderFormat:C,engineFormat:w}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),C=i.RGBA32,w=s.RGBAFormat,{transcoderFormat:C,engineFormat:w}}function u(g){return g<=2?!0:(g&g-1)===0&&g!==0}function d(g){if(g.length===1)return g[0];let f=0;for(let C=0;C<g.length;C++){const w=g[C];f+=w.byteLength}const p=new Uint8Array(f);let I=0;for(let C=0;C<g.length;C++){const w=g[C];p.set(w,I),I+=w.byteLength}return p}};const Xd=new Set([Qe,$s,Vs]),zn={[Mc]:Qe,[vc]:Qe,[wc]:Qe,[Qc]:Qe,[Tc]:$s,[xc]:$s,[Bc]:$s,[yc]:$s,[bc]:Vs,[Sc]:Vs,[Cc]:Vs,[Ec]:Vs,[_c]:Wl,[Dc]:qo,[Rc]:qo},Yn={[Mc]:$e,[vc]:ye,[wc]:Be,[Qc]:Be,[Tc]:$e,[xc]:ye,[Bc]:Be,[yc]:Be,[bc]:$e,[Sc]:ye,[Cc]:Be,[Ec]:Be,[_c]:ye,[Dc]:Be,[Rc]:Be};async function Zd(o){const{vkFormat:e}=o;if(zn[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;o.supercompressionScheme===fa&&(Kn||(Kn=new Promise(async n=>{const r=new jd;await r.init(),n(r)})),t=await Kn);const s=[];for(let n=0;n<o.levels.length;n++){const r=Math.max(1,o.pixelWidth>>n),a=Math.max(1,o.pixelHeight>>n),A=o.pixelDepth?Math.max(1,o.pixelDepth>>n):0,l=o.levels[n];let h;if(o.supercompressionScheme===$d)h=l.levelData;else if(o.supercompressionScheme===fa)h=t.decode(l.levelData,l.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let c;Yn[e]===$e?c=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):Yn[e]===ye?c=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):c=h,s.push({data:c,width:r,height:a,depth:A})}let i;if(Xd.has(zn[e]))i=o.pixelDepth===0?new jl(s[0].data,o.pixelWidth,o.pixelHeight):new tu(s[0].data,o.pixelWidth,o.pixelHeight,o.pixelDepth);else{if(o.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");i=new Zs(s,o.pixelWidth,o.pixelHeight)}return i.mipmaps=s,i.type=Yn[e],i.format=zn[e],i.colorSpace=Lc(o),i.needsUpdate=!0,Promise.resolve(i)}function Lc(o){const e=o.dataFormatDescriptor[0];return e.colorPrimaries===Kd?e.transferFunction===pa?Ee:te:e.colorPrimaries===zd?e.transferFunction===pa?su:iu:e.colorPrimaries===qd?Zi:(console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),Zi)}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ea,Ca;const De=Symbol("retainerCount"),Ye=Symbol("recentlyUsed"),ui=Symbol("evict"),Ss=Symbol("evictionThreshold"),Jn=Symbol("cache");class eg{constructor(e,t=5){this[Ea]=new Map,this[Ca]=[],this[Jn]=e,this[Ss]=t}set evictionThreshold(e){this[Ss]=e,this[ui]()}get evictionThreshold(){return this[Ss]}get cache(){return this[Jn]}retainerCount(e){return this[De].get(e)||0}reset(){this[De].clear(),this[Ye]=[]}retain(e){this[De].has(e)||this[De].set(e,0),this[De].set(e,this[De].get(e)+1);const t=this[Ye].indexOf(e);t!==-1&&this[Ye].splice(t,1),this[Ye].unshift(e),this[ui]()}release(e){this[De].has(e)&&this[De].set(e,Math.max(this[De].get(e)-1,0)),this[ui]()}[(Ea=De,Ca=Ye,ui)](){if(!(this[Ye].length<this[Ss]))for(let e=this[Ye].length-1;e>=this[Ss];--e){const t=this[Ye][e];this[De].get(t)===0&&(this[Jn].delete(t),this[Ye].splice(e,1))}}}/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tg=o=>{const e=[],t=new Set;for(const s of o){let i=s,n=0;for(;t.has(i);)i=s+"."+ ++n;t.add(i),e.push(i)}return e},sg=o=>{const e=new Map;for(const t of o.mappings)for(const s of t.variants)e.set(s,{material:null,gltfMaterialIndex:t.material});return e};class ig{constructor(e){this.parser=e,this.name="KHR_materials_variants"}afterRoot(e){const t=this.parser,s=t.json;if(s.extensions===void 0||s.extensions[this.name]===void 0)return null;const n=s.extensions[this.name].variants||[],r=tg(n.map(a=>a.name));for(const a of e.scenes)a.traverse(A=>{const l=A;if(!l.material)return;const h=t.associations.get(l);if(h==null||h.meshes==null||h.primitives==null)return;const g=s.meshes[h.meshes].primitives[h.primitives].extensions;!g||!g[this.name]||(l.userData.variantMaterials=sg(g[this.name]))});return e.userData.variants=r,Promise.resolve()}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fc,Ba;Oe.DEFAULT_ANISOTROPY=4;const ng=(o,e,t=()=>{})=>{const s=i=>{const n=i.loaded/i.total;t(Math.max(0,Math.min(1,isFinite(n)?n:1)))};return new Promise((i,n)=>{e.load(o,i,s,n)})},rg=o=>new Promise((e,t)=>{const s=document.createElement("script");document.body.appendChild(s),s.onload=e,s.onerror=t,s.async=!0,s.src=o}),Je=new Map,Wn=new Map;let ya;const wa=new rd;let Qa;const jn=new Pe;let Xn,Zn;const xt=Symbol("loader"),lt=Symbol("evictionPolicy"),Sa=Symbol("GLTFInstance");class me extends En{constructor(e){super(),this[Ba]=new ad().register(t=>new ig(t)),this[Sa]=e,this[xt].setDRACOLoader(wa),this[xt].setKTX2Loader(jn)}static setDRACODecoderLocation(e){ya=e,wa.setDecoderPath(e)}static getDRACODecoderLocation(){return ya}static setKTX2TranscoderLocation(e){Qa=e,jn.setTranscoderPath(e)}static getKTX2TranscoderLocation(){return Qa}static setMeshoptDecoderLocation(e){Xn!==e&&(Xn=e,Zn=rg(e).then(()=>MeshoptDecoder.ready).then(()=>MeshoptDecoder))}static getMeshoptDecoderLocation(){return Xn}static initializeKTX2Loader(e){jn.detectSupport(e)}static get cache(){return Je}static clearCache(){Je.forEach((e,t)=>{this.delete(t)}),this[lt].reset()}static has(e){return Je.has(e)}static async delete(e){if(!this.has(e))return;const t=Je.get(e);Wn.delete(e),Je.delete(e),(await t).dispose()}static hasFinishedLoading(e){return!!Wn.get(e)}get[(Fc=lt,Ba=xt,lt)](){return this.constructor[lt]}async preload(e,t,s=()=>{}){if(this[xt].setWithCredentials(t.withCredentials),this.dispatchEvent({type:"preload",element:t,src:e}),!Je.has(e)){Zn!=null&&this[xt].setMeshoptDecoder(await Zn);const i=ng(e,this[xt],a=>{s(a*.8)}),n=this[Sa],r=i.then(a=>n.prepare(a)).then(a=>(s(.9),new n(a))).catch(a=>(console.error(a),new n));Je.set(e,r)}await Je.get(e),Wn.set(e,!0),s&&s(1)}async load(e,t,s=()=>{}){await this.preload(e,t,s);const n=await(await Je.get(e)).clone();return this[lt].retain(e),n.dispose=()=>{this[lt].release(e)},n}}me[Fc]=new eg(me);class og extends hs{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Re(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Gt=new F,xa=new Ve,va=new Ve,ba=new F,Ta=new F;class ag{constructor(e={}){const t=this;let s,i,n,r;const a={objects:new WeakMap},A=e.element!==void 0?e.element:document.createElement("div");A.style.overflow="hidden",this.domElement=A,this.getSize=function(){return{width:s,height:i}},this.render=function(g,f){g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),f.parent===null&&f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),xa.copy(f.matrixWorldInverse),va.multiplyMatrices(f.projectionMatrix,xa),h(g,g,f),d(g)},this.setSize=function(g,f){s=g,i=f,n=s/2,r=i/2,A.style.width=g+"px",A.style.height=f+"px"};function l(g){g.isCSS2DObject&&(g.element.style.display="none");for(let f=0,p=g.children.length;f<p;f++)l(g.children[f])}function h(g,f,p){if(g.visible===!1){l(g);return}if(g.isCSS2DObject){Gt.setFromMatrixPosition(g.matrixWorld),Gt.applyMatrix4(va);const I=Gt.z>=-1&&Gt.z<=1&&g.layers.test(p.layers)===!0,C=g.element;C.style.display=I===!0?"":"none",I===!0&&(g.onBeforeRender(t,f,p),C.style.transform="translate("+-100*g.center.x+"%,"+-100*g.center.y+"%)translate("+(Gt.x*n+n)+"px,"+(-Gt.y*r+r)+"px)",C.parentNode!==A&&A.appendChild(C),g.onAfterRender(t,f,p));const w={distanceToCameraSquared:c(p,g)};a.objects.set(g,w)}for(let I=0,C=g.children.length;I<C;I++)h(g.children[I],f,p)}function c(g,f){return ba.setFromMatrixPosition(g.matrixWorld),Ta.setFromMatrixPosition(f.matrixWorld),ba.distanceToSquared(Ta)}function u(g){const f=[];return g.traverseVisible(function(p){p.isCSS2DObject&&f.push(p)}),f}function d(g){const f=u(g).sort(function(I,C){if(I.renderOrder!==C.renderOrder)return C.renderOrder-I.renderOrder;const w=a.objects.get(I).distanceToCameraSquared,B=a.objects.get(C).distanceToCameraSquared;return w-B}),p=f.length;for(let I=0,C=f.length;I<C;I++)f[I].element.style.zIndex=p-I}}}function di(o,e,t){let s=t;const i=new F;return o.updateWorldMatrix(!0,!0),o.traverseVisible(n=>{const{geometry:r}=n;if(r!==void 0){const{position:a}=r.attributes;if(a!==void 0)for(let A=0,l=a.count;A<l;A++)n.isMesh?n.getVertexPosition(A,i):i.fromBufferAttribute(a,A),n.isSkinnedMesh||i.applyMatrix4(n.matrixWorld),s=e(s,i)}}),s}let xs,er,Ot,gi;function Vi(o,e=1/0,t=null){er||(er=new Cs(2,2,1,1)),Ot||(Ot=new us({uniforms:{blitTexture:new nu(o)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),Ot.uniforms.blitTexture.value=o,Ot.defines.IS_SRGB=o.colorSpace==Ee,Ot.needsUpdate=!0,gi||(gi=new Ae(er,Ot),gi.frustumCulled=!1);const s=new si,i=new It;i.add(gi),t===null&&(t=xs=new bo({antialias:!1}));const n=Math.min(o.image.width,e),r=Math.min(o.image.height,e);t.setSize(n,r),t.clear(),t.render(i,s);const a=document.createElement("canvas"),A=a.getContext("2d");a.width=n,a.height=r,A.drawImage(t.domElement,0,0,n,r);const l=new Xl(a);return l.minFilter=o.minFilter,l.magFilter=o.magFilter,l.wrapS=o.wrapS,l.wrapT=o.wrapT,l.colorSpace=o.colorSpace,l.name=o.name,xs&&(xs.forceContextLoss(),xs.dispose(),xs=null),l}const Ma={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class _o{constructor(){this.pluginCallbacks=[],this.register(function(e){return new mg(e)}),this.register(function(e){return new Ig(e)}),this.register(function(e){return new yg(e)}),this.register(function(e){return new wg(e)}),this.register(function(e){return new Qg(e)}),this.register(function(e){return new Sg(e)}),this.register(function(e){return new Eg(e)}),this.register(function(e){return new Cg(e)}),this.register(function(e){return new Bg(e)}),this.register(function(e){return new xg(e)}),this.register(function(e){return new vg(e)}),this.register(function(e){return new bg(e)}),this.register(function(e){return new Tg(e)}),this.register(function(e){return new Mg(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){const n=new pg,r=[];for(let a=0,A=this.pluginCallbacks.length;a<A;a++)r.push(this.pluginCallbacks[a](n));n.setPlugins(r),n.write(e,t,i).catch(s)}parseAsync(e,t){const s=this;return new Promise(function(i,n){s.parse(e,i,n,t)})}}const O={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},tr="KHR_mesh_quantization",Se={};Se[Es]=O.NEAREST;Se[fn]=O.NEAREST_MIPMAP_NEAREST;Se[mn]=O.NEAREST_MIPMAP_LINEAR;Se[ae]=O.LINEAR;Se[pn]=O.LINEAR_MIPMAP_NEAREST;Se[ms]=O.LINEAR_MIPMAP_LINEAR;Se[Me]=O.CLAMP_TO_EDGE;Se[mt]=O.REPEAT;Se[In]=O.MIRRORED_REPEAT;const Ra={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Ag=new oe,Da=12,lg=1179937895,cg=2,_a=8,hg=1313821514,ug=5130562;function zs(o,e){return o.length===e.length&&o.every(function(t,s){return t===e[s]})}function dg(o){return new TextEncoder().encode(o).buffer}function gg(o){return zs(o.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function fg(o,e,t){const s={min:new Array(o.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(o.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=e;i<e+t;i++)for(let n=0;n<o.itemSize;n++){let r;o.itemSize>4?r=o.array[i*o.itemSize+n]:(n===0?r=o.getX(i):n===1?r=o.getY(i):n===2?r=o.getZ(i):n===3&&(r=o.getW(i)),o.normalized===!0&&(r=Xi.normalize(r,o.array))),s.min[n]=Math.min(s.min[n],r),s.max[n]=Math.max(s.max[n],r)}return s}function Nc(o){return Math.ceil(o/4)*4}function sr(o,e=0){const t=Nc(o.byteLength);if(t!==o.byteLength){const s=new Uint8Array(t);if(s.set(new Uint8Array(o)),e!==0)for(let i=o.byteLength;i<t;i++)s[i]=e;return s.buffer}return o}function La(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function Fa(o,e){if(o.toBlob!==void 0)return new Promise(s=>o.toBlob(s,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),o.convertToBlob({type:e,quality:t})}class pg{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+ru}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,n=i.buffers,r=i.json;s=i.options;const a=i.extensionsUsed,A=i.extensionsRequired,l=new Blob(n,{type:"application/octet-stream"}),h=Object.keys(a),c=Object.keys(A);if(h.length>0&&(r.extensionsUsed=h),c.length>0&&(r.extensionsRequired=c),r.buffers&&r.buffers.length>0&&(r.buffers[0].byteLength=l.size),s.binary===!0){const u=new FileReader;u.readAsArrayBuffer(l),u.onloadend=function(){const d=sr(u.result),g=new DataView(new ArrayBuffer(_a));g.setUint32(0,d.byteLength,!0),g.setUint32(4,ug,!0);const f=sr(dg(JSON.stringify(r)),32),p=new DataView(new ArrayBuffer(_a));p.setUint32(0,f.byteLength,!0),p.setUint32(4,hg,!0);const I=new ArrayBuffer(Da),C=new DataView(I);C.setUint32(0,lg,!0),C.setUint32(4,cg,!0);const w=Da+p.byteLength+f.byteLength+g.byteLength+d.byteLength;C.setUint32(8,w,!0);const B=new Blob([I,p,f,g,d],{type:"application/octet-stream"}),m=new FileReader;m.readAsArrayBuffer(B),m.onloadend=function(){t(m.result)}}}else if(r.buffers&&r.buffers.length>0){const u=new FileReader;u.readAsDataURL(l),u.onloadend=function(){const d=u.result;r.buffers[0].uri=d,t(r)}}else t(r)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const s=this.options,i=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&n.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const r in n.gltfExtensions)t.extensions[r]=n.gltfExtensions[r],i[r]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(n){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+n.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const s=new F;for(let i=0,n=e.count;i<n;i++)if(Math.abs(s.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const s=e.clone(),i=new F;for(let n=0,r=s.count;n<r;n++)i.fromBufferAttribute(s,n),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),s.setXYZ(n,i.x,i.y,i.z);return t.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let s=!1;const i={};(t.offset.x!==0||t.offset.y!==0)&&(i.offset=t.offset.toArray(),s=!0),t.rotation!==0&&(i.rotation=t.rotation,s=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(i.scale=t.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function s(d){return d.colorSpace===Ee?function(f){return f<.04045?f*.0773993808:Math.pow(f*.9478672986+.0521327014,2.4)}:function(f){return f}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Zs&&(e=Vi(e)),t instanceof Zs&&(t=Vi(t));const i=e?e.image:null,n=t?t.image:null,r=Math.max(i?i.width:0,n?n.width:0),a=Math.max(i?i.height:0,n?n.height:0),A=La();A.width=r,A.height=a;const l=A.getContext("2d",{willReadFrequently:!0});l.fillStyle="#00ffff",l.fillRect(0,0,r,a);const h=l.getImageData(0,0,r,a);if(i){l.drawImage(i,0,0,r,a);const d=s(e),g=l.getImageData(0,0,r,a).data;for(let f=2;f<g.length;f+=4)h.data[f]=d(g[f]/256)*256}if(n){l.drawImage(n,0,0,r,a);const d=s(t),g=l.getImageData(0,0,r,a).data;for(let f=1;f<g.length;f+=4)h.data[f]=d(g[f]/256)*256}l.putImageData(h,0,0);const u=(e||t).clone();return u.source=new ou(A),u.colorSpace=Zi,u.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),u}processBuffer(e){const t=this.json,s=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,t,s,i,n){const r=this.json;r.bufferViews||(r.bufferViews=[]);let a;switch(t){case O.BYTE:case O.UNSIGNED_BYTE:a=1;break;case O.SHORT:case O.UNSIGNED_SHORT:a=2;break;default:a=4}let A=e.itemSize*a;n===O.ARRAY_BUFFER&&(A=Math.ceil(A/4)*4);const l=Nc(i*A),h=new DataView(new ArrayBuffer(l));let c=0;for(let g=s;g<s+i;g++){for(let f=0;f<e.itemSize;f++){let p;e.itemSize>4?p=e.array[g*e.itemSize+f]:(f===0?p=e.getX(g):f===1?p=e.getY(g):f===2?p=e.getZ(g):f===3&&(p=e.getW(g)),e.normalized===!0&&(p=Xi.normalize(p,e.array))),t===O.FLOAT?h.setFloat32(c,p,!0):t===O.INT?h.setInt32(c,p,!0):t===O.UNSIGNED_INT?h.setUint32(c,p,!0):t===O.SHORT?h.setInt16(c,p,!0):t===O.UNSIGNED_SHORT?h.setUint16(c,p,!0):t===O.BYTE?h.setInt8(c,p):t===O.UNSIGNED_BYTE&&h.setUint8(c,p),c+=a}c%A!==0&&(c+=A-c%A)}const u={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:l};return n!==void 0&&(u.target=n),n===O.ARRAY_BUFFER&&(u.byteStride=A),this.byteOffset+=l,r.bufferViews.push(u),{id:r.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,s=t.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(i){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const r=sr(n.result),a={buffer:t.processBuffer(r),byteOffset:t.byteOffset,byteLength:r.byteLength};t.byteOffset+=r.byteLength,i(s.bufferViews.push(a)-1)}})}processAccessor(e,t,s,i){const n=this.json,r={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=O.FLOAT;else if(e.array.constructor===Int32Array)a=O.INT;else if(e.array.constructor===Uint32Array)a=O.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=O.SHORT;else if(e.array.constructor===Uint16Array)a=O.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=O.BYTE;else if(e.array.constructor===Uint8Array)a=O.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(s===void 0&&(s=0),(i===void 0||i===1/0)&&(i=e.count),i===0)return null;const A=fg(e,s,i);let l;t!==void 0&&(l=e===t.index?O.ELEMENT_ARRAY_BUFFER:O.ARRAY_BUFFER);const h=this.processBufferView(e,a,s,i,l),c={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:i,max:A.max,min:A.min,type:r[e.itemSize]};return e.normalized===!0&&(c.normalized=!0),n.accessors||(n.accessors=[]),n.accessors.push(c)-1}processImage(e,t,s,i="image/png"){if(e!==null){const n=this,r=n.cache,a=n.json,A=n.options,l=n.pending;r.images.has(e)||r.images.set(e,{});const h=r.images.get(e),c=i+":flipY/"+s.toString();if(h[c]!==void 0)return h[c];a.images||(a.images=[]);const u={mimeType:i},d=La();d.width=Math.min(e.width,A.maxTextureSize),d.height=Math.min(e.height,A.maxTextureSize);const g=d.getContext("2d",{willReadFrequently:!0});if(s===!0&&(g.translate(0,d.height),g.scale(1,-1)),e.data!==void 0){t!==Qe&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>A.maxTextureSize||e.height>A.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const p=new Uint8ClampedArray(e.height*e.width*4);for(let I=0;I<p.length;I+=4)p[I+0]=e.data[I+0],p[I+1]=e.data[I+1],p[I+2]=e.data[I+2],p[I+3]=e.data[I+3];g.putImageData(new ImageData(p,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)g.drawImage(e,0,0,d.width,d.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");A.binary===!0?l.push(Fa(d,i).then(p=>n.processBufferViewImage(p)).then(p=>{u.bufferView=p})):d.toDataURL!==void 0?u.uri=d.toDataURL(i):l.push(Fa(d,i).then(p=>new FileReader().readAsDataURL(p)).then(p=>{u.uri=p}));const f=a.images.push(u)-1;return h[c]=f,f}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const s={magFilter:Se[e.magFilter],minFilter:Se[e.minFilter],wrapS:Se[e.wrapS],wrapT:Se[e.wrapT]};return t.samplers.push(s)-1}processTexture(e){const s=this.options,i=this.cache,n=this.json;if(i.textures.has(e))return i.textures.get(e);n.textures||(n.textures=[]),e instanceof Zs&&(e=Vi(e,s.maxTextureSize));let r=e.userData.mimeType;r==="image/webp"&&(r="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,r)};e.name&&(a.name=e.name),this._invokeAll(function(l){l.writeTexture&&l.writeTexture(e,a)});const A=n.textures.push(a)-1;return i.textures.set(e,A),A}processMaterial(e){const t=this.cache,s=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const n=e.color.toArray().concat([e.opacity]);if(zs(n,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),A={index:this.processTexture(a),channel:a.channel};this.applyTextureTransform(A,a),i.pbrMetallicRoughness.metallicRoughnessTexture=A}if(e.map){const a={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(a,e.map),i.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive;if(Math.max(a.r,a.g,a.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const l={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(l,e.emissiveMap),i.emissiveTexture=l}}if(e.normalMap){const a={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),i.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),i.occlusionTexture=a}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===ft&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,i)});const r=s.materials.push(i)-1;return t.materials.set(e,r),r}processMesh(e){const t=this.cache,s=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let B=0,m=e.material.length;B<m;B++)i.push(e.material[B].uuid);else i.push(e.material.uuid);const n=i.join(":");if(t.meshes.has(n))return t.meshes.get(n);const r=e.geometry;let a;e.isLineSegments?a=O.LINES:e.isLineLoop?a=O.LINE_LOOP:e.isLine?a=O.LINE_STRIP:e.isPoints?a=O.POINTS:a=e.material.wireframe?O.LINES:O.TRIANGLES;const A={},l={},h=[],c=[],u={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=r.getAttribute("normal");d!==void 0&&!this.isNormalizedNormalAttribute(d)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),r.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let g=null;for(let B in r.attributes){if(B.slice(0,5)==="morph")continue;const m=r.attributes[B];if(B=u[B]||B.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(B)||(B="_"+B),t.attributes.has(this.getUID(m))){l[B]=t.attributes.get(this.getUID(m));continue}g=null;const Q=m.array;B==="JOINTS_0"&&!(Q instanceof Uint16Array)&&!(Q instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new Te(new Uint16Array(Q),m.itemSize,m.normalized));const E=this.processAccessor(g||m,r);E!==null&&(B.startsWith("_")||this.detectMeshQuantization(B,m),l[B]=E,t.attributes.set(this.getUID(m),E))}if(d!==void 0&&r.setAttribute("normal",d),Object.keys(l).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const B=[],m=[],y={};if(e.morphTargetDictionary!==void 0)for(const Q in e.morphTargetDictionary)y[e.morphTargetDictionary[Q]]=Q;for(let Q=0;Q<e.morphTargetInfluences.length;++Q){const E={};let S=!1;for(const v in r.morphAttributes){if(v!=="position"&&v!=="normal"){S||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),S=!0);continue}const R=r.morphAttributes[v][Q],_=v.toUpperCase(),N=r.attributes[v];if(t.attributes.has(this.getUID(R,!0))){E[_]=t.attributes.get(this.getUID(R,!0));continue}const T=R.clone();if(!r.morphTargetsRelative)for(let M=0,L=R.count;M<L;M++)for(let D=0;D<R.itemSize;D++)D===0&&T.setX(M,R.getX(M)-N.getX(M)),D===1&&T.setY(M,R.getY(M)-N.getY(M)),D===2&&T.setZ(M,R.getZ(M)-N.getZ(M)),D===3&&T.setW(M,R.getW(M)-N.getW(M));E[_]=this.processAccessor(T,r),t.attributes.set(this.getUID(N,!0),E[_])}c.push(E),B.push(e.morphTargetInfluences[Q]),e.morphTargetDictionary!==void 0&&m.push(y[Q])}A.weights=B,m.length>0&&(A.extras={},A.extras.targetNames=m)}const f=Array.isArray(e.material);if(f&&r.groups.length===0)return null;let p=!1;if(f&&r.index===null){const B=[];for(let m=0,y=r.attributes.position.count;m<y;m++)B[m]=m;r.setIndex(B),p=!0}const I=f?e.material:[e.material],C=f?r.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let B=0,m=C.length;B<m;B++){const y={mode:a,attributes:l};if(this.serializeUserData(r,y),c.length>0&&(y.targets=c),r.index!==null){let E=this.getUID(r.index);(C[B].start!==void 0||C[B].count!==void 0)&&(E+=":"+C[B].start+":"+C[B].count),t.attributes.has(E)?y.indices=t.attributes.get(E):(y.indices=this.processAccessor(r.index,r,C[B].start,C[B].count),t.attributes.set(E,y.indices)),y.indices===null&&delete y.indices}const Q=this.processMaterial(I[C[B].materialIndex]);Q!==null&&(y.material=Q),h.push(y)}p===!0&&r.setIndex(null),A.primitives=h,s.meshes||(s.meshes=[]),this._invokeAll(function(B){B.writeMesh&&B.writeMesh(e,A)});const w=s.meshes.push(A)-1;return t.meshes.set(n,w),w}detectMeshQuantization(e,t){if(this.extensionsUsed[tr])return;let s;switch(t.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}t.normalized&&(s+=" normalized");const i=e.split("_",1)[0];Ma[i]&&Ma[i].includes(s)&&(this.extensionsUsed[tr]=!0,this.extensionsRequired[tr]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const s=e.isOrthographicCamera,i={type:s?"orthographic":"perspective"};return s?i.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:Xi.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const s=this.json,i=this.nodeMap;s.animations||(s.animations=[]),e=_o.Utils.mergeMorphTargetTracks(e.clone(),t);const n=e.tracks,r=[],a=[];for(let A=0;A<n.length;++A){const l=n[A],h=ti.parseTrackName(l.name);let c=ti.findNode(t,h.nodeName);const u=Ra[h.propertyName];if(h.objectName==="bones"&&(c.isSkinnedMesh===!0?c=c.skeleton.getBoneByName(h.objectIndex):c=void 0),!c||!u){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name);continue}const d=1;let g=l.values.length/l.times.length;u===Ra.morphTargetInfluences&&(g/=c.morphTargetInfluences.length);let f;l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(f="CUBICSPLINE",g/=3):l.getInterpolation()===Jl?f="STEP":f="LINEAR",a.push({input:this.processAccessor(new Te(l.times,d)),output:this.processAccessor(new Te(l.values,g)),interpolation:f}),r.push({sampler:a.length-1,target:{node:i.get(c),path:u}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:a,channels:r}),s.animations.length-1}processSkin(e){const t=this.json,s=this.nodeMap,i=t.nodes[s.get(e)],n=e.skeleton;if(n===void 0)return null;const r=e.skeleton.bones[0];if(r===void 0)return null;const a=[],A=new Float32Array(n.bones.length*16),l=new Ve;for(let c=0;c<n.bones.length;++c)a.push(s.get(n.bones[c])),l.copy(n.boneInverses[c]),l.multiply(e.bindMatrix).toArray(A,c*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new Te(A,16)),joints:a,skeleton:s.get(r)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,s=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(s.trs){const a=e.quaternion.toArray(),A=e.position.toArray(),l=e.scale.toArray();zs(a,[0,0,0,1])||(n.rotation=a),zs(A,[0,0,0])||(n.translation=A),zs(l,[1,1,1])||(n.scale=l)}else e.matrixAutoUpdate&&e.updateMatrix(),gg(e.matrix)===!1&&(n.matrix=e.matrix.elements);if(e.name!==""&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(n.mesh=a)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let A=0,l=e.children.length;A<l;A++){const h=e.children[A];if(h.visible||s.onlyVisible===!1){const c=this.processNode(h);c!==null&&a.push(c)}}a.length>0&&(n.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,n)});const r=t.nodes.push(n)-1;return i.set(e,r),r}processScene(e){const t=this.json,s=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};e.name!==""&&(i.name=e.name),t.scenes.push(i);const n=[];for(let r=0,a=e.children.length;r<a;r++){const A=e.children[r];if(A.visible||s.onlyVisible===!1){const l=this.processNode(A);l!==null&&n.push(l)}}n.length>0&&(i.nodes=n),this.serializeUserData(e,i)}processObjects(e){const t=new It;t.name="AuxScene";for(let s=0;s<e.length;s++)t.children.push(e[s]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const s=[];for(let i=0;i<e.length;i++)e[i]instanceof It?this.processScene(e[i]):s.push(e[i]);s.length>0&&this.processObjects(s);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let t=0,s=this.plugins.length;t<s;t++)e(this.plugins[t])}}class mg{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const s=this.writer,i=s.json,n=s.extensionsUsed,r={};e.name&&(r.name=e.name),r.color=e.color.toArray(),r.intensity=e.intensity,e.isDirectionalLight?r.type="directional":e.isPointLight?(r.type="point",e.distance>0&&(r.range=e.distance)):e.isSpotLight&&(r.type="spot",e.distance>0&&(r.range=e.distance),r.spot={},r.spot.innerConeAngle=(1-e.penumbra)*e.angle,r.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},n[this.name]=!0);const a=i.extensions[this.name].lights;a.push(r),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class Ig{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Eg{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const r={index:s.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(r,e.clearcoatMap),n.clearcoatTexture=r}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const r={index:s.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(r,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=r}if(e.clearcoatNormalMap){const r={index:s.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(r.scale=e.clearcoatNormalScale.x),s.applyTextureTransform(r,e.clearcoatNormalMap),n.clearcoatNormalTexture=r}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Cg{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;const i=this.writer.extensionsUsed,n={};n.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Bg{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const r={index:s.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(r,e.iridescenceMap),n.iridescenceTexture=r}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const r={index:s.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(r,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=r}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class yg{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const r={index:s.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(r,e.transmissionMap),n.transmissionTexture=r}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class wg{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const r={index:s.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(r,e.thicknessMap),n.thicknessTexture=r}e.attenuationDistance!==1/0&&(n.attenuationDistance=e.attenuationDistance),n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Qg{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const i=this.writer.extensionsUsed,n={};n.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Sg{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(Ag)&&!e.specularIntensityMap&&!e.specularColorMap)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.specularIntensityMap){const r={index:s.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(r,e.specularIntensityMap),n.specularTexture=r}if(e.specularColorMap){const r={index:s.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(r,e.specularColorMap),n.specularColorTexture=r}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class xg{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.sheenRoughnessMap){const r={index:s.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(r,e.sheenRoughnessMap),n.sheenRoughnessTexture=r}if(e.sheenColorMap){const r={index:s.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(r,e.sheenColorMap),n.sheenColorTexture=r}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class vg{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.anisotropyMap){const r={index:s.processTexture(e.anisotropyMap)};s.applyTextureTransform(r,e.anisotropyMap),n.anisotropyTexture=r}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class bg{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const i=this.writer.extensionsUsed,n={};n.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Tg{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.bumpMap){const r={index:s.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};s.applyTextureTransform(r,e.bumpMap),n.bumpTexture=r}n.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Mg{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const s=this.writer,i=e,n=new Float32Array(i.count*3),r=new Float32Array(i.count*4),a=new Float32Array(i.count*3),A=new Ve,l=new F,h=new Is,c=new F;for(let d=0;d<i.count;d++)i.getMatrixAt(d,A),A.decompose(l,h,c),l.toArray(n,d*3),h.toArray(r,d*4),c.toArray(a,d*3);const u={TRANSLATION:s.processAccessor(new Te(n,3)),ROTATION:s.processAccessor(new Te(r,4)),SCALE:s.processAccessor(new Te(a,3))};i.instanceColor&&(u._COLOR_0=s.processAccessor(i.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:u},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}}_o.Utils={insertKeyframe:function(o,e){const s=o.getValueSize(),i=new o.TimeBufferType(o.times.length+1),n=new o.ValueBufferType(o.values.length+s),r=o.createInterpolant(new o.ValueBufferType(s));let a;if(o.times.length===0){i[0]=e;for(let A=0;A<s;A++)n[A]=0;a=0}else if(e<o.times[0]){if(Math.abs(o.times[0]-e)<.001)return 0;i[0]=e,i.set(o.times,1),n.set(r.evaluate(e),0),n.set(o.values,s),a=0}else if(e>o.times[o.times.length-1]){if(Math.abs(o.times[o.times.length-1]-e)<.001)return o.times.length-1;i[i.length-1]=e,i.set(o.times,0),n.set(o.values,0),n.set(r.evaluate(e),o.values.length),a=i.length-1}else for(let A=0;A<o.times.length;A++){if(Math.abs(o.times[A]-e)<.001)return A;if(o.times[A]<e&&o.times[A+1]>e){i.set(o.times.slice(0,A+1),0),i[A+1]=e,i.set(o.times.slice(A+1),A+2),n.set(o.values.slice(0,(A+1)*s),0),n.set(r.evaluate(e),(A+1)*s),n.set(o.values.slice((A+1)*s),(A+2)*s),a=A+1;break}}return o.times=i,o.values=n,a},mergeMorphTargetTracks:function(o,e){const t=[],s={},i=o.tracks;for(let n=0;n<i.length;++n){let r=i[n];const a=ti.parseTrackName(r.name),A=ti.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(r);continue}if(r.createInterpolant!==r.InterpolantFactoryMethodDiscrete&&r.createInterpolant!==r.InterpolantFactoryMethodLinear){if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),r=r.clone(),r.setInterpolation(So)}const l=A.morphTargetInfluences.length,h=A.morphTargetDictionary[a.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let c;if(s[A.uuid]===void 0){c=r.clone();const d=new c.ValueBufferType(l*c.times.length);for(let g=0;g<c.times.length;g++)d[g*l+h]=c.values[g];c.name=(a.nodeName||"")+".morphTargetInfluences",c.values=d,s[A.uuid]=c,t.push(c);continue}const u=r.createInterpolant(new r.ValueBufferType(1));c=s[A.uuid];for(let d=0;d<c.times.length;d++)c.values[d*l+h]=u.evaluate(c.times[d]);for(let d=0;d<r.times.length;d++){const g=this.insertKeyframe(c,r.times[d]);c.values[g*l+h]=r.values[d]}}return o.tracks=t,o}};/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na=o=>o.material!==void 0&&o.userData&&o.userData.variantMaterials&&!!Array.from(o.userData.variantMaterials.values()).filter(e=>qi(e.material)),qi=o=>o&&o.isMaterial&&!Array.isArray(o);class Rg{constructor(e){this.writer=e,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(e){const t=new Set;for(const s of e)s.traverse(i=>{if(!Na(i))return;const n=i.userData.variantMaterials,r=i.userData.variantData;for(const[a,A]of r){const l=n.get(A.index);l&&qi(l.material)&&t.add(a)}});t.forEach(s=>this.variantNames.push(s))}writeMesh(e,t){if(!Na(e))return;const s=e.userData,i=s.variantMaterials,n=s.variantData,r=new Map,a=new Map,A=Array.from(n.values()).sort((c,u)=>c.index-u.index);for(const[c,u]of A.entries())a.set(u.index,c);for(const c of n.values()){const u=i.get(c.index);if(!u||!qi(u.material))continue;const d=this.writer.processMaterial(u.material);r.has(d)||r.set(d,{material:d,variants:[]}),r.get(d).variants.push(a.get(c.index))}const l=Array.from(r.values()).map(c=>c.variants.sort((u,d)=>u-d)&&c).sort((c,u)=>c.material-u.material);if(l.length===0)return;const h=qi(s.originalMaterial)?this.writer.processMaterial(s.originalMaterial):-1;for(const c of t.primitives)h>=0&&(c.material=h),c.extensions=c.extensions||{},c.extensions[this.name]={mappings:l}}afterParse(){if(this.variantNames.length===0)return;const e=this.writer.json;e.extensions=e.extensions||{};const t=this.variantNames.map(s=>({name:s}));e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}}class Dg{constructor(e,t,s,i,n){this.xrLight=e,this.renderer=t,this.lightProbe=s,this.xrWebGLBinding=null,this.estimationStartCallback=n,this.frameCallback=this.onXRFrame.bind(this);const r=t.xr.getSession();if(i&&"XRWebGLBinding"in window){const a=new Zl(16);e.environment=a.texture;const A=t.getContext();switch(r.preferredReflectionFormat){case"srgba8":A.getExtension("EXT_sRGB");break;case"rgba16f":A.getExtension("OES_texture_half_float");break}this.xrWebGLBinding=new XRWebGLBinding(r,A),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}r.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const i=t.getLightEstimate(this.lightProbe);if(i){this.xrLight.lightProbe.sh.fromArray(i.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const n=Math.max(1,Math.max(i.primaryLightIntensity.x,Math.max(i.primaryLightIntensity.y,i.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(i.primaryLightIntensity.x/n,i.primaryLightIntensity.y/n,i.primaryLightIntensity.z/n),this.xrLight.directionalLight.intensity=n,this.xrLight.directionalLight.position.copy(i.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class _g extends Oi{constructor(e,t=!0){super(),this.lightProbe=new au,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new zl,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let s=null,i=!1;e.xr.addEventListener("sessionstart",()=>{const n=e.xr.getSession();"requestLightProbe"in n&&n.requestLightProbe({reflectionFormat:n.preferredReflectionFormat}).then(r=>{s=new Dg(this,e,r,t,()=>{i=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{s&&(s.dispose(),s=null),i&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{s&&(s.dispose(),s=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kc=1e4,Lg=.001,Uc=50;class Ie{constructor(e=Uc){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(Lg,e)}update(e,t,s,i){const n=2e-4*this.naturalFrequency;if(e==null||i===0||e===t&&this.velocity===0)return t;if(s<0)return e;const r=e-t,a=this.velocity+this.naturalFrequency*r,A=r+s*a,l=Math.exp(-this.naturalFrequency*s),h=(a-this.naturalFrequency*A)*l,c=-this.naturalFrequency*(h+a*l);return Math.abs(h)<n*Math.abs(i)&&c*r>=0?(this.velocity=0,t):(this.velocity=h,t+A*l)}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ke=.2,ka=.03,Fg=.75,Gc=12,Ng=Math.PI/(2*Gc),Ua=new Re,fi=(o,e,t)=>{let s=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let i=0;i<=Gc;++i)o.push(e+(ke-ka)*Math.cos(s),t+(ke-ka)*Math.sin(s),0,e+ke*Math.cos(s),t+ke*Math.sin(s),0),s+=Ng};class Ga extends Ae{constructor(e,t){const s=new dn,i=[],n=[],{size:r,boundingBox:a}=e,A=r.x/2,l=(t==="back"?r.y:r.z)/2;fi(n,A,l),fi(n,-A,l),fi(n,-A,-l),fi(n,A,-l);const h=n.length/3;for(let d=0;d<h-2;d+=2)i.push(d,d+1,d+3,d,d+3,d+2);const c=h-2;i.push(c,c+1,1,c,1,0),s.setAttribute("position",new Au(n,3)),s.setIndex(i),super(s),this.side=t;const u=this.material;switch(u.side=ft,u.transparent=!0,u.opacity=0,this.goalOpacity=0,this.opacityDamper=new Ie,this.hitPlane=new Ae(new Cs(2*(A+ke),2*(l+ke))),this.hitPlane.visible=!1,this.hitPlane.material.side=ft,this.add(this.hitPlane),this.hitBox=new Ae(new Cn(r.x+2*ke,r.y+ke,r.z+2*ke)),this.hitBox.visible=!1,this.hitBox.material.side=ft,this.add(this.hitBox),a.getCenter(this.position),t){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=a.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=a.min.z,this.position.z=this.shadowHeight}e.target.add(this),this.hitBox.position.y=(r.y+ke)/2+a.min.y,e.target.add(this.hitBox),this.offsetHeight=0}getHit(e,t,s){Ua.set(t,-s),this.hitPlane.visible=!0;const i=e.positionAndNormalFromPoint(Ua,this.hitPlane);return this.hitPlane.visible=!1,i==null?null:i.position}getExpandedHit(e,t,s){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const i=this.getHit(e,t,s);return this.hitPlane.scale.set(1,1,1),i}controllerIntersection(e,t){this.hitBox.visible=!0;const s=e.hitFromController(t,this.hitBox);return this.hitBox.visible=!1,s}set offsetHeight(e){e-=.001,this.side==="back"?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this.side==="back"?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.goalOpacity=e?Fg:0}updateOpacity(e){const t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}dispose(){const{geometry:e,material:t}=this.hitPlane;e.dispose(),t.dispose(),this.hitBox.geometry.dispose(),this.hitBox.material.dispose(),this.geometry.dispose(),this.material.dispose(),this.hitBox.removeFromParent(),this.removeFromParent()}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const de=(o,e)=>({type:"number",number:o,unit:e}),nt=(()=>{const o={};return t=>{const s=t;if(s in o)return o[s];const i=[];let n=0;for(;t;){if(++n>1e3){t="";break}const r=Oc(t),a=r.nodes[0];if(a==null||a.terms.length===0)break;i.push(a),t=r.remainingInput}return o[s]=i}})(),Oc=(()=>{const o=/^(\-\-|[a-z\u0240-\uffff])/i,e=/^([\*\+\/]|[\-]\s)/i,t=/^[\),]/,s="(",i="#";return n=>{const r=[];for(;n.length&&(n=n.trim(),!t.test(n));)if(n[0]===s){const{nodes:a,remainingInput:A}=Oa(n);n=A,r.push({type:"function",name:{type:"ident",value:"calc"},arguments:a})}else if(o.test(n)){const a=kg(n),A=a.nodes[0];if(n=a.remainingInput,n[0]===s){const{nodes:l,remainingInput:h}=Oa(n);r.push({type:"function",name:A,arguments:l}),n=h}else r.push(A)}else if(e.test(n))r.push({type:"operator",value:n[0]}),n=n.slice(1);else{const{nodes:a,remainingInput:A}=n[0]===i?Gg(n):Ug(n);if(a.length===0)break;r.push(a[0]),n=A}return{nodes:[{type:"expression",terms:r}],remainingInput:n}}})(),kg=(()=>{const o=/[^a-z0-9_\-\u0240-\uffff]/i;return e=>{const t=e.match(o),s=t==null?e:e.substr(0,t.index),i=t==null?"":e.substr(t.index);return{nodes:[{type:"ident",value:s}],remainingInput:i}}})(),Ug=(()=>{const o=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,e=/^[a-z%]+/i,t=/^(m|mm|cm|rad|deg|[%])$/;return s=>{const i=s.match(o),n=i==null?"0":i[0];s=n==null?s:s.slice(n.length);const r=s.match(e);let a=r!=null&&r[0]!==""?r[0]:null;const A=r==null?s:s.slice(a.length);return a!=null&&!t.test(a)&&(a=null),{nodes:[{type:"number",number:parseFloat(n)||0,unit:a}],remainingInput:A}}})(),Gg=(()=>{const o=/^[a-f0-9]*/i;return e=>{e=e.slice(1).trim();const t=e.match(o);return{nodes:t==null?[]:[{type:"hex",value:t[0]}],remainingInput:t==null?e:e.slice(t[0].length)}}})(),Oa=o=>{const e=[];for(o=o.slice(1).trim();o.length;){const t=Oc(o);if(e.push(t.nodes[0]),o=t.remainingInput.trim(),o[0]===",")o=o.slice(1).trim();else if(o[0]===")"){o=o.slice(1);break}}return{nodes:e,remainingInput:o}},Pa=Symbol("visitedTypes");class Og{constructor(e){this[Pa]=e}walk(e,t){const s=e.slice();for(;s.length;){const i=s.shift();switch(this[Pa].indexOf(i.type)>-1&&t(i),i.type){case"expression":s.unshift(...i.terms);break;case"function":s.unshift(i.name,...i.arguments);break}}}}const Et=Object.freeze({type:"number",number:0,unit:null});/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wn=(o,e=0)=>{let{number:t,unit:s}=o;if(!isFinite(t))t=e,s="rad";else if(o.unit==="rad"||o.unit==null)return o;return{type:"number",number:(s==="deg"&&t!=null?t:0)*Math.PI/180,unit:"rad"}},Ha=(o,e=0)=>{let{number:t,unit:s}=o;if(!isFinite(t))t=e,s="m";else if(o.unit==="m")return o;let i;switch(s){default:i=1;break;case"cm":i=1/100;break;case"mm":i=1/1e3;break}return{type:"number",number:i*t,unit:"m"}},He=(()=>{const o=t=>t,e={rad:o,deg:wn,m:o,mm:Ha,cm:Ha};return(t,s=Et)=>{isFinite(t.number)||(t.number=s.number,t.unit=s.unit);const{unit:i}=t;if(i==null)return t;const n=e[i];return n==null?s:n(t)}})();/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pc,$a,Va;const Bs=Symbol("evaluate"),Ki=Symbol("lastValue");class X{constructor(){this[Pc]=null}static evaluatableFor(e,t=Et){if(e instanceof X)return e;if(e.type==="number")return e.unit==="%"?new Pg(e,t):e;switch(e.name.value){case"calc":return new Vg(e,t);case"env":return new Hg(e)}return Et}static evaluate(e){return e instanceof X?e.evaluate():e}static isConstant(e){return e instanceof X?e.isConstant:!0}static applyIntrinsics(e,t){const{basis:s,keywords:i}=t,{auto:n}=i;return s.map((r,a)=>{const A=n[a]==null?r:n[a];let l=e[a]?e[a]:A;if(l.type==="ident"){const h=l.value;h in i&&(l=i[h][a])}return(l==null||l.type==="ident")&&(l=A),l.unit==="%"?de(l.number/100*r.number,r.unit):(l=He(l,r),l.unit!==r.unit?r:l)})}get isConstant(){return!1}evaluate(){return(!this.isConstant||this[Ki]==null)&&(this[Ki]=this[Bs]()),this[Ki]}}Pc=Ki;const qa=Symbol("percentage"),ir=Symbol("basis");class Pg extends X{constructor(e,t){super(),this[qa]=e,this[ir]=t}get isConstant(){return!0}[Bs](){return de(this[qa].number/100*this[ir].number,this[ir].unit)}}const pi=Symbol("identNode");class Hg extends X{constructor(e){super(),this[$a]=null;const t=e.arguments.length?e.arguments[0].terms[0]:null;t!=null&&t.type==="ident"&&(this[pi]=t)}get isConstant(){return!1}[($a=pi,Bs)](){if(this[pi]!=null)switch(this[pi].value){case"window-scroll-y":const e=window.pageYOffset,t=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);return{type:"number",number:e/(t-window.innerHeight)||0,unit:null}}return Et}}const $g=/[\*\/]/,Pt=Symbol("evaluator");class Vg extends X{constructor(e,t=Et){if(super(),this[Va]=null,e.arguments.length!==1)return;const s=e.arguments[0].terms.slice(),i=[];for(;s.length;){const n=s.shift();if(i.length>0){const r=i[i.length-1];if(r.type==="operator"&&$g.test(r.value)){const a=i.pop(),A=i.pop();if(A==null)return;i.push(new za(a,X.evaluatableFor(A,t),X.evaluatableFor(n,t)));continue}}i.push(n.type==="operator"?n:X.evaluatableFor(n,t))}for(;i.length>2;){const[n,r,a]=i.splice(0,3);if(r.type!=="operator")return;i.unshift(new za(r,X.evaluatableFor(n,t),X.evaluatableFor(a,t)))}i.length===1&&(this[Pt]=i[0])}get isConstant(){return this[Pt]==null||X.isConstant(this[Pt])}[(Va=Pt,Bs)](){return this[Pt]!=null?X.evaluate(this[Pt]):Et}}const Ka=Symbol("operator"),nr=Symbol("left"),rr=Symbol("right");class za extends X{constructor(e,t,s){super(),this[Ka]=e,this[nr]=t,this[rr]=s}get isConstant(){return X.isConstant(this[nr])&&X.isConstant(this[rr])}[Bs](){const e=He(X.evaluate(this[nr])),t=He(X.evaluate(this[rr])),{number:s,unit:i}=e,{number:n,unit:r}=t;if(r!=null&&i!=null&&r!=i)return Et;const a=i||r;let A;switch(this[Ka].value){case"+":A=s+n;break;case"-":A=s-n;break;case"/":A=s/n;break;case"*":A=s*n;break;default:return Et}return{type:"number",number:A,unit:a}}}const or=Symbol("evaluatables"),Ya=Symbol("intrinsics");class Hc extends X{constructor(e,t){super(),this[Ya]=t;const s=e[0],i=s!=null?s.terms:[];this[or]=t.basis.map((n,r)=>{const a=i[r];return a==null?{type:"ident",value:"auto"}:a.type==="ident"?a:X.evaluatableFor(a,n)})}get isConstant(){for(const e of this[or])if(!X.isConstant(e))return!1;return!0}[Bs](){const e=this[or].map(t=>X.evaluate(t));return X.applyIntrinsics(e,this[Ya]).map(t=>t.number)}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $c,Vc,qc,Kc;const Ht=Symbol("instances"),Ja=Symbol("activateListener"),Wa=Symbol("deactivateListener"),ar=Symbol("notifyInstances"),ja=Symbol("notify"),Xa=Symbol("callback");class Ne{constructor(e){this[Xa]=e}static[ar](){for(const e of Ne[Ht])e[ja]()}static[($c=Ht,Ja)](){window.addEventListener("scroll",this[ar],{passive:!0})}static[Wa](){window.removeEventListener("scroll",this[ar])}observe(){Ne[Ht].size===0&&Ne[Ja](),Ne[Ht].add(this)}disconnect(){Ne[Ht].delete(this),Ne[Ht].size===0&&Ne[Wa]()}[ja](){this[Xa]()}}Ne[$c]=new Set;const Za=Symbol("computeStyleCallback"),zc=Symbol("astWalker"),Ys=Symbol("dependencies"),Yc=Symbol("onScroll");class qg{constructor(e){this[Vc]={},this[qc]=new Og(["function"]),this[Kc]=()=>{this[Za]({relatedState:"window-scroll"})},this[Za]=e}observeEffectsFor(e){const t={},s=this[Ys];this[zc].walk(e,i=>{const{name:n}=i,a=i.arguments[0].terms[0];if(!(n.value!=="env"||a==null||a.type!=="ident"))switch(a.value){case"window-scroll-y":if(t["window-scroll"]==null){const A="window-scroll"in s?s["window-scroll"]:new Ne(this[Yc]);A.observe(),delete s["window-scroll"],t["window-scroll"]=A}break}});for(const i in s)s[i].disconnect();this[Ys]=t}dispose(){for(const e in this[Ys])this[Ys][e].disconnect()}}Vc=Ys,qc=zc,Kc=Yc;/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const At=o=>{const e=o.observeEffects||!1,t=o.intrinsics instanceof Function?o.intrinsics:()=>o.intrinsics;return(s,i)=>{const n=s.updated,r=s.connectedCallback,a=s.disconnectedCallback,A=Symbol(`${i}StyleEffector`),l=Symbol(`${i}StyleEvaluator`),h=Symbol(`${i}UpdateEvaluator`),c=Symbol(`${i}EvaluateAndSync`);Object.defineProperties(s,{[A]:{value:null,writable:!0},[l]:{value:null,writable:!0},[h]:{value:function(){const u=nt(this[i]);this[l]=new Hc(u,t(this)),this[A]==null&&e&&(this[A]=new qg(()=>this[c]())),this[A]!=null&&this[A].observeEffectsFor(u)}},[c]:{value:function(){if(this[l]==null)return;const u=this[l].evaluate();this[o.updateHandler](u)}},updated:{value:function(u){u.has(i)&&(this[h](),this[c]()),n.call(this,u)}},connectedCallback:{value:function(){r.call(this),this.requestUpdate(i,this[i])}},disconnectedCallback:{value:function(){a.call(this),this[A]!=null&&(this[A].dispose(),this[A]=null)}}})}};/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jc=o=>o<.5?2*o*o:-1+(4-2*o)*o,Kg=(o,e,t=Jc)=>s=>o+(e-o)*t(s),zg=(o,e)=>{const t=i=>n=>i+=n,s=e.map(t(0));return i=>{i=Ue(i,0,1),i*=s[s.length-1];const n=s.findIndex(A=>A>=i),r=n<1?0:s[n-1],a=s[n];return o[n]((i-r)/(a-r))}},rs=o=>{const e=[],t=[];let s=o.initialValue;for(let i=0;i<o.keyframes.length;++i){const n=o.keyframes[i],{value:r,frames:a}=n,A=n.ease||Jc,l=Kg(s,r,A);e.push(l),t.push(a),s=r}return zg(e,t)};/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ee=function(o,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(o,e,t,s);else for(var a=o.length-1;a>=0;a--)(r=o[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const Yg=5e3,Jg=rs({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),Wg=rs({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),jg=30,Xg=12,Wc="0deg 75deg 105%",Zg="auto auto auto",ef="auto",tf=2.2,sf=["front","right","back","left"],nf=["upper-","","lower-"],rf=3e3,of=". Use mouse, touch or arrow keys to move.",mi={AUTO:"auto",NONE:"none"},Ar={BASIC:"basic",WIGGLE:"wiggle"},af={PAN_Y:"pan-y",PAN_X:"pan-x",NONE:"none"},eA=()=>({basis:[wn(de(jg,"deg"))],keywords:{auto:[null]}}),Af=()=>({basis:[wn(de(Xg,"deg"))],keywords:{auto:[null]}}),jc=(()=>{const o=nt(Wc)[0].terms,e=He(o[0]),t=He(o[1]);return s=>{const i=s[x].idealCameraDistance();return{basis:[e,t,de(i,"m")],keywords:{auto:[null,null,de(105,"%")]}}}})(),lf=o=>{const e=tf*o[x].boundingSphere.radius;return{basis:[de(-1/0,"rad"),de(0,"rad"),de(e,"m")],keywords:{auto:[null,null,null]}}},cf=o=>{const e=jc(o),s=new Hc([],e).evaluate()[2];return{basis:[de(1/0,"rad"),de(Math.PI,"rad"),de(s,"m")],keywords:{auto:[null,null,null]}}},hf=o=>{const e=o[x].boundingBox.getCenter(new F);return{basis:[de(e.x,"m"),de(e.y,"m"),de(e.z,"m")],keywords:{auto:[null,null,null]}}},Xc=Math.PI/2,uf=Math.PI/3,df=Xc/2,gf=2*Math.PI,z=Symbol("controls"),zi=Symbol("panElement"),lr=Symbol("promptElement"),Ii=Symbol("promptAnimatedContainer"),cr=Symbol("fingerAnimatedContainers"),Ei=Symbol("deferInteractionPrompt"),tA=Symbol("updateAria"),We=Symbol("a11y"),sA=Symbol("updateA11y"),iA=Symbol("updateCameraForRadius"),$t=Symbol("cancelPrompts"),hr=Symbol("onChange"),vs=Symbol("onPointerChange"),wt=Symbol("waitingToPromptUser"),Ci=Symbol("userHasInteracted"),Vt=Symbol("promptElementVisibleTime"),bs=Symbol("lastPromptOffset"),Bi=Symbol("cancellationSource"),ur=Symbol("lastSpherical"),Ts=Symbol("jumpCamera"),dr=Symbol("initialized"),Ms=Symbol("maintainThetaPhi"),nA=Symbol("syncCameraOrbit"),rA=Symbol("syncFieldOfView"),oA=Symbol("syncCameraTarget"),aA=Symbol("syncMinCameraOrbit"),AA=Symbol("syncMaxCameraOrbit"),lA=Symbol("syncMinFieldOfView"),cA=Symbol("syncMaxFieldOfView"),ff=o=>{var e,t,s,i,n,r,a,A,l,h,c,u,d,g,f,p,I,C;class w extends o{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=Wc,this.cameraTarget=Zg,this.fieldOfView=ef,this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=rf,this.interactionPrompt=mi.AUTO,this.interactionPromptStyle=Ar.WIGGLE,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.touchAction=af.NONE,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=Uc,this.a11y=null,this[e]=this.shadowRoot.querySelector(".interaction-prompt"),this[t]=this.shadowRoot.querySelector("#prompt"),this[s]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[i]=this.shadowRoot.querySelector(".pan-target"),this[n]=0,this[r]=1/0,this[a]=!1,this[A]=!1,this[l]=Z.AUTOMATIC,this[h]=new Ef(this[x].camera,this[_e],this[x]),this[c]=new Pi,this[u]=!1,this[d]=!1,this[g]=!1,this[f]={},this[p]=()=>{const m=this[z].changeSource;this[Bi]=m,m===Z.USER_INTERACTION&&(this[Ci]=!0,this[Ei]())},this[I]=()=>{this[tA](),this[ue]();const m=this[z].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:m}}))},this[C]=m=>{this[Wi].classList.toggle("pointer-tumbling",m.type==="pointer-change-start")}}get inputSensitivity(){return this[z].inputSensitivity}set inputSensitivity(m){this[z].inputSensitivity=m}getCameraOrbit(){const{theta:m,phi:y,radius:Q}=this[ur];return{theta:m,phi:y,radius:Q,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return ut(this[Y].isPresenting?this[Y].arRenderer.target:this[x].getDynamicTarget())}getFieldOfView(){return this[z].getFieldOfView()}getMinimumFieldOfView(){return this[z].options.minimumFieldOfView}getMaximumFieldOfView(){return this[z].options.maximumFieldOfView}getIdealAspect(){return this[x].idealAspect}jumpCameraToGoal(){this[Ts]=!0,this.requestUpdate(Ts,!1)}resetInteractionPrompt(){this[bs]=0,this[Vt]=1/0,this[Ci]=!1,this[wt]=this.interactionPrompt===mi.AUTO&&this.cameraControls}zoom(m){const y=new WheelEvent("wheel",{deltaY:-30*m});this[_e].dispatchEvent(y)}connectedCallback(){super.connectedCallback(),this[z].addEventListener("user-interaction",this[$t]),this[z].addEventListener("pointer-change-start",this[vs]),this[z].addEventListener("pointer-change-end",this[vs])}disconnectedCallback(){super.disconnectedCallback(),this[z].removeEventListener("user-interaction",this[$t]),this[z].removeEventListener("pointer-change-start",this[vs]),this[z].removeEventListener("pointer-change-end",this[vs])}updated(m){super.updated(m);const y=this[z],Q=this[x];if(m.has("cameraControls")&&(this.cameraControls?(y.enableInteraction(),this.interactionPrompt===mi.AUTO&&(this[wt]=!0)):(y.disableInteraction(),this[Ei]()),this[_e].setAttribute("aria-label",this[as])),m.has("disableZoom")&&(y.disableZoom=this.disableZoom),m.has("disablePan")&&(y.enablePan=!this.disablePan),m.has("disableTap")&&(y.enableTap=!this.disableTap),(m.has("interactionPrompt")||m.has("cameraControls")||m.has("src"))&&(this.interactionPrompt===mi.AUTO&&this.cameraControls&&!this[Ci]?this[wt]=!0:this[Ei]()),m.has("interactionPromptStyle")&&(this[Ii].style.opacity=this.interactionPromptStyle==Ar.BASIC?"1":"0"),m.has("touchAction")){const E=this.touchAction;y.applyOptions({touchAction:E}),y.updateTouchActionStyle()}m.has("orbitSensitivity")&&(y.orbitSensitivity=this.orbitSensitivity),m.has("zoomSensitivity")&&(y.zoomSensitivity=this.zoomSensitivity),m.has("panSensitivity")&&(y.panSensitivity=this.panSensitivity),m.has("interpolationDecay")&&(y.setDamperDecayTime(this.interpolationDecay),Q.setTargetDamperDecayTime(this.interpolationDecay)),m.has("a11y")&&this[sA](),this[Ts]===!0&&Promise.resolve().then(()=>{y.jumpToGoal(),Q.jumpToGoal(),this[hr](),this[Ts]=!1})}async updateFraming(){const m=this[x],y=m.adjustedFoV(m.framedFoVDeg);await m.updateFraming();const Q=m.adjustedFoV(m.framedFoVDeg),E=this[z].getFieldOfView()/y;this[z].setFieldOfView(Q*E),this[Ms]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),await this.updateComplete}interact(m,y,Q){const E=this[_e],S=this[cr];if(S[0].style.opacity==="1"){console.warn("interact() failed because an existing interaction is running.");return}const v=new Array;v.push({x:rs(y.x),y:rs(y.y)});const R=[{x:v[0].x(0),y:v[0].y(0)}];Q!=null&&(v.push({x:rs(Q.x),y:rs(Q.y)}),R.push({x:v[1].x(0),y:v[1].y(0)}));let _=performance.now();const{width:N,height:T}=this[x],M=this.getBoundingClientRect(),L=$=>{for(const[V,K]of R.entries()){const{style:J}=S[V];J.transform=`translateX(${N*K.x}px) translateY(${T*K.y}px)`,$==="pointerdown"?J.opacity="1":$==="pointerup"&&(J.opacity="0");const se={pointerId:V-5678,pointerType:"touch",target:E,clientX:N*K.x+M.x,clientY:T*K.y+M.y,altKey:!0};E.dispatchEvent(new PointerEvent($,se))}},D=()=>{const $=this[Bi];if($!==Z.AUTOMATIC||!E.isConnected){for(const K of this[cr])K.style.opacity="0";L("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:$}})),document.removeEventListener("visibilitychange",H);return}const V=Math.min(1,(performance.now()-_)/m);for(const[K,J]of R.entries())J.x=v[K].x(V),J.y=v[K].y(V);L("pointermove"),V<1?requestAnimationFrame(D):(L("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:Z.AUTOMATIC}})),document.removeEventListener("visibilitychange",H))},H=()=>{let $=0;document.visibilityState==="hidden"?$=performance.now()-_:_=performance.now()-$};document.addEventListener("visibilitychange",H),L("pointerdown"),this[Bi]=Z.AUTOMATIC,requestAnimationFrame(D)}[(e=lr,t=Ii,s=cr,i=zi,n=bs,r=Vt,a=Ci,A=wt,l=Bi,h=z,c=ur,u=Ts,d=dr,g=Ms,f=We,rA)](m){const y=this[z],Q=this[x];Q.framedFoVDeg=m[0]*180/Math.PI,y.changeSource=Z.NONE,y.setFieldOfView(Q.adjustedFoV(Q.framedFoVDeg)),this[$t]()}[nA](m){const y=this[z];if(this[Ms]){const{theta:Q,phi:E}=this.getCameraOrbit();m[0]=Q,m[1]=E,this[Ms]=!1}y.changeSource=Z.NONE,y.setOrbit(m[0],m[1],m[2]),this[$t]()}[aA](m){this[z].applyOptions({minimumAzimuthalAngle:m[0],minimumPolarAngle:m[1],minimumRadius:m[2]}),this.jumpCameraToGoal()}[AA](m){this[z].applyOptions({maximumAzimuthalAngle:m[0],maximumPolarAngle:m[1],maximumRadius:m[2]}),this[iA](m[2]),this.jumpCameraToGoal()}[lA](m){this[z].applyOptions({minimumFieldOfView:m[0]*180/Math.PI}),this.jumpCameraToGoal()}[cA](m){const y=this[x].adjustedFoV(m[0]*180/Math.PI);this[z].applyOptions({maximumFieldOfView:y}),this.jumpCameraToGoal()}[oA](m){const[y,Q,E]=m;this[Y].arRenderer.isPresenting||this[x].setTarget(y,Q,E),this[z].changeSource=Z.NONE,this[Y].arRenderer.updateTarget(),this[$t]()}[qe](m,y){if(super[qe](m,y),this[Y].isPresenting||!this[Nt]())return;const Q=this[z],E=this[x],S=performance.now();if(this[wt]&&this.loaded&&S>this[js]+this.interactionPromptThreshold&&(this[wt]=!1,this[Vt]=S,this[lr].classList.add("visible")),isFinite(this[Vt])&&this.interactionPromptStyle===Ar.WIGGLE){const _=(S-this[Vt])/Yg%1,N=Jg(_),T=Wg(_);if(this[Ii].style.opacity=`${T}`,N!==this[bs]){const M=N*E.width*.05,L=(N-this[bs])*Math.PI/16;this[Ii].style.transform=`translateX(${M}px)`,Q.changeSource=Z.AUTOMATIC,Q.adjustOrbit(L,0,0),this[bs]=N}}const v=Q.update(m,y),R=E.updateTarget(y);(v||R)&&this[hr]()}[Ei](){this[wt]=!1,this[lr].classList.remove("visible"),this[Vt]=1/0}[iA](m){const y=Math.max(this[x].farRadius(),m),Q=0,E=Math.abs(2*y);this[z].updateNearFar(Q,E)}[tA](){const{theta:m,phi:y}=this[z].getCameraSpherical(this[ur]),Q=(4+Math.floor((m%gf+df)/Xc))%4,E=Math.floor(y/uf),S=sf[Q],R=`${nf[E]}${S}`,_=R;_ in this[We]?this[An](this[We][_]):this[An](`View from stage ${R}`)}get[as](){let m=of;return"interaction-prompt"in this[We]&&(m=`. ${this[We]["interaction-prompt"]}`),super[as].replace(/\.$/,"")+(this.cameraControls?m:"")}async[ln](m){const y=this[z],Q=this[x],E=Q.adjustedFoV(Q.framedFoVDeg);super[ln](m);const S=Q.adjustedFoV(Q.framedFoVDeg)/E,v=y.getFieldOfView()*(isFinite(S)?S:1);y.updateAspect(this[x].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),await this.updateComplete,this[z].setFieldOfView(v),this.jumpCameraToGoal()}[Ke](){super[Ke](),this[dr]?this[Ms]=!0:this[dr]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}[(p=$t,I=hr,C=vs,sA)](){if(typeof this.a11y=="string")if(this.a11y.startsWith("{"))try{this[We]=JSON.parse(this.a11y)}catch(m){console.warn("Error parsing a11y JSON:",m)}else this.a11y.length>0?console.warn("Error not supported format, should be a JSON string:",this.a11y):this[We]={};else typeof this.a11y=="object"&&this.a11y!=null?this[We]=Object.assign({},this.a11y):this[We]={};this[_e].setAttribute("aria-label",this[as])}}return ee([k({type:Boolean,attribute:"camera-controls"})],w.prototype,"cameraControls",void 0),ee([At({intrinsics:jc,observeEffects:!0,updateHandler:nA}),k({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],w.prototype,"cameraOrbit",void 0),ee([At({intrinsics:hf,observeEffects:!0,updateHandler:oA}),k({type:String,attribute:"camera-target",hasChanged:()=>!0})],w.prototype,"cameraTarget",void 0),ee([At({intrinsics:eA,observeEffects:!0,updateHandler:rA}),k({type:String,attribute:"field-of-view",hasChanged:()=>!0})],w.prototype,"fieldOfView",void 0),ee([At({intrinsics:lf,updateHandler:aA}),k({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],w.prototype,"minCameraOrbit",void 0),ee([At({intrinsics:cf,updateHandler:AA}),k({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],w.prototype,"maxCameraOrbit",void 0),ee([At({intrinsics:Af,updateHandler:lA}),k({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],w.prototype,"minFieldOfView",void 0),ee([At({intrinsics:eA,updateHandler:cA}),k({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],w.prototype,"maxFieldOfView",void 0),ee([k({type:Number,attribute:"interaction-prompt-threshold"})],w.prototype,"interactionPromptThreshold",void 0),ee([k({type:String,attribute:"interaction-prompt"})],w.prototype,"interactionPrompt",void 0),ee([k({type:String,attribute:"interaction-prompt-style"})],w.prototype,"interactionPromptStyle",void 0),ee([k({type:Number,attribute:"orbit-sensitivity"})],w.prototype,"orbitSensitivity",void 0),ee([k({type:Number,attribute:"zoom-sensitivity"})],w.prototype,"zoomSensitivity",void 0),ee([k({type:Number,attribute:"pan-sensitivity"})],w.prototype,"panSensitivity",void 0),ee([k({type:String,attribute:"touch-action"})],w.prototype,"touchAction",void 0),ee([k({type:Boolean,attribute:"disable-zoom"})],w.prototype,"disableZoom",void 0),ee([k({type:Boolean,attribute:"disable-pan"})],w.prototype,"disablePan",void 0),ee([k({type:Boolean,attribute:"disable-tap"})],w.prototype,"disableTap",void 0),ee([k({type:Number,attribute:"interpolation-decay"})],w.prototype,"interpolationDecay",void 0),ee([k()],w.prototype,"a11y",void 0),w};/* @license
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pf=.018,hA=2,mf=300,If=new Re,uA=new F,dA=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:0,maximumPolarAngle:Math.PI,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),yi=Math.PI/8,wi=.04,Qi=10,Z={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class Ef extends En{constructor(e,t,s){super(),this.camera=e,this.element=t,this.scene=s,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.inputSensitivity=1,this.changeSource=Z.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new To,this.panPerPixel=0,this.spherical=new Pi,this.goalSpherical=new Pi,this.thetaDamper=new Ie,this.phiDamper=new Ie,this.radiusDamper=new Ie,this.logFov=Math.log(dA.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new Ie,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=i=>{if(this.enablePan)i.preventDefault();else for(const n of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:n.id})))},this.touchModeZoom=(i,n)=>{if(!this._disableZoom){const r=this.twoTouchDistance(this.pointers[0],this.pointers[1]),a=wi*this.zoomSensitivity*(this.lastSeparation-r)*50/this.scene.height;this.lastSeparation=r,this.userAdjustOrbit(0,0,a)}this.panPerPixel>0&&this.movePan(i,n)},this.disableScroll=i=>{i.preventDefault()},this.touchModeRotate=(i,n)=>{const{touchAction:r}=this._options;if(!this.touchDecided&&r!=="none"){this.touchDecided=!0;const a=Math.abs(i),A=Math.abs(n);if(this.changeSource===Z.USER_INTERACTION&&(r==="pan-y"&&A>a||r==="pan-x"&&a>A)){this.touchMode=null;return}else this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(i,n)},this.onPointerDown=i=>{if(this.pointers.length>2)return;const{element:n}=this;this.pointers.length===0&&(n.addEventListener("pointermove",this.onPointerMove),n.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=i.clientX,this.startPointerPosition.clientY=i.clientY,this.startTime=performance.now());try{n.setPointerCapture(i.pointerId)}catch{}this.pointers.push({clientX:i.clientX,clientY:i.clientY,id:i.pointerId}),this.isUserPointing=!1,i.pointerType==="touch"?(this.changeSource=i.altKey?Z.AUTOMATIC:Z.USER_INTERACTION,this.onTouchChange(i)):(this.changeSource=Z.USER_INTERACTION,this.onMouseDown(i)),this.changeSource===Z.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=i=>{const n=this.pointers.find(l=>l.id===i.pointerId);if(n==null)return;if(i.pointerType==="mouse"&&i.buttons===0){this.onPointerUp(i);return}const r=this.pointers.length,a=(i.clientX-n.clientX)/r,A=(i.clientY-n.clientY)/r;a===0&&A===0||(n.clientX=i.clientX,n.clientY=i.clientY,i.pointerType==="touch"?(this.changeSource=i.altKey?Z.AUTOMATIC:Z.USER_INTERACTION,this.touchMode!==null&&this.touchMode(a,A)):(this.changeSource=Z.USER_INTERACTION,this.panPerPixel>0?this.movePan(a,A):this.handleSinglePointerMove(a,A)))},this.onPointerUp=i=>{const{element:n}=this,r=this.pointers.findIndex(a=>a.id===i.pointerId);r!==-1&&this.pointers.splice(r,1),this.panPerPixel>0&&!i.altKey&&this.resetRadius(),this.pointers.length===0?(n.removeEventListener("pointermove",this.onPointerMove),n.removeEventListener("pointerup",this.onPointerUp),n.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(i)):this.touchMode!==null&&this.onTouchChange(i),this.scene.element[zi].style.opacity=0,n.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=i=>{this.changeSource=Z.USER_INTERACTION;const n=i.deltaY*(i.deltaMode==1?18:1)*wi*this.zoomSensitivity/30;this.userAdjustOrbit(0,0,n),i.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=i=>{const{changeSource:n}=this;this.changeSource=Z.USER_INTERACTION,(i.shiftKey&&this.enablePan?this.panKeyCodeHandler(i):this.orbitZoomKeyCodeHandler(i))?(i.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=n},this._options=Object.assign({},dA),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(this._interactionEnabled===!1){const{element:e}=this;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchmove",()=>{},{passive:!1}),e.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(this._interactionEnabled===!0){const{element:e}=this;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointercancel",this.onPointerUp),e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("contextmenu",this.onContext),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(e){this._disableZoom!=e&&(this._disableZoom=e,e===!0?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(e=new Pi){return e.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(e,t){this.camera.far=t===0?2:t,this.camera.near=Math.max(e,this.camera.far/1e3),this.camera.updateProjectionMatrix()}updateAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setOrbit(e=this.goalSpherical.theta,t=this.goalSpherical.phi,s=this.goalSpherical.radius){const{minimumAzimuthalAngle:i,maximumAzimuthalAngle:n,minimumPolarAngle:r,maximumPolarAngle:a,minimumRadius:A,maximumRadius:l}=this._options,{theta:h,phi:c,radius:u}=this.goalSpherical,d=Ue(e,i,n);!isFinite(i)&&!isFinite(n)&&(this.spherical.theta=this.wrapAngle(this.spherical.theta-d)+d);const g=Ue(t,r,a),f=Ue(s,A,l);return d===h&&g===c&&f===u||!isFinite(d)||!isFinite(g)||!isFinite(f)?!1:(this.goalSpherical.theta=d,this.goalSpherical.phi=g,this.goalSpherical.radius=f,this.goalSpherical.makeSafe(),!0)}setRadius(e){this.goalSpherical.radius=e,this.setOrbit()}setFieldOfView(e){const{minimumFieldOfView:t,maximumFieldOfView:s}=this._options;e=Ue(e,t,s),this.goalLogFov=Math.log(e)}setDamperDecayTime(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}adjustOrbit(e,t,s){const{theta:i,phi:n,radius:r}=this.goalSpherical,{minimumRadius:a,maximumRadius:A,minimumFieldOfView:l,maximumFieldOfView:h}=this._options,c=this.spherical.theta-i,u=Math.PI-.001,d=i-Ue(e,-u-c,u-c),g=n-t,f=s===0?0:((s>0?A:a)-r)/(Math.log(s>0?h:l)-this.goalLogFov),p=r+s*(isFinite(f)?f:(A-a)*2);if(this.setOrbit(d,g,p),s!==0){const I=this.goalLogFov+s;this.setFieldOfView(Math.exp(I))}}jumpToGoal(){this.update(0,kc)}update(e,t){if(this.isStationary())return!1;const{maximumPolarAngle:s,maximumRadius:i}=this._options,n=this.spherical.theta-this.goalSpherical.theta;return Math.abs(n)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=Math.sign(n)*2*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,s),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,i),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:e}=this.element;if(this._interactionEnabled){const{touchAction:t}=this._options;this._disableZoom&&t!=="none"?e.touchAction="manipulation":e.touchAction=t}else e.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new ec(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(e,t,s){this.adjustOrbit(e*this.orbitSensitivity*this.inputSensitivity,t*this.orbitSensitivity*this.inputSensitivity,s*this.inputSensitivity)}wrapAngle(e){const t=(e+Math.PI)/(2*Math.PI);return(t-Math.floor(t))*2*Math.PI-Math.PI}pixelLengthToSphericalAngle(e){return 2*Math.PI*e/this.scene.height}twoTouchDistance(e,t){const{clientX:s,clientY:i}=e,{clientX:n,clientY:r}=t,a=n-s,A=r-i;return Math.sqrt(a*a+A*A)}handleSinglePointerMove(e,t){const s=this.pixelLengthToSphericalAngle(e),i=this.pixelLengthToSphericalAngle(t);this.isUserPointing===!1&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(s,i,0)}initializePan(){const{theta:e,phi:t}=this.spherical,s=e-this.scene.yaw;this.panPerPixel=pf*this.panSensitivity/this.scene.height,this.panProjection.set(-Math.cos(s),-Math.cos(t)*Math.sin(s),0,0,Math.sin(t),0,Math.sin(s),-Math.cos(t)*Math.cos(s),0)}movePan(e,t){const{scene:s}=this,i=uA.set(e,t,0).multiplyScalar(this.inputSensitivity),n=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;i.multiplyScalar(n);const r=s.getTarget();r.add(i.applyMatrix3(this.panProjection)),s.boundingSphere.clampPoint(r,r),s.setTarget(r.x,r.y,r.z)}recenter(e){if(performance.now()>this.startTime+mf||Math.abs(e.clientX-this.startPointerPosition.clientX)>hA||Math.abs(e.clientY-this.startPointerPosition.clientY)>hA)return;const{scene:t}=this,s=t.positionAndNormalFromPoint(t.getNDC(e.clientX,e.clientY));if(s==null){const{cameraTarget:i}=t.element;t.element.cameraTarget="",t.element.cameraTarget=i,this.userAdjustOrbit(0,0,1)}else t.target.worldToLocal(s.position),t.setTarget(s.position.x,s.position.y,s.position.z)}resetRadius(){const{scene:e}=this,t=e.positionAndNormalFromPoint(If.set(0,0));if(t==null)return;e.target.worldToLocal(t.position);const s=e.getTarget(),{theta:i,phi:n}=this.spherical,r=i-e.yaw,a=uA.set(Math.sin(n)*Math.sin(r),Math.cos(n),Math.sin(n)*Math.cos(r)),A=a.dot(t.position.sub(s));s.add(a.multiplyScalar(A)),e.setTarget(s.x,s.y,s.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-A)}onTouchChange(e){if(this.pointers.length===1)this.touchMode=this.touchModeRotate;else{if(this._disableZoom){this.touchMode=null,this.element.removeEventListener("touchmove",this.disableScroll);return}this.touchMode=this.touchDecided&&this.touchMode===null?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&this.touchMode!=null&&(this.initializePan(),e.altKey||(this.scene.element[zi].style.opacity=1))}}onMouseDown(e){this.panPerPixel=0,this.enablePan&&(e.button===2||e.ctrlKey||e.metaKey||e.shiftKey)&&(this.initializePan(),this.scene.element[zi].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(e){let t=!0;switch(e.key){case"PageUp":this.userAdjustOrbit(0,0,wi*this.zoomSensitivity);break;case"PageDown":this.userAdjustOrbit(0,0,-1*wi*this.zoomSensitivity);break;case"ArrowUp":this.userAdjustOrbit(0,-yi,0);break;case"ArrowDown":this.userAdjustOrbit(0,yi,0);break;case"ArrowLeft":this.userAdjustOrbit(-yi,0,0);break;case"ArrowRight":this.userAdjustOrbit(yi,0,0);break;default:t=!1;break}return t}panKeyCodeHandler(e){this.initializePan();let t=!0;switch(e.key){case"ArrowUp":this.movePan(0,-1*Qi);break;case"ArrowDown":this.movePan(0,Qi);break;case"ArrowLeft":this.movePan(-1*Qi,0);break;case"ArrowRight":this.movePan(Qi,0);break;default:t=!1;break}return t}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cf=30,gA=.8,fA=1.5,Bf=20,yf=.2,wf=.25,Qf=10,qt=150,pA=5,Sf=.1,ht={NOT_PRESENTING:"not-presenting",SESSION_STARTED:"session-started",OBJECT_PLACED:"object-placed",FAILED:"failed"},co={TRACKING:"tracking",NOT_TRACKING:"not-tracking"},Rs=new F,Kt=new Is,xf=new Ve,vf=new F,bf=new si(45,1,.1,100),mA=new dn().setFromPoints([new F(0,0,0),new F(0,0,-1)]),Tf=new Cn;class Mf extends En{constructor(e){super(),this.renderer=e,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.xrMode=null,this.controller1=null,this.controller2=null,this.selectedController=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new F,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new F,this.relativeOrientation=new Is,this.scaleLine=new io(mA),this.firstRatio=0,this.lastAngle=0,this.goalPosition=new F,this.goalYaw=0,this.goalScale=1,this.xDamper=new Ie,this.yDamper=new Ie,this.zDamper=new Ie,this.yawDamper=new Ie,this.pitchDamper=new Ie,this.rollDamper=new Ie,this.scaleDamper=new Ie,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onControllerSelectStart=t=>{const s=this.presentedScene,i=t.target;if(this.placementBox.controllerIntersection(s,i)!=null)this.selectedController!=null&&(this.selectedController.userData.line.visible=!1,s.canScale&&(this.isTwoFingering=!0,this.firstRatio=this.controllerSeparation()/s.pivot.scale.x,this.scaleLine.visible=!0)),i.attach(s.pivot),this.selectedController=i,s.setShadowIntensity(.01);else{const n=i===this.controller1?this.controller2:this.controller1;this.relativeOrientation.copy(i.quaternion).invert().multiply(s.pivot.getWorldQuaternion(Kt)),n.userData.turning=!1,i.userData.turning=!0,i.userData.line.visible=!1}},this.onControllerSelectEnd=t=>{const s=t.target;if(s.userData.turning=!1,s.userData.line.visible=!0,this.isTwoFingering=!1,this.scaleLine.visible=!1,this.selectedController!=null&&this.selectedController!=s)return;const i=this.presentedScene;i.attach(i.pivot),this.selectedController=null,this.goalYaw=Math.atan2(i.pivot.matrix.elements[8],i.pivot.matrix.elements[10]),this.goalPosition.x=i.pivot.position.x,this.goalPosition.z=i.pivot.position.z},this.onUpdateScene=()=>{this.placementBox!=null&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new Ga(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=t=>{const s=this.transientHitTestSource;if(s==null)return;const i=this.frame.getHitTestResultsForTransientInput(s),n=this.presentedScene,r=this.placementBox;if(i.length===1){this.inputSource=t.inputSource;const{axes:a}=this.inputSource.gamepad,A=r.getHit(this.presentedScene,a[0],a[1]);r.show=!0,A!=null?(this.isTranslating=!0,this.lastDragPosition.copy(A)):this.placeOnWall===!1&&(this.isRotating=!0,this.lastAngle=a[0]*fA)}else if(i.length===2){r.show=!0,this.isTwoFingering=!0;const{separation:a}=this.fingerPolar(i);this.firstRatio=a/n.pivot.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=e.threeRenderer,this.threeRenderer.xr.enabled=!0}async resolveARSession(){aa();const e=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),await this.threeRenderer.xr.setSession(e),this.threeRenderer.xr.cameraAutoUpdate=!1,e}get presentedScene(){return this._presentedScene}async supportsPresentation(){try{return aa(),await navigator.xr.isSessionSupported("immersive-ar")}catch(e){return console.warn("Request to present in WebXR denied:"),console.warn(e),console.warn("Falling back to next ar-mode"),!1}}async present(e,t=!1){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let s=new Promise((l,h)=>{requestAnimationFrame(()=>l())});e.setHotspotsVisibility(!1),e.queueRender(),await s,this._presentedScene=e,this.overlay=e.element.shadowRoot.querySelector("div.default"),t===!0&&(this.xrLight=new _g(this.threeRenderer),this.xrLight.addEventListener("estimationstart",()=>{if(!this.isPresenting||this.xrLight==null)return;const l=this.presentedScene;l.add(this.xrLight),l.environment=this.xrLight.environment}));const i=await this.resolveARSession();i.addEventListener("end",()=>{this.postSessionCleanup()},{once:!0});const n=e.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");n.classList.add("enabled"),n.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=n;const r=await i.requestReferenceSpace("viewer");this.xrMode=i.interactionMode,this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=e.yaw,this.goalYaw=e.yaw,this.goalScale=1,e.setBackground(null),this.oldShadowIntensity=e.shadowIntensity,e.setShadowIntensity(.01),this.oldTarget.copy(e.getTarget()),e.element.addEventListener("load",this.onUpdateScene);const a=Bf*Math.PI/180,A=this.placeOnWall===!0?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(a),z:-Math.cos(a)});i.requestHitTestSource({space:r,offsetRay:A}).then(l=>{this.initialHitSource=l}),this.xrMode!=="screen-space"&&(this.setupControllers(),this.xDamper.setDecayTime(qt),this.yDamper.setDecayTime(qt),this.zDamper.setDecayTime(qt),this.yawDamper.setDecayTime(qt),this.pitchDamper.setDecayTime(qt),this.rollDamper.setDecayTime(qt)),this.currentSession=i,this.placementBox=new Ga(e,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:ht.SESSION_STARTED})}setupControllers(){this.controller1=this.threeRenderer.xr.getController(0),this.controller1.addEventListener("selectstart",this.onControllerSelectStart),this.controller1.addEventListener("selectend",this.onControllerSelectEnd),this.controller2=this.threeRenderer.xr.getController(1),this.controller2.addEventListener("selectstart",this.onControllerSelectStart),this.controller2.addEventListener("selectend",this.onControllerSelectEnd);const e=this.presentedScene;if(e.add(this.controller1),e.add(this.controller2),!this.controller1.userData.line){const t=new io(mA);t.name="line",t.scale.z=pA,this.controller1.userData.turning=!1,this.controller1.userData.line=t,this.controller1.add(t),this.controller2.userData.turning=!1;const s=t.clone();this.controller2.userData.line=s,this.controller2.add(s),this.scaleLine.name="scale line",this.scaleLine.visible=!1,this.controller1.add(this.scaleLine);const{size:i}=e,n=Sf/Math.max(i.x,i.y,i.z),r=new Ae(Tf);r.name="box",r.scale.copy(i).multiplyScalar(n),r.visible=!1,this.controller1.userData.box=r,e.add(r);const a=r.clone();this.controller2.userData.box=a,e.add(a)}}hover(e){if(this.xrMode==="screen-space"||this.selectedController==e)return!1;const t=this.presentedScene,s=this.placementBox.controllerIntersection(t,e);return e.userData.box.visible=(s==null||e.userData.turning)&&!this.isTwoFingering,e.userData.line.scale.z=s==null?pA:s.distance,s!=null}controllerSeparation(){return this.controller1.position.distanceTo(this.controller2.position)}async stopPresenting(){if(!this.isPresenting)return;const e=new Promise(t=>{this.resolveCleanup=t});try{await this.currentSession.end(),await e}catch(t){console.warn("Error while trying to end WebXR AR session"),console.warn(t),this.postSessionCleanup()}}get isPresenting(){return this.presentedScene!=null}get target(){return this.oldTarget}updateTarget(){const e=this.presentedScene;if(e!=null){const t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}postSessionCleanup(){const e=this.currentSession;e!=null&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const t=this.presentedScene;if(this._presentedScene=null,t!=null){const{element:r}=t;this.xrLight!=null&&(t.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),t.add(t.pivot),t.pivot.quaternion.set(0,0,0,1),t.pivot.position.set(0,0,0),t.pivot.scale.set(1,1,1),t.setShadowOffset(0);const a=this.turntableRotation;a!=null&&(t.yaw=a);const A=this.oldShadowIntensity;A!=null&&t.setShadowIntensity(A),t.setEnvironmentAndSkybox(r[qs],r[Ks]);const l=this.oldTarget;t.setTarget(l.x,l.y,l.z),t.xrCamera=null,t.element.removeEventListener("load",this.onUpdateScene),t.orientHotspots(0);const{width:h,height:c}=r.getBoundingClientRect();t.setSize(h,c),requestAnimationFrame(()=>{t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:Z.NONE}}))})}this.renderer.height=0;const s=this.exitWebXRButtonContainer;s!=null&&(s.classList.remove("enabled"),s.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const i=this.transientHitTestSource;i!=null&&(i.cancel(),this.transientHitTestSource=null);const n=this.initialHitSource;n!=null&&(n.cancel(),this.initialHitSource=null),this.placementBox!=null&&(this.placementBox.dispose(),this.placementBox=null),this.xrMode!=="screen-space"&&(this.controller1!=null&&(this.controller1.userData.turning=!1,this.controller1.userData.box.visible=!1,this.controller1.userData.line.visible=!0,this.controller1.removeEventListener("selectstart",this.onControllerSelectStart),this.controller1.removeEventListener("selectend",this.onControllerSelectEnd),this.controller1.removeFromParent(),this.controller1=null),this.controller2!=null&&(this.controller2.userData.turning=!1,this.controller2.userData.box.visible=!1,this.controller2.userData.line.visible=!0,this.controller2.removeEventListener("selectstart",this.onControllerSelectStart),this.controller2.removeEventListener("selectend",this.onControllerSelectEnd),this.controller2.removeFromParent(),this.controller2=null),this.selectedController=null,this.scaleLine.visible=!1),this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,this.resolveCleanup!=null&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:ht.NOT_PRESENTING})}updateView(e){const t=this.presentedScene,s=this.threeRenderer.xr;s.updateCamera(bf),t.xrCamera=s.getCamera();const{elements:i}=t.getCamera().matrixWorld;if(t.orientHotspots(Math.atan2(i[1],i[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale){const r=e.recommendedViewportScale;e.requestViewportScale(Math.max(r,wf))}const n=s.getBaseLayer();if(n!=null){const r=n instanceof XRWebGLLayer?n.getViewport(e):s.getBinding().getViewSubImage(n,e).viewport;this.threeRenderer.setViewport(r.x,r.y,r.width,r.height)}}placeInitially(){const e=this.presentedScene,{pivot:t,element:s}=e,{position:i}=t,n=e.getCamera(),{width:r,height:a}=this.overlay.getBoundingClientRect();e.setSize(r,a),n.projectionMatrixInverse.copy(n.projectionMatrix).invert();const{theta:A}=s.getCameraOrbit(),l=n.getWorldDirection(Rs);e.yaw=Math.atan2(-l.x,-l.z)-A,this.goalYaw=e.yaw;const h=Math.max(1,2*e.boundingSphere.radius);i.copy(n.position).add(l.multiplyScalar(h)),this.updateTarget();const c=e.getTarget();if(i.add(c).sub(this.oldTarget),this.goalPosition.copy(i),e.setHotspotsVisibility(!0),this.xrMode==="screen-space"){const{session:u}=this.frame;u.addEventListener("selectstart",this.onSelectStart),u.addEventListener("selectend",this.onSelectEnd),u.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then(d=>{this.transientHitTestSource=d})}}getTouchLocation(){const{axes:e}=this.inputSource.gamepad;let t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return t!=null&&(Rs.copy(t).sub(this.presentedScene.getCamera().position),Rs.length()>Qf)?null:t}getHitPoint(e){const t=this.threeRenderer.xr.getReferenceSpace(),s=e.getPose(t);if(s==null)return null;const i=xf.fromArray(s.transform.matrix);return this.placeOnWall===!0&&(this.goalYaw=Math.atan2(i.elements[4],i.elements[6])),i.elements[5]>.75!==this.placeOnWall?vf.setFromMatrixPosition(i):null}moveToFloor(e){const t=this.initialHitSource;if(t==null)return;const s=e.getHitTestResults(t);if(s.length==0)return;const i=s[0],n=this.getHitPoint(i);n!=null&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(n):this.goalPosition.y=n.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:ht.OBJECT_PLACED}))}fingerPolar(e){const t=e[0].inputSource.gamepad.axes,s=e[1].inputSource.gamepad.axes,i=s[0]-t[0],n=s[1]-t[1],r=Math.atan2(n,i);let a=this.lastAngle-r;return a>Math.PI?a-=2*Math.PI:a<-Math.PI&&(a+=2*Math.PI),this.lastAngle=r,{separation:Math.sqrt(i*i+n*n),deltaYaw:a}}setScale(e){const t=e/this.firstRatio;this.goalScale=Math.abs(t-1)<yf?1:t}processInput(e){const t=this.transientHitTestSource;if(t==null||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const s=e.getHitTestResultsForTransientInput(t),i=this.presentedScene,n=i.pivot.scale.x;if(this.isTwoFingering){if(s.length<2)this.isTwoFingering=!1;else{const{separation:r,deltaYaw:a}=this.fingerPolar(s);this.placeOnWall===!1&&(this.goalYaw+=a),i.canScale&&this.setScale(r)}return}else if(s.length===2){this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:r}=this.fingerPolar(s);this.firstRatio=r/n;return}if(this.isRotating){const r=this.inputSource.gamepad.axes[0]*fA;this.goalYaw+=r-this.lastAngle,this.lastAngle=r}else this.isTranslating&&s.forEach(r=>{if(r.inputSource!==this.inputSource)return;let a=null;if(r.results.length>0&&(a=this.getHitPoint(r.results[0])),a==null&&(a=this.getTouchLocation()),a!=null){if(this.goalPosition.sub(this.lastDragPosition),this.placeOnWall===!1){const A=a.y-this.lastDragPosition.y;if(A<0){this.placementBox.offsetHeight=A/n,this.presentedScene.setShadowOffset(A);const l=Rs.copy(i.getCamera().position),h=-A/(l.y-a.y);l.multiplyScalar(h),a.multiplyScalar(1-h).add(l)}}this.goalPosition.add(a),this.lastDragPosition.copy(a)}})}moveScene(e){const t=this.presentedScene,{pivot:s}=t,i=this.placementBox;if(i.updateOpacity(e),this.controller1&&(this.controller1.userData.turning&&(s.quaternion.copy(this.controller1.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller2&&s.quaternion.premultiply(Kt.copy(this.controller2.quaternion).invert())),this.controller1.userData.box.position.copy(this.controller1.position),s.getWorldQuaternion(this.controller1.userData.box.quaternion)),this.controller2&&(this.controller2.userData.turning&&(s.quaternion.copy(this.controller2.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller1&&s.quaternion.premultiply(Kt.copy(this.controller1.quaternion).invert())),this.controller2.userData.box.position.copy(this.controller2.position),s.getWorldQuaternion(this.controller2.userData.box.quaternion)),this.controller1&&this.controller2&&this.isTwoFingering){const u=this.controllerSeparation();this.setScale(u),this.scaleLine.scale.z=-u,this.scaleLine.lookAt(this.controller2.position)}const n=t.pivot.scale.x;if(this.goalScale!==n){const u=this.scaleDamper.update(n,this.goalScale,e,1);t.pivot.scale.set(u,u,u)}if(s.parent!==t)return;const{position:r}=s,a=t.boundingSphere.radius,A=this.goalPosition;let l=Z.NONE;if(!A.equals(r)){l=Z.USER_INTERACTION;let{x:u,y:d,z:g}=r;if(u=this.xDamper.update(u,A.x,e,a),d=this.yDamper.update(d,A.y,e,a),g=this.zDamper.update(g,A.z,e,a),r.set(u,d,g),this.xrMode==="screen-space"&&!this.isTranslating){const f=A.y-d;this.placementComplete&&this.placeOnWall===!1?(i.offsetHeight=f/t.pivot.scale.x,t.setShadowOffset(f)):f===0&&(this.placementComplete=!0,i.show=!1,t.setShadowIntensity(gA))}this.xrMode!=="screen-space"&&A.equals(r)&&t.setShadowIntensity(gA)}t.updateTarget(e),Kt.setFromAxisAngle(Rs.set(0,1,0),this.goalYaw);const h=t.pivot.quaternion.angleTo(Kt),c=h-this.yawDamper.update(h,0,e,Math.PI);t.pivot.quaternion.rotateTowards(Kt,c),t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:l}}))}onWebXRFrame(e,t){if(this.xrMode!=="screen-space"){const a=this.hover(this.controller1),A=this.hover(this.controller2);this.placementBox.show=(a||A)&&!this.isTwoFingering}this.frame=t,++this.frames;const s=this.threeRenderer.xr.getReferenceSpace(),i=t.getViewerPose(s);i==null&&this.tracking===!0&&this.frames>Cf&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:co.NOT_TRACKING}));const n=this.presentedScene;if(i==null||n==null||!n.element.loaded){this.threeRenderer.clear();return}this.tracking===!1&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:co.TRACKING}));let r=!0;for(const a of i.views){if(this.updateView(a),r){this.moveToFloor(t),this.processInput(t);const A=e-this.lastTick;this.moveScene(A),this.renderer.preRender(n,e,A),this.lastTick=e,n.renderShadow(this.threeRenderer)}this.threeRenderer.render(n,n.getCamera()),r=!1}}}function Rf(o){const e=new Map,t=new Map,s=o.clone();return Zc(o,s,function(i,n){e.set(n,i),t.set(i,n)}),s.traverse(function(i){if(!i.isSkinnedMesh)return;const n=i,r=e.get(i),a=r.skeleton.bones;n.skeleton=r.skeleton.clone(),n.bindMatrix.copy(r.bindMatrix),n.skeleton.bones=a.map(function(A){return t.get(A)}),n.bind(n.skeleton,n.bindMatrix)}),s}function Zc(o,e,t){t(o,e);for(let s=0;s<o.children.length;s++)Zc(o.children[s],e.children[s],t)}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IA=Symbol("prepared"),rn=Symbol("prepare"),Fe=Symbol("preparedGLTF"),on=Symbol("clone");class Df{constructor(e){this[Fe]=e}static prepare(e){if(e.scene==null)throw new Error("Model does not have a scene");if(e[IA])return e;const t=this[rn](e);return t[IA]=!0,t}static[rn](e){const{scene:t}=e,s=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:s})}get parser(){return this[Fe].parser}get animations(){return this[Fe].animations}get scene(){return this[Fe].scene}get scenes(){return this[Fe].scenes}get cameras(){return this[Fe].cameras}get asset(){return this[Fe].asset}get userData(){return this[Fe].userData}clone(){const e=this.constructor,t=this[on]();return new e(t)}dispose(){this.scenes.forEach(e=>{e.traverse(t=>{const s=t;if(!s.material)return;(Array.isArray(s.material)?s.material:[s.material]).forEach(n=>{for(const r in n){const a=n[r];if(a instanceof Oe){const A=a.source.data;A.close!=null&&A.close(),a.dispose()}}n.dispose()}),s.geometry.dispose()})})}[on](){const e=this[Fe],t=Rf(this.scene);_f(t,this.scene);const s=[t],i=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:s,userData:i})}}const _f=(o,e)=>{eh(o,e,(t,s)=>{s.userData.variantMaterials!==void 0&&(t.userData.variantMaterials=new Map(s.userData.variantMaterials)),s.userData.variantData!==void 0&&(t.userData.variantData=s.userData.variantData),s.userData.originalMaterial!==void 0&&(t.userData.originalMaterial=s.userData.originalMaterial)})},eh=(o,e,t)=>{t(o,e);for(let s=0;s<o.children.length;s++)eh(o.children[s],e.children[s],t)},EA=Symbol("threeGLTF"),CA=Symbol("gltf"),BA=Symbol("gltfElementMap"),yA=Symbol("threeObjectMap"),wA=Symbol("parallelTraverseThreeScene"),QA=Symbol("correlateOriginalThreeGLTF"),SA=Symbol("correlateCloneThreeGLTF");class ai{constructor(e,t,s,i){this[EA]=e,this[CA]=t,this[BA]=i,this[yA]=s}static from(e,t){return t!=null?this[SA](e,t):this[QA](e)}static[QA](e){const t=e.parser.json,s=e.parser.associations,i=new Map,n={name:"Default"},r={type:"materials",index:-1};for(const a of s.keys())a instanceof Gi&&s.get(a)==null&&(r.index<0&&(t.materials==null&&(t.materials=[]),r.index=t.materials.length,t.materials.push(n)),a.name=n.name,s.set(a,{materials:r.index}));for(const[a,A]of s){A&&(a.userData=a.userData||{},a.userData.associations=A);for(const l in A)if(l!=null&&l!=="primitives"){const h=l,u=(t[h]||[])[A[h]];if(u==null)continue;let d=i.get(u);d==null&&(d=new Set,i.set(u,d)),d.add(a)}}return new ai(e,t,s,i)}static[SA](e,t){const s=t.threeGLTF,i=t.gltf,n=JSON.parse(JSON.stringify(i)),r=new Map,a=new Map;for(let A=0;A<s.scenes.length;A++)this[wA](s.scenes[A],e.scenes[A],(l,h)=>{const c=t.threeObjectMap.get(l);if(c!=null){for(const u in c)if(u!=null&&u!=="primitives"){const d=u,g=c[d],f=n[d][g],p=r.get(h)||{};p[d]=g,r.set(h,p);const I=a.get(f)||new Set;I.add(h),a.set(f,I)}}});return new ai(e,n,r,a)}static[wA](e,t,s){const i=(n,r)=>{if(s(n,r),n.isObject3D){const a=n,A=r;if(a.material)if(Array.isArray(a.material))for(let l=0;l<a.material.length;++l)s(a.material[l],A.material[l]);else s(a.material,A.material);for(let l=0;l<n.children.length;++l)i(n.children[l],r.children[l])}};i(e,t)}get threeGLTF(){return this[EA]}get gltf(){return this[CA]}get gltfElementMap(){return this[BA]}get threeObjectMap(){return this[yA]}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ds=Symbol("correlatedSceneGraph");class Lf extends Df{static[rn](e){const t=super[rn](e);t[Ds]==null&&(t[Ds]=ai.from(t));const{scene:s}=t,i=new vo(void 0,1/0);return s.traverse(n=>{n.renderOrder=1e3,n.frustumCulled=!1,n.name||(n.name=n.uuid);const r=n;if(r.material){const{geometry:a}=r;r.castShadow=!0,r.isSkinnedMesh&&(a.boundingSphere=i,a.boundingBox=null);const A=r.material;if(A.isMeshBasicMaterial===!0&&(A.toneMapped=!1),A.shadowSide=xo,A.aoMap){const{gltf:l,threeObjectMap:h}=t[Ds],c=h.get(A);if(l.materials!=null&&c!=null&&c.materials!=null){const u=l.materials[c.materials];u.occlusionTexture&&u.occlusionTexture.texCoord===0&&a.attributes.uv!=null&&a.setAttribute("uv2",a.attributes.uv)}}}}),t}get correlatedSceneGraph(){return this[Fe][Ds]}[on](){const e=super[on](),t=new Map;return e.scene.traverse(s=>{const i=s;if(i.material){const r=i.material;if(r!=null){if(t.has(r.uuid)){i.material=t.get(r.uuid);return}i.material=r.clone(),t.set(r.uuid,i.material)}}const n=s;n.target!==void 0&&n.add(n.target)}),e[Ds]=ai.from(e,this.correlatedSceneGraph),e}}const th=(o,e,t)=>{let s;switch(o){case Be:s=new Uint8ClampedArray(e*t*4);break;case ye:s=new Uint16Array(e*t*4);break;case uu:s=new Uint32Array(e*t*4);break;case hu:s=new Int8Array(e*t*4);break;case cu:s=new Int16Array(e*t*4);break;case lu:s=new Int32Array(e*t*4);break;case $e:s=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return s};let Si;const Ff=(o,e,t,s)=>{if(Si!==void 0)return Si;const i=new ii(1,1,s);e.setRenderTarget(i);const n=new Ae(new Cs,new Ge({color:16777215}));e.render(n,t),e.setRenderTarget(null);const r=th(o,i.width,i.height);return e.readRenderTargetPixels(i,0,0,i.width,i.height,r),i.dispose(),n.geometry.dispose(),n.material.dispose(),Si=r[0]!==0,Si};class Lo{constructor(e){var t,s,i,n,r,a,A,l,h,c,u,d,g,f,p,I;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(w){throw this._renderer.setRenderTarget(null),w}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const C={format:Qe,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((t=e.renderTargetOptions)===null||t===void 0?void 0:t.anisotropy)!==void 0?(s=e.renderTargetOptions)===null||s===void 0?void 0:s.anisotropy:1,generateMipmaps:((i=e.renderTargetOptions)===null||i===void 0?void 0:i.generateMipmaps)!==void 0?(n=e.renderTargetOptions)===null||n===void 0?void 0:n.generateMipmaps:!1,magFilter:((r=e.renderTargetOptions)===null||r===void 0?void 0:r.magFilter)!==void 0?(a=e.renderTargetOptions)===null||a===void 0?void 0:a.magFilter:ae,minFilter:((A=e.renderTargetOptions)===null||A===void 0?void 0:A.minFilter)!==void 0?(l=e.renderTargetOptions)===null||l===void 0?void 0:l.minFilter:ae,samples:((h=e.renderTargetOptions)===null||h===void 0?void 0:h.samples)!==void 0?(c=e.renderTargetOptions)===null||c===void 0?void 0:c.samples:void 0,wrapS:((u=e.renderTargetOptions)===null||u===void 0?void 0:u.wrapS)!==void 0?(d=e.renderTargetOptions)===null||d===void 0?void 0:d.wrapS:Me,wrapT:((g=e.renderTargetOptions)===null||g===void 0?void 0:g.wrapT)!==void 0?(f=e.renderTargetOptions)===null||f===void 0?void 0:f.wrapT:Me};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Lo.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new It,this._camera=new gn,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Ff(this._type,this._renderer,this._camera,C)){let w;switch(this._type){case ye:w=this._renderer.extensions.has("EXT_color_buffer_float")?$e:void 0;break}w!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${$e}`),this._type=w):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Ae(new Cs,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new ii(this.width,this.height,C),this._renderTarget.texture.mapping=((p=e.renderTargetOptions)===null||p===void 0?void 0:p.mapping)!==void 0?(I=e.renderTargetOptions)===null||I===void 0?void 0:I.mapping:en}static instantiateRenderer(){const e=new bo;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=th(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new jl(this.toArray(),this.width,this.height,Qe,this._type,(e==null?void 0:e.mapping)||en,(e==null?void 0:e.wrapS)||Me,(e==null?void 0:e.wrapT)||Me,(e==null?void 0:e.magFilter)||ae,(e==null?void 0:e.minFilter)||ae,(e==null?void 0:e.anisotropy)||1,te);return t.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof us&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof Oe&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof Oe&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Nf=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,kf=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Uf extends us{constructor({gamma:e,offsetHdr:t,offsetSdr:s,gainMapMin:i,gainMapMax:n,maxDisplayBoost:r,hdrCapacityMin:a,hdrCapacityMax:A,sdr:l,gainMap:h}){super({name:"GainMapDecoderMaterial",vertexShader:Nf,fragmentShader:kf,uniforms:{sdr:{value:l},gainMap:{value:h},gamma:{value:new F(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new F().fromArray(t)},offsetSdr:{value:new F().fromArray(s)},gainMapMin:{value:new F().fromArray(i)},gainMapMax:{value:new F().fromArray(n)},weightFactor:{value:(Math.log2(r)-a)/(A-a)}},blending:tc,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=r,this._hdrCapacityMin=a,this._hdrCapacityMax=A,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class sh extends Error{}class ih extends Error{}const _s=(o,e,t)=>{const s=new RegExp(`${e}="([^"]*)"`,"i").exec(o);if(s)return s[1];const i=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(o);if(i){const n=i[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return n&&n.length===3?n.map(r=>r.replace(/<\/?rdf:li>/g,"")):i[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},Gf=o=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(o):e=o.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const s=e.indexOf("x:xmpmeta>",t),i=e.slice(t,s+10);try{const n=_s(i,"hdrgm:GainMapMin","0"),r=_s(i,"hdrgm:GainMapMax"),a=_s(i,"hdrgm:Gamma","1"),A=_s(i,"hdrgm:OffsetSDR","0.015625"),l=_s(i,"hdrgm:OffsetHDR","0.015625"),h=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(i),c=h?h[1]:"0",u=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(i);if(!u)throw new Error("Incomplete gainmap metadata");const d=u[1];return{gainMapMin:Array.isArray(n)?n.map(g=>parseFloat(g)):[parseFloat(n),parseFloat(n),parseFloat(n)],gainMapMax:Array.isArray(r)?r.map(g=>parseFloat(g)):[parseFloat(r),parseFloat(r),parseFloat(r)],gamma:Array.isArray(a)?a.map(g=>parseFloat(g)):[parseFloat(a),parseFloat(a),parseFloat(a)],offsetSdr:Array.isArray(A)?A.map(g=>parseFloat(g)):[parseFloat(A),parseFloat(A),parseFloat(A)],offsetHdr:Array.isArray(l)?l.map(g=>parseFloat(g)):[parseFloat(l),parseFloat(l),parseFloat(l)],hdrCapacityMin:parseFloat(c),hdrCapacityMax:parseFloat(d)}}catch{}t=e.indexOf("<x:xmpmeta",s)}};class Of{constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,s)=>{const i=this.options.debug,n=new DataView(e.buffer);if(n.getUint16(0)!==65496){s(new Error("Not a valid jpeg"));return}const r=n.byteLength;let a=2,A=0,l;for(;a<r;){if(++A>250){s(new Error(`Found no marker after ${A} loops 😵`));return}if(n.getUint8(a)!==255){s(new Error(`Not a valid marker at offset 0x${a.toString(16)}, found: 0x${n.getUint8(a).toString(16)}`));return}if(l=n.getUint8(a+1),i&&console.log(`Marker: ${l.toString(16)}`),l===226){i&&console.log("Found APP2 marker (0xffe2)");const h=a+4;if(n.getUint32(h)===1297106432){const c=h+4;let u;if(n.getUint16(c)===18761)u=!1;else if(n.getUint16(c)===19789)u=!0;else{s(new Error("No valid endianness marker found in TIFF header"));return}if(n.getUint16(c+2,!u)!==42){s(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const d=n.getUint32(c+4,!u);if(d<8){s(new Error("Not valid TIFF data! (First offset less than 8)"));return}const g=c+d,f=n.getUint16(g,!u),p=g+2;let I=0;for(let m=p;m<p+12*f;m+=12)n.getUint16(m,!u)===45057&&(I=n.getUint32(m+8,!u));const w=g+2+f*12+4,B=[];for(let m=w;m<w+I*16;m+=16){const y={MPType:n.getUint32(m,!u),size:n.getUint32(m+4,!u),dataOffset:n.getUint32(m+8,!u),dependantImages:n.getUint32(m+12,!u),start:-1,end:-1,isFII:!1};y.dataOffset?(y.start=c+y.dataOffset,y.isFII=!1):(y.start=0,y.isFII=!0),y.end=y.start+y.size,B.push(y)}if(this.options.extractNonFII&&B.length){const m=new Blob([n]),y=[];for(const Q of B){if(Q.isFII&&!this.options.extractFII)continue;const E=m.slice(Q.start,Q.end+1,"image/jpeg");y.push(E)}t(y)}}}a+=2+n.getUint16(a+2)}})}}const Pf=async o=>{const e=Gf(o);if(!e)throw new ih("Gain map XMP metadata not found");const s=await new Of({extractFII:!0,extractNonFII:!0}).extract(o);if(s.length!==2)throw new sh("Gain map recovery image not found");return{sdr:new Uint8Array(await s[0].arrayBuffer()),gainMap:new Uint8Array(await s[1].arrayBuffer()),metadata:e}},xA=o=>new Promise((e,t)=>{const s=document.createElement("img");s.onload=()=>{e(s)},s.onerror=i=>{t(i)},s.src=URL.createObjectURL(o)});class Hf extends un{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new du}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new Uf({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Oe,sdr:new Oe});return new Lo({width:16,height:16,type:ye,colorSpace:te,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,s,i){const n=i?new Blob([i],{type:"image/jpeg"}):void 0,r=new Blob([s],{type:"image/jpeg"});let a,A,l=!1;if(typeof createImageBitmap>"u"){const u=await Promise.all([n?xA(n):Promise.resolve(void 0),xA(r)]);A=u[0],a=u[1],l=!0}else{const u=await Promise.all([n?createImageBitmap(n,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(r,{imageOrientation:"flipY"})]);A=u[0],a=u[1]}const h=new Oe(A||new ImageData(2,2),en,Me,Me,ae,Ko,Qe,Be,1,te);h.flipY=l,h.needsUpdate=!0;const c=new Oe(a,en,Me,Me,ae,Ko,Qe,Be,1,Ee);c.flipY=l,c.needsUpdate=!0,e.width=a.width,e.height=a.height,e.material.gainMap=h,e.material.sdr=c,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class $f extends Hf{load(e,t,s,i){const n=this.prepareQuadRenderer(),r=new gt(this._internalLoadingManager);return r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setPath(this.path),r.setWithCredentials(this.withCredentials),this.manager.itemStart(e),r.load(e,async a=>{if(typeof a=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const A=new Uint8Array(a);let l,h,c;try{const u=await Pf(A);l=u.sdr,h=u.gainMap,c=u.metadata}catch(u){if(u instanceof ih||u instanceof sh)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),c={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},l=A;else throw u}try{await this.render(n,c,l,h)}catch(u){this.manager.itemError(e),typeof i=="function"&&i(u),n.disposeOnDemandRenderer();return}typeof t=="function"&&t(n),this.manager.itemEnd(e),n.disposeOnDemandRenderer()},s,a=>{this.manager.itemError(e),typeof i=="function"&&i(a)}),n}}class Vf extends gu{constructor(e){super(e),this.type=ye}parse(e){const r=function(E,S){switch(E){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(S||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(S||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(S||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(S||""))}},h=`
`,c=function(E,S,v){S=S||1024;let _=E.pos,N=-1,T=0,M="",L=String.fromCharCode.apply(null,new Uint16Array(E.subarray(_,_+128)));for(;0>(N=L.indexOf(h))&&T<S&&_<E.byteLength;)M+=L,T+=L.length,_+=128,L+=String.fromCharCode.apply(null,new Uint16Array(E.subarray(_,_+128)));return-1<N?(E.pos+=T+N+1,M+L.slice(0,N)):!1},u=function(E){const S=/^#\?(\S+)/,v=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,R=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,_=/^\s*FORMAT=(\S+)\s*$/,N=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,T={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let M,L;for((E.pos>=E.byteLength||!(M=c(E)))&&r(1,"no header found"),(L=M.match(S))||r(3,"bad initial token"),T.valid|=1,T.programtype=L[1],T.string+=M+`
`;M=c(E),M!==!1;){if(T.string+=M+`
`,M.charAt(0)==="#"){T.comments+=M+`
`;continue}if((L=M.match(v))&&(T.gamma=parseFloat(L[1])),(L=M.match(R))&&(T.exposure=parseFloat(L[1])),(L=M.match(_))&&(T.valid|=2,T.format=L[1]),(L=M.match(N))&&(T.valid|=4,T.height=parseInt(L[1],10),T.width=parseInt(L[2],10)),T.valid&2&&T.valid&4)break}return T.valid&2||r(3,"missing format specifier"),T.valid&4||r(3,"missing image size specifier"),T},d=function(E,S,v){const R=S;if(R<8||R>32767||E[0]!==2||E[1]!==2||E[2]&128)return new Uint8Array(E);R!==(E[2]<<8|E[3])&&r(3,"wrong scanline width");const _=new Uint8Array(4*S*v);_.length||r(4,"unable to allocate buffer space");let N=0,T=0;const M=4*R,L=new Uint8Array(4),D=new Uint8Array(M);let H=v;for(;H>0&&T<E.byteLength;){T+4>E.byteLength&&r(1),L[0]=E[T++],L[1]=E[T++],L[2]=E[T++],L[3]=E[T++],(L[0]!=2||L[1]!=2||(L[2]<<8|L[3])!=R)&&r(3,"bad rgbe scanline format");let $=0,V;for(;$<M&&T<E.byteLength;){V=E[T++];const J=V>128;if(J&&(V-=128),(V===0||$+V>M)&&r(3,"bad scanline data"),J){const se=E[T++];for(let we=0;we<V;we++)D[$++]=se}else D.set(E.subarray(T,T+V),$),$+=V,T+=V}const K=R;for(let J=0;J<K;J++){let se=0;_[N]=D[J+se],se+=R,_[N+1]=D[J+se],se+=R,_[N+2]=D[J+se],se+=R,_[N+3]=D[J+se],N+=4}H--}return _},g=function(E,S,v,R){const _=E[S+3],N=Math.pow(2,_-128)/255;v[R+0]=E[S+0]*N,v[R+1]=E[S+1]*N,v[R+2]=E[S+2]*N,v[R+3]=1},f=function(E,S,v,R){const _=E[S+3],N=Math.pow(2,_-128)/255;v[R+0]=ci.toHalfFloat(Math.min(E[S+0]*N,65504)),v[R+1]=ci.toHalfFloat(Math.min(E[S+1]*N,65504)),v[R+2]=ci.toHalfFloat(Math.min(E[S+2]*N,65504)),v[R+3]=ci.toHalfFloat(1)},p=new Uint8Array(e);p.pos=0;const I=u(p),C=I.width,w=I.height,B=d(p.subarray(p.pos),C,w);let m,y,Q;switch(this.type){case $e:Q=B.length/4;const E=new Float32Array(Q*4);for(let v=0;v<Q;v++)g(B,v*4,E,v*4);m=E,y=$e;break;case ye:Q=B.length/4;const S=new Uint16Array(Q*4);for(let v=0;v<Q;v++)f(B,v*4,S,v*4);m=S,y=ye;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:C,height:w,data:m,header:I.string,gamma:I.gamma,exposure:I.exposure,type:y}}setDataType(e){return this.type=e,this}load(e,t,s,i){function n(r,a){switch(r.type){case $e:case ye:r.colorSpace=te,r.minFilter=ae,r.magFilter=ae,r.generateMipmaps=!1,r.flipY=!0;break}t&&t(r,a)}return super.load(e,n,s,i)}}/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qf={topLight:{intensity:500,position:[.418,16.199,.3]},room:{position:[-.757,13.219,.717],scale:[31.713,28.305,28.591]},boxes:[{position:[-10.906,2.009,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,.857,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:50,position:[-16.116,14.37,8.208],scale:[.1,2.428,2.739]},{intensity:50,position:[-16.109,18.021,-8.207],scale:[.1,2.425,2.751]},{intensity:17,position:[14.904,12.198,-1.832],scale:[.15,4.265,6.331]},{intensity:43,position:[-.462,8.89,14.52],scale:[4.38,5.441,.088]},{intensity:20,position:[3.235,11.486,-12.541],scale:[2.5,2,.1]},{intensity:100,position:[0,20,0],scale:[1,.1,1]}]},Kf={topLight:{intensity:400,position:[.5,14,.5]},room:{position:[0,13.2,0],scale:[31.5,28.5,31.5]},boxes:[{position:[-10.906,-1,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,-.16,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:80,position:[-14,10,8],scale:[.1,2.5,2.5]},{intensity:80,position:[-14,14,-4],scale:[.1,2.5,2.5]},{intensity:23,position:[14,12,0],scale:[.1,5,5]},{intensity:16,position:[0,9,14],scale:[5,5,.1]},{intensity:80,position:[7,8,-14],scale:[2.5,2.5,.1]},{intensity:80,position:[-7,16,-14],scale:[2.5,2.5,.1]},{intensity:1,position:[0,20,0],scale:[.1,.1,.1]}]};class vA extends It{constructor(e){super(),this.position.y=-3.5;const t=new Cn;t.deleteAttribute("uv");const s=new ji({metalness:0,side:Mo}),i=new ji({metalness:0}),n=e=="legacy"?qf:Kf,r=new Kl(16777215,n.topLight.intensity,28,2);r.position.set(...n.topLight.position),this.add(r);const a=new Ae(t,s);a.position.set(...n.room.position),a.scale.set(...n.room.scale),this.add(a);for(const A of n.boxes){const l=new Ae(t,i);l.position.set(...A.position),l.rotation.set(0,A.rotation,0),l.scale.set(...A.scale),this.add(l)}for(const A of n.lights){const l=new Ae(t,this.createAreaLightMaterial(A.intensity));l.position.set(...A.position),l.scale.set(...A.scale),this.add(l)}}createAreaLightMaterial(e){const t=new Ge;return t.color.setScalar(e),t}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zf=.04,zt=20,Yf=/\.hdr(\.js)?$/;class bA{constructor(e){this.threeRenderer=e,this.lottieLoaderUrl="",this._ldrLoader=null,this._imageLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}ldrLoader(e){return this._ldrLoader==null&&(this._ldrLoader=new Yl),this._ldrLoader.setWithCredentials(e),this._ldrLoader}imageLoader(e){return this._imageLoader==null&&(this._imageLoader=new $f(this.threeRenderer)),this._imageLoader.setWithCredentials(e),this._imageLoader}hdrLoader(e){return this._hdrLoader==null&&(this._hdrLoader=new Vf,this._hdrLoader.setDataType(ye)),this._hdrLoader.setWithCredentials(e),this._hdrLoader}async getLottieLoader(e){if(this._lottieLoader==null){const{LottieLoader:t}=await import(this.lottieLoaderUrl);this._lottieLoader=new t}return this._lottieLoader.setWithCredentials(e),this._lottieLoader}async loadImage(e,t){const s=await new Promise((i,n)=>this.ldrLoader(t).load(e,i,()=>{},n));return s.name=e,s.flipY=!1,s}async loadLottie(e,t,s){const i=await this.getLottieLoader(s);i.setQuality(t);const n=await new Promise((r,a)=>i.load(e,r,()=>{},a));return n.name=e,n}async loadEquirect(e,t=!1,s=()=>{}){try{const i=Yf.test(e),n=i?this.hdrLoader(t):this.imageLoader(t),r=await new Promise((a,A)=>n.load(e,l=>{const{renderTarget:h}=l;if(h!=null){const{texture:c}=h;l.dispose(!1),a(c)}else a(l)},l=>{s(l.loaded/l.total*.9)},A));return s(1),r.name=e,r.mapping=fu,i||(r.colorSpace=Ee),r}finally{s&&s(1)}}async generateEnvironmentMapAndSkybox(e=null,t=null,s=()=>{},i=!1){const n=t!=="legacy";(t==="legacy"||t==="neutral")&&(t=null),t=pc(t);let r=Promise.resolve(null),a;e&&(r=this.loadEquirectFromUrl(e,i,s)),t?a=this.loadEquirectFromUrl(t,i,s):e?a=this.loadEquirectFromUrl(e,i,s):a=n?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[A,l]=await Promise.all([a,r]);if(A==null)throw new Error("Failed to load environment map.");return{environmentMap:A,skybox:l}}async loadEquirectFromUrl(e,t,s){if(!this.skyboxCache.has(e)){const i=this.loadEquirect(e,t,s);this.skyboxCache.set(e,i)}return this.skyboxCache.get(e)}async GenerateEnvironmentMap(e,t){await zu();const s=this.threeRenderer,i=new Zl(256,{generateMipmaps:!1,type:ye,format:Qe,colorSpace:te,depthBuffer:!0}),n=new zo(.1,100,i),r=n.renderTarget.texture;r.name=t;const a=s.outputColorSpace,A=s.toneMapping;return s.toneMapping=pu,s.outputColorSpace=te,n.update(s,e),this.blurCubemap(i,zf),s.toneMapping=A,s.outputColorSpace=a,r}async loadGeneratedEnvironmentMap(){return this.generatedEnvironmentMap==null&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new vA("legacy"),"legacy")),this.generatedEnvironmentMap}async loadGeneratedEnvironmentMapAlt(){return this.generatedEnvironmentMapAlt==null&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new vA("neutral"),"neutral")),this.generatedEnvironmentMapAlt}blurCubemap(e,t){if(this.blurMaterial==null){this.blurMaterial=this.getBlurShader(zt);const i=new Cn,n=new Ae(i,this.blurMaterial);this.blurScene=new It,this.blurScene.add(n)}const s=e.clone();this.halfblur(e,s,t,"latitudinal"),this.halfblur(s,e,t,"longitudinal")}halfblur(e,t,s,i){const r=e.width,a=isFinite(s)?Math.PI/(2*r):2*Math.PI/(2*zt-1),A=s/a,l=isFinite(s)?1+Math.floor(3*A):zt;l>zt&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${l} samples when the maximum is set to ${zt}`);const h=[];let c=0;for(let g=0;g<zt;++g){const f=g/A,p=Math.exp(-f*f/2);h.push(p),g==0?c+=p:g<l&&(c+=2*p)}for(let g=0;g<h.length;g++)h[g]=h[g]/c;const u=this.blurMaterial.uniforms;u.envMap.value=e.texture,u.samples.value=l,u.weights.value=h,u.latitudinal.value=i==="latitudinal",u.dTheta.value=a,new zo(.1,100,t).update(this.threeRenderer,this.blurScene)}getBlurShader(e){const t=new Float32Array(e),s=new F(0,1,0);return new us({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:s}},vertexShader:`
      
      varying vec3 vOutputDirection;
  
      void main() {
  
        vOutputDirection = vec3( position );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  
      }
    `,fragmentShader:`
        varying vec3 vOutputDirection;
  
        uniform samplerCube envMap;
        uniform int samples;
        uniform float weights[ n ];
        uniform bool latitudinal;
        uniform float dTheta;
        uniform vec3 poleAxis;
  
        vec3 getSample( float theta, vec3 axis ) {
  
          float cosTheta = cos( theta );
          // Rodrigues' axis-angle rotation
          vec3 sampleDirection = vOutputDirection * cosTheta
            + cross( axis, vOutputDirection ) * sin( theta )
            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );
  
          return vec3( textureCube( envMap, sampleDirection ) );
  
        }
  
        void main() {
  
          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );
  
          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {
  
            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );
  
          }
  
          axis = normalize( axis );
  
          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );
  
          for ( int i = 1; i < n; i++ ) {
  
            if ( i >= samples ) {
  
              break;
  
            }
  
            float theta = dTheta * float( i );
            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );
  
          }
        }
      `,blending:tc,depthTest:!1,depthWrite:!1,side:Mo})}async dispose(){for(const[,e]of this.skyboxCache)(await e).dispose();this.generatedEnvironmentMap!=null&&((await this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),this.generatedEnvironmentMapAlt!=null&&((await this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),this.blurMaterial!=null&&this.blurMaterial.dispose()}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jf=.2,gr=40,fr=60,Wf=5,Yt=[1,.79,.62,.5,.4,.31,.25],jf=3,TA="high-performance",Xf=1.3;class Le extends En{constructor(e){super(),this.loader=new me(Lf),this.width=0,this.height=0,this.dpr=1,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=jf,this.avgFrameDuration=(fr+gr)/2,this.onWebGLContextLost=t=>{this.dispatchEvent({type:"contextlost",sourceEvent:t})},this.onWebGLContextRestored=()=>{var t;(t=this.textureUtils)===null||t===void 0||t.dispose(),this.textureUtils=new bA(this.threeRenderer);for(const s of this.scenes)s.element[nn]()},this.dpr=window.devicePixelRatio,this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new bo({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.setPixelRatio(1),this.threeRenderer.debug={checkShaderErrors:!!e.debug,onShaderError:null},this.threeRenderer.toneMapping=Qo}catch(t){console.warn(t)}this.arRenderer=new Mf(this),this.textureUtils=this.canRender?new bA(this.threeRenderer):null,me.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}static get singleton(){return this._singleton||(this._singleton=new Le({powerPreference:(self.ModelViewerElement||{}).powerPreference||TA,debug:la()})),this._singleton}static resetSingleton(){const e=this._singleton.dispose();for(const t of e)t.disconnectedCallback();this._singleton=new Le({powerPreference:(self.ModelViewerElement||{}).powerPreference||TA,debug:la()});for(const t of e)t.connectedCallback()}get canRender(){return this.threeRenderer!=null}get scaleFactor(){return Yt[this.scaleStep]}set minScale(e){let t=1;for(;t<Yt.length&&!(Yt[t]<e);)++t;this.lastStep=t-1}registerScene(e){this.scenes.add(e),e.forceRescale();const t=new Re;this.threeRenderer.getSize(t),e.canvas.width=t.x,e.canvas.height=t.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop((s,i)=>this.render(s,i))}unregisterScene(e){this.scenes.delete(e),this.canvas3D.parentElement===e.canvas.parentElement&&e.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&this.scenes.size===0&&this.threeRenderer.setAnimationLoop(null)}displayCanvas(e){return e.element.modelIsVisible&&!this.multipleScenesVisible?this.canvas3D:e.element[mo]}countVisibleScenes(){const{canvas3D:e}=this;let t=0,s=null;for(const n of this.scenes){const{element:r}=n;r.modelIsVisible&&n.externalRenderer==null&&++t,e.parentElement===n.canvas.parentElement&&(s=n)}const i=t>1;if(s!=null){const n=i&&!this.multipleScenesVisible,r=!s.element.modelIsVisible;if(n||r){const{width:a,height:A}=this.sceneSize(s);this.copyPixels(s,a,A),e.parentElement.removeChild(e)}}this.multipleScenesVisible=i}updateRendererSize(){var e;const t=window.devicePixelRatio;if(t!==this.dpr)for(const n of this.scenes){const{element:r}=n;r[ns](r.getBoundingClientRect())}let s=0,i=0;for(const n of this.scenes)s=Math.max(s,n.width),i=Math.max(i,n.height);if(!(s===this.width&&i===this.height&&t===this.dpr)){this.width=s,this.height=i,this.dpr=t,s=Math.ceil(s*t),i=Math.ceil(i*t),this.canRender&&this.threeRenderer.setSize(s,i,!1);for(const n of this.scenes){const{canvas:r}=n;r.width=s,r.height=i,n.forceRescale(),(e=n.effectRenderer)===null||e===void 0||e.setSize(s,i)}}}updateRendererScale(e){const t=this.scaleStep;this.avgFrameDuration+=Ue(Jf*(e-this.avgFrameDuration),-5,Wf),this.avgFrameDuration>fr?++this.scaleStep:this.avgFrameDuration<gr&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),t!==this.scaleStep&&(this.avgFrameDuration=(fr+gr)/2)}shouldRender(e){if(e.shouldRender())e.scaleStep!=this.scaleStep&&(e.scaleStep=this.scaleStep,this.rescaleCanvas(e));else if(e.scaleStep!=0)e.scaleStep=0,this.rescaleCanvas(e);else return!1;return!0}rescaleCanvas(e){const t=Yt[e.scaleStep],s=Math.ceil(this.width/t),i=Math.ceil(this.height/t),{style:n}=e.canvas;n.width=`${s}px`,n.height=`${i}px`,this.canvas3D.style.width=`${s}px`,this.canvas3D.style.height=`${i}px`;const r=this.dpr*t,a=t<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";e.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:r,minimumDpr:this.dpr*Yt[this.lastStep],pixelWidth:Math.ceil(e.width*r),pixelHeight:Math.ceil(e.height*r),reason:a}}))}sceneSize(e){const{dpr:t}=this,s=Yt[e.scaleStep],i=Math.min(Math.ceil(e.width*s*t),this.canvas3D.width),n=Math.min(Math.ceil(e.height*s*t),this.canvas3D.height);return{width:i,height:n}}copyPixels(e,t,s){const i=e.context;if(i==null){console.log("could not acquire 2d context");return}i.clearRect(0,0,t,s),i.drawImage(this.canvas3D,0,0,t,s,0,0,t,s),e.canvas.classList.add("show")}orderedScenes(){const e=[];for(const t of[!1,!0])for(const s of this.scenes)s.element.modelIsVisible===t&&e.push(s);return e}get isPresenting(){return this.arRenderer.isPresenting}preRender(e,t,s){const{element:i,exposure:n,toneMapping:r}=e;i[qe](t,s);const a=typeof n=="number"&&!Number.isNaN(n),A=i.environmentImage,l=i.skyboxImage,h=r===Vl&&(A==="neutral"||A==="legacy"||!A&&!l);this.threeRenderer.toneMappingExposure=(a?n:1)*(h?Xf:1)}render(e,t){if(t!=null){this.arRenderer.onWebXRFrame(e,t);return}const s=e-this.lastTick;if(this.lastTick=e,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(s),this.renderedLastFrame=!1);const{canvas3D:i}=this;for(const n of this.orderedScenes()){const{element:r}=n;if(!r.loaded||!r.modelIsVisible&&n.renderCount>0||(this.preRender(n,e,s),!this.shouldRender(n)))continue;if(n.externalRenderer!=null){const l=n.getCamera();l.updateMatrix();const{matrix:h,projectionMatrix:c}=l,u=h.elements.slice(),d=n.getTarget();u[12]+=d.x,u[13]+=d.y,u[14]+=d.z,n.externalRenderer.render({viewMatrix:u,projectionMatrix:c.elements});continue}if(!r.modelIsVisible&&!this.multipleScenesVisible)for(const l of this.scenes)l.element.modelIsVisible&&l.queueRender();const{width:a,height:A}=this.sceneSize(n);n.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-A,a,A),n.effectRenderer!=null?n.effectRenderer.render(s):(this.threeRenderer.autoClear=!0,this.threeRenderer.toneMapping=n.toneMapping,this.threeRenderer.render(n,n.camera)),this.multipleScenesVisible||!n.element.modelIsVisible&&n.renderCount===0?this.copyPixels(n,a,A):i.parentElement!==n.canvas.parentElement&&(n.canvas.parentElement.appendChild(i),n.canvas.classList.remove("show")),n.hasRendered(),++n.renderCount,this.renderedLastFrame=!0}}dispose(){this.textureUtils!=null&&this.textureUtils.dispose(),this.threeRenderer!=null&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const e=[];for(const t of this.scenes)e.push(t.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),e}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G=Symbol("correlatedObjects"),q=Symbol("onUpdate");class Ai{constructor(e,t){this[q]=e,this[G]=t}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MA=new Ge,Zf=new Cs(2,2);let ep=0;const pe=Symbol("threeTexture"),RA=Symbol("threeTextures");let tp=class extends Ai{get[pe](){var e;return(e=this[G])===null||e===void 0?void 0:e.values().next().value}get[RA](){return this[G]}constructor(e,t){super(e,new Set(t?[t]:[])),this[pe].image.src||(this[pe].image.src=t.name?t.name:"adhoc_image"+ep++),this[pe].image.name||(this[pe].image.name=t&&t.image&&t.image.src?t.image.src.split("/").pop():"adhoc_image")}get name(){return this[pe].image.name||""}get uri(){return this[pe].image.src}get bufferView(){return this[pe].image.bufferView}get element(){const e=this[pe];if(e&&(e.isCanvasTexture||e.isVideoTexture))return e.image}get animation(){const e=this[pe];if(e&&e.isCanvasTexture&&e.animation)return e.animation}get type(){return this.uri!=null?"external":"embedded"}set name(e){for(const t of this[RA])t.image.name=e}update(){const e=this[pe];e&&e.isCanvasTexture&&!e.animation&&(this[pe].needsUpdate=!0,this[q]())}async createThumbnail(e,t){const s=new It;MA.map=this[pe];const i=new Ae(Zf,MA);s.add(i);const n=new gn(-1,1,1,-1,0,1),{threeRenderer:r}=Le.singleton,a=new ii(e,t);r.setRenderTarget(a),r.render(s,n),r.setRenderTarget(null);const A=new Uint8Array(e*t*4);r.readRenderTargetPixels(a,0,0,e,t,A),dt.width=e,dt.height=t;const l=dt.getContext("2d"),h=l.createImageData(e,t);return h.data.set(A),l.putImageData(h,0,0),new Promise(async(c,u)=>{dt.toBlob(d=>{if(!d)return u("Failed to capture thumbnail.");c(URL.createObjectURL(d))},"image/png")})}};var ne;(function(o){o[o.Nearest=9728]="Nearest",o[o.Linear=9729]="Linear",o[o.NearestMipmapNearest=9984]="NearestMipmapNearest",o[o.LinearMipmapNearest=9985]="LinearMipmapNearest",o[o.NearestMipmapLinear=9986]="NearestMipmapLinear",o[o.LinearMipmapLinear=9987]="LinearMipmapLinear"})(ne||(ne={}));var pt;(function(o){o[o.ClampToEdge=33071]="ClampToEdge",o[o.MirroredRepeat=33648]="MirroredRepeat",o[o.Repeat=10497]="Repeat"})(pt||(pt={}));/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DA=new Map([[pt.Repeat,mt],[pt.ClampToEdge,Me],[pt.MirroredRepeat,In]]),ho=new Map([[mt,pt.Repeat],[Me,pt.ClampToEdge],[In,pt.MirroredRepeat]]),sp=new Map([[ne.Nearest,Es],[ne.Linear,ae],[ne.NearestMipmapNearest,fn],[ne.LinearMipmapNearest,pn],[ne.NearestMipmapLinear,mn],[ne.LinearMipmapLinear,ms]]),nh=new Map([[Es,ne.Nearest],[ae,ne.Linear],[fn,ne.NearestMipmapNearest],[pn,ne.LinearMipmapNearest],[mn,ne.NearestMipmapLinear],[ms,ne.LinearMipmapLinear]]),ip=new Map([[ne.Nearest,Es],[ne.Linear,ae]]),rh=new Map([[Es,ne.Nearest],[ae,ne.Linear]]),np=o=>nh.has(o),rp=o=>rh.has(o),op=o=>ho.has(o),ap=(o,e)=>{switch(o){case"minFilter":return np(e);case"magFilter":return rp(e);case"wrapS":case"wrapT":return op(e);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${o}" on Sampler`)}},je=Symbol("threeTexture"),_A=Symbol("threeTextures"),ot=Symbol("setProperty");class Ap extends Ai{get[je](){var e;return(e=this[G])===null||e===void 0?void 0:e.values().next().value}get[_A](){return this[G]}constructor(e,t){super(e,new Set(t?[t]:[]))}get name(){return this[je].name||""}get minFilter(){return nh.get(this[je].minFilter)}get magFilter(){return rh.get(this[je].magFilter)}get wrapS(){return ho.get(this[je].wrapS)}get wrapT(){return ho.get(this[je].wrapT)}get rotation(){return this[je].rotation}get scale(){return Io(this[je].repeat)}get offset(){return Io(this[je].offset)}setMinFilter(e){this[ot]("minFilter",sp.get(e))}setMagFilter(e){this[ot]("magFilter",ip.get(e))}setWrapS(e){this[ot]("wrapS",DA.get(e))}setWrapT(e){this[ot]("wrapT",DA.get(e))}setRotation(e){e==null&&(e=0),this[ot]("rotation",e)}setScale(e){e==null&&(e={u:1,v:1}),this[ot]("repeat",new Re(e.u,e.v))}setOffset(e){e==null&&(e={u:0,v:0}),this[ot]("offset",new Re(e.u,e.v))}[ot](e,t){if(ap(e,t))for(const s of this[_A])s[e]=t,s.needsUpdate=!0;this[q]()}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LA=Symbol("image"),FA=Symbol("sampler"),NA=Symbol("threeTexture");class oh extends Ai{constructor(e,t){super(e,new Set(t?[t]:[])),this[FA]=new Ap(e,t),this[LA]=new tp(e,t)}get[NA](){var e;return(e=this[G])===null||e===void 0?void 0:e.values().next().value}get name(){return this[NA].name||""}set name(e){for(const t of this[G])t.name=e}get sampler(){return this[FA]}get source(){return this[LA]}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ah,Ah,lh;const vt=Symbol("texture"),bt=Symbol("transform"),pr=Symbol("materials"),kA=Symbol("usage"),Jt=Symbol("onUpdate"),Js=Symbol("activeVideo");var U;(function(o){o[o.Base=0]="Base",o[o.MetallicRoughness=1]="MetallicRoughness",o[o.Normal=2]="Normal",o[o.Occlusion=3]="Occlusion",o[o.Emissive=4]="Emissive",o[o.Clearcoat=5]="Clearcoat",o[o.ClearcoatRoughness=6]="ClearcoatRoughness",o[o.ClearcoatNormal=7]="ClearcoatNormal",o[o.SheenColor=8]="SheenColor",o[o.SheenRoughness=9]="SheenRoughness",o[o.Transmission=10]="Transmission",o[o.Thickness=11]="Thickness",o[o.Specular=12]="Specular",o[o.SpecularColor=13]="SpecularColor",o[o.Iridescence=14]="Iridescence",o[o.IridescenceThickness=15]="IridescenceThickness",o[o.Anisotropy=16]="Anisotropy"})(U||(U={}));class os{constructor(e,t,s,i){this[ah]=null,this[Ah]={rotation:0,scale:new Re(1,1),offset:new Re(0,0)},this[lh]=!1,s&&(this[bt].rotation=s.rotation,this[bt].scale.copy(s.repeat),this[bt].offset.copy(s.offset),this[vt]=new oh(e,s)),this[Jt]=e,this[pr]=i,this[kA]=t}get texture(){return this[vt]}setTexture(e){var t,s;const i=e!=null?e.source[pe]:null,n=(t=this[vt])===null||t===void 0?void 0:t.source[pe];if(n!=null&&n.isVideoTexture?this[Js]=!1:!((s=this[vt])===null||s===void 0)&&s.source.animation&&this[vt].source.animation.removeEventListener("enterFrame",this[Jt]),this[vt]=e,i!=null&&i.isVideoTexture){const a=i.image;if(this[Js]=!0,a.requestVideoFrameCallback!=null){const A=()=>{this[Js]&&(this[Jt](),a.requestVideoFrameCallback(A))};a.requestVideoFrameCallback(A)}else{const A=()=>{this[Js]&&(this[Jt](),requestAnimationFrame(A))};requestAnimationFrame(A)}}else(e==null?void 0:e.source.animation)!=null&&e.source.animation.addEventListener("enterFrame",this[Jt]);let r=Ee;if(this[pr])for(const a of this[pr]){switch(this[kA]){case U.Base:a.map=i;break;case U.MetallicRoughness:r=te,a.metalnessMap=i,a.roughnessMap=i;break;case U.Normal:r=te,a.normalMap=i;break;case U.Occlusion:r=te,a.aoMap=i;break;case U.Emissive:a.emissiveMap=i;break;case U.Clearcoat:a.clearcoatMap=i;break;case U.ClearcoatRoughness:a.clearcoatRoughnessMap=i;break;case U.ClearcoatNormal:a.clearcoatNormalMap=i;break;case U.SheenColor:a.sheenColorMap=i;break;case U.SheenRoughness:a.sheenRoughnessMap=i;break;case U.Transmission:a.transmissionMap=i;break;case U.Thickness:a.thicknessMap=i;break;case U.Specular:a.specularIntensityMap=i;break;case U.SpecularColor:a.specularColorMap=i;break;case U.Iridescence:a.iridescenceMap=i;break;case U.IridescenceThickness:a.iridescenceThicknessMap=i;break;case U.Anisotropy:a.anisotropyMap=i;break}a.needsUpdate=!0}i&&(i.colorSpace=r,i.rotation=this[bt].rotation,i.repeat=this[bt].scale,i.offset=this[bt].offset),this[Jt]()}}ah=vt,Ah=bt,lh=Js;/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ls=Symbol("threeMaterial"),xi=Symbol("threeMaterials"),UA=Symbol("baseColorTexture"),GA=Symbol("metallicRoughnessTexture");class lp extends Ai{constructor(e,t){super(e,t);const{map:s,metalnessMap:i}=t.values().next().value;this[UA]=new os(e,U.Base,s,t),this[GA]=new os(e,U.MetallicRoughness,i,t)}get[xi](){return this[G]}get[Ls](){var e;return(e=this[G])===null||e===void 0?void 0:e.values().next().value}get baseColorFactor(){const e=[0,0,0,this[Ls].opacity];return this[Ls].color.toArray(e),e}get metallicFactor(){return this[Ls].metalness}get roughnessFactor(){return this[Ls].roughness}get baseColorTexture(){return this[UA]}get metallicRoughnessTexture(){return this[GA]}setBaseColorFactor(e){const t=new oe;e instanceof Array?t.fromArray(e):t.set(e);for(const s of this[xi])s.color.set(t),e instanceof Array&&e.length>3?s.opacity=e[3]:(e=[0,0,0,s.opacity],t.toArray(e));this[q]()}setMetallicFactor(e){for(const t of this[xi])t.metalness=e;this[q]()}setRoughnessFactor(e){for(const t of this[xi])t.roughness=e;this[q]()}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var OA,PA;const HA=Symbol("pbrMetallicRoughness"),$A=Symbol("normalTexture"),VA=Symbol("occlusionTexture"),qA=Symbol("emissiveTexture"),W=Symbol("backingThreeMaterial"),KA=Symbol("applyAlphaCutoff"),mr=Symbol("getAlphaMode"),Wt=Symbol("lazyLoadGLTFInfo"),Ir=Symbol("initialize"),uo=Symbol("getLoadedMaterial"),b=Symbol("ensureMaterialIsLoaded"),zA=Symbol("gltfIndex"),Ws=Symbol("setActive"),ls=Symbol("variantIndices"),Er=Symbol("isActive"),YA=Symbol("modelVariants"),Cr=Symbol("name"),Ce=Symbol("pbrTextures");class Br extends Ai{constructor(e,t,s,i,n,r,a=void 0){super(e,n),this[OA]=new Set,this[PA]=new Map,this[zA]=t,this[Er]=s,this[YA]=i,this[Cr]=r,a==null?this[Ir]():this[Wt]=a}get[(OA=ls,PA=Ce,W)](){return this[G].values().next().value}[Ir](){const e=this[q],t=this[G];this[HA]=new lp(e,t);const{normalMap:s,aoMap:i,emissiveMap:n}=t.values().next().value;this[$A]=new os(e,U.Normal,s,t),this[VA]=new os(e,U.Occlusion,i,t),this[qA]=new os(e,U.Emissive,n,t);const r=a=>{this[Ce].set(a,new os(e,a,null,t))};r(U.Clearcoat),r(U.ClearcoatRoughness),r(U.ClearcoatNormal),r(U.SheenColor),r(U.SheenRoughness),r(U.Transmission),r(U.Thickness),r(U.Specular),r(U.SpecularColor),r(U.Iridescence),r(U.IridescenceThickness),r(U.Anisotropy)}async[uo](){if(this[Wt]!=null){const e=await this[Wt].doLazyLoad();return this[Ir](),this[Wt]=void 0,this.ensureLoaded=async()=>{},e}return null}colorFromRgb(e){const t=new oe;return e instanceof Array?t.fromArray(e):t.set(e),t}[b](){if(this[Wt]!=null)throw new Error(`Material "${this.name}" has not been loaded, call 'await
    myMaterial.ensureLoaded()' before using an unloaded material.`)}async ensureLoaded(){await this[uo]()}get isLoaded(){return this[Wt]==null}get isActive(){return this[Er]}[Ws](e){this[Er]=e}get name(){return this[Cr]||""}set name(e){if(this[Cr]=e,this[G]!=null)for(const t of this[G])t.name=e}get pbrMetallicRoughness(){return this[b](),this[HA]}get normalTexture(){return this[b](),this[$A]}get occlusionTexture(){return this[b](),this[VA]}get emissiveTexture(){return this[b](),this[qA]}get emissiveFactor(){return this[b](),this[W].emissive.toArray()}get index(){return this[zA]}hasVariant(e){const t=this[YA].get(e);return t!=null&&this[ls].has(t.index)}setEmissiveFactor(e){this[b]();const t=this.colorFromRgb(e);for(const s of this[G])s.emissive.set(t);this[q]()}[mr](){return this[W].transparent?"BLEND":this[W].alphaTest>0?"MASK":"OPAQUE"}[KA](){this[b]();for(const e of this[G])this[mr]()==="MASK"?e.alphaTest==null&&(e.alphaTest=.5):e.alphaTest=void 0,e.needsUpdate=!0}setAlphaCutoff(e){this[b]();for(const t of this[G])t.alphaTest=e,t.needsUpdate=!0;this[KA](),this[q]()}getAlphaCutoff(){return this[b](),this[W].alphaTest}setDoubleSided(e){this[b]();for(const t of this[G])t.side=e?ft:xo,t.needsUpdate=!0;this[q]()}getDoubleSided(){return this[b](),this[W].side==ft}setAlphaMode(e){this[b]();const t=(s,i)=>{s.transparent=i,s.depthWrite=!i};for(const s of this[G])t(s,e==="BLEND"),e==="MASK"?s.alphaTest=.5:s.alphaTest=void 0,s.needsUpdate=!0;this[q]()}getAlphaMode(){return this[b](),this[mr]()}get emissiveStrength(){return this[b](),this[W].emissiveIntensity}setEmissiveStrength(e){this[b]();for(const t of this[G])t.emissiveIntensity=e;this[q]()}get clearcoatFactor(){return this[b](),this[W].clearcoat}get clearcoatRoughnessFactor(){return this[b](),this[W].clearcoatRoughness}get clearcoatTexture(){return this[b](),this[Ce].get(U.Clearcoat)}get clearcoatRoughnessTexture(){return this[b](),this[Ce].get(U.ClearcoatRoughness)}get clearcoatNormalTexture(){return this[b](),this[Ce].get(U.ClearcoatNormal)}get clearcoatNormalScale(){return this[b](),this[W].clearcoatNormalScale.x}setClearcoatFactor(e){this[b]();for(const t of this[G])t.clearcoat=e;this[q]()}setClearcoatRoughnessFactor(e){this[b]();for(const t of this[G])t.clearcoatRoughness=e;this[q]()}setClearcoatNormalScale(e){this[b]();for(const t of this[G])t.clearcoatNormalScale=new Re(e,e);this[q]()}get ior(){return this[b](),this[W].ior}setIor(e){this[b]();for(const t of this[G])t.ior=e;this[q]()}get sheenColorFactor(){return this[b](),this[W].sheenColor.toArray()}get sheenColorTexture(){return this[b](),this[Ce].get(U.SheenColor)}get sheenRoughnessFactor(){return this[b](),this[W].sheenRoughness}get sheenRoughnessTexture(){return this[b](),this[Ce].get(U.SheenRoughness)}setSheenColorFactor(e){this[b]();const t=this.colorFromRgb(e);for(const s of this[G])s.sheenColor.set(t),s.sheen=1;this[q]()}setSheenRoughnessFactor(e){this[b]();for(const t of this[G])t.sheenRoughness=e,t.sheen=1;this[q]()}get transmissionFactor(){return this[b](),this[W].transmission}get transmissionTexture(){return this[b](),this[Ce].get(U.Transmission)}setTransmissionFactor(e){this[b]();for(const t of this[G])t.transmission=e;this[q]()}get thicknessFactor(){return this[b](),this[W].thickness}get thicknessTexture(){return this[b](),this[Ce].get(U.Thickness)}get attenuationDistance(){return this[b](),this[W].attenuationDistance}get attenuationColor(){return this[b](),this[W].attenuationColor.toArray()}setThicknessFactor(e){this[b]();for(const t of this[G])t.thickness=e;this[q]()}setAttenuationDistance(e){this[b]();for(const t of this[G])t.attenuationDistance=e;this[q]()}setAttenuationColor(e){this[b]();const t=this.colorFromRgb(e);for(const s of this[G])s.attenuationColor.set(t);this[q]()}get specularFactor(){return this[b](),this[W].specularIntensity}get specularTexture(){return this[b](),this[Ce].get(U.Specular)}get specularColorFactor(){return this[b](),this[W].specularColor.toArray()}get specularColorTexture(){return this[b](),this[Ce].get(U.SheenColor)}setSpecularFactor(e){this[b]();for(const t of this[G])t.specularIntensity=e;this[q]()}setSpecularColorFactor(e){this[b]();const t=this.colorFromRgb(e);for(const s of this[G])s.specularColor.set(t);this[q]()}get iridescenceFactor(){return this[b](),this[W].iridescence}get iridescenceTexture(){return this[b](),this[Ce].get(U.Iridescence)}get iridescenceIor(){return this[b](),this[W].iridescenceIOR}get iridescenceThicknessMinimum(){return this[b](),this[W].iridescenceThicknessRange[0]}get iridescenceThicknessMaximum(){return this[b](),this[W].iridescenceThicknessRange[1]}get iridescenceThicknessTexture(){return this[b](),this[Ce].get(U.IridescenceThickness)}setIridescenceFactor(e){this[b]();for(const t of this[G])t.iridescence=e;this[q]()}setIridescenceIor(e){this[b]();for(const t of this[G])t.iridescenceIOR=e;this[q]()}setIridescenceThicknessMinimum(e){this[b]();for(const t of this[G])t.iridescenceThicknessRange[0]=e;this[q]()}setIridescenceThicknessMaximum(e){this[b]();for(const t of this[G])t.iridescenceThicknessRange[1]=e;this[q]()}get anisotropyStrength(){return this[b](),this[W].anisotropy}get anisotropyRotation(){return this[b](),this[W].anisotropyRotation}get anisotropyTexture(){return this[b](),this[Ce].get(U.Anisotropy)}setAnisotropyStrength(e){this[b]();for(const t of this[G])t.anisotropy=e;this[q]()}setAnisotropyRotation(e){this[b]();for(const t of this[G])t.anisotropyRotation=e;this[q]()}}let ch=class{constructor(e){this.name="",this.children=new Array,this.name=e}};class yr extends ch{constructor(e,t,s,i){super(e.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=e;const{gltf:n,threeGLTF:r,threeObjectMap:a}=i;this.parser=r.parser,this.modelVariants=s,this.mesh.userData.variantData=s;const A=a.get(e.material);A.materials!=null?this.initialMaterialIdx=this.activeMaterialIdx=A.materials:console.error(`Primitive (${e.name}) missing initial material reference.`);const l=e.userData.associations||{};if(l.meshes==null){console.error("Mesh is missing primitive index association");return}const u=((n.meshes||[])[l.meshes].primitives||[])[l.primitives];if(u==null){console.error("Mesh primitive definition is missing.");return}if(u.material!=null)this.materials.set(u.material,t[u.material]);else{const d=t.findIndex(g=>g.name==="Default");d>=0?this.materials.set(d,t[d]):console.warn("gltfPrimitive has no material!")}if(u.extensions&&u.extensions.KHR_materials_variants){const d=u.extensions.KHR_materials_variants,f=r.parser.json.extensions.KHR_materials_variants.variants;for(const p of d.mappings){const I=t[p.material];this.materials.set(p.material,I);for(const C of p.variants){const{name:w}=f[C];this.variantToMaterialMap.set(C,I),I[ls].add(C),s.has(w)||s.set(w,{name:w,index:C})}}}}async setActiveMaterial(e){const t=this.materials.get(e);if(e!==this.activeMaterialIdx){const s=t[G],i=await t[uo]();i!=null?this.mesh.material=i:this.mesh.material=s.values().next().value,this.parser.assignFinalMaterial(this.mesh),s.add(this.mesh.material),this.activeMaterialIdx=e}return this.mesh.material}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(e){return this.materials.get(e)}async enableVariant(e){if(e==null)return this.setActiveMaterial(this.initialMaterialIdx);if(this.variantToMaterialMap!=null&&this.modelVariants.has(e)){const t=this.modelVariants.get(e);return this.enableVariantHelper(t.index)}return null}async enableVariantHelper(e){if(this.variantToMaterialMap!=null&&e!=null){const t=this.variantToMaterialMap.get(e);if(t!=null)return this.setActiveMaterial(t.index)}return null}async instantiateVariants(){if(this.variantToMaterialMap!=null)for(const e of this.variantToMaterialMap.keys()){const t=this.mesh.userData.variantMaterials.get(e);if(t.material!=null)continue;const s=await this.enableVariantHelper(e);s!=null&&(t.material=s)}}get variantInfo(){return this.variantToMaterialMap}addVariant(e,t){if(!this.ensureVariantIsUnused(t))return!1;this.modelVariants.has(t)||this.modelVariants.set(t,{name:t,index:this.modelVariants.size});const i=this.modelVariants.get(t).index;return e[ls].add(i),this.variantToMaterialMap.set(i,e),this.materials.set(e.index,e),this.updateVariantUserData(i,e),!0}deleteVariant(e){if(this.variantInfo.has(e)){this.variantInfo.delete(e);const t=this.mesh.userData.variantMaterials;t!=null&&t.delete(e)}}updateVariantUserData(e,t){t[ls].add(e),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map,this.mesh.userData.variantMaterials.set(e,{material:t[G].values().next().value,gltfMaterialIndex:t.index})}ensureVariantIsUnused(e){const t=this.modelVariants.get(e);return t!=null&&this.variantInfo.has(t.index)?(console.warn(`Primitive cannot add variant '${e}' for this material, it already exists.`),!1):!0}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var JA,WA,jA,XA,ZA,el;const Qt=Symbol("materials"),vi=Symbol("hierarchy"),tl=Symbol("roots"),Xe=Symbol("primitives"),hh=Symbol("prepareVariantsForExport"),uh=Symbol("switchVariant"),dh=Symbol("materialFromPoint"),go=Symbol("nodeFromPoint"),gh=Symbol("nodeFromIndex"),ce=Symbol("variantData"),fo=Symbol("availableVariants"),wr=Symbol("modelOnUpdate"),sl=Symbol("cloneMaterial");class cp{constructor(e,t,s,i){this.gltf=e,this.gltfElementMap=t,this.mapKey=s,this.doLazyLoad=i}}class hp{constructor(e,t=()=>{}){this[JA]=new Array,this[WA]=new Array,this[jA]=new Array,this[XA]=new Array,this[ZA]=()=>{},this[el]=new Map,this[wr]=t;const{gltf:s,threeGLTF:i,gltfElementMap:n}=e;for(const[A,l]of s.materials.entries()){const h=n.get(l);if(h!=null)this[Qt].push(new Br(t,A,!0,this[ce],h,l.name));else{const u=(s.materials||[])[A],d=new Set;n.set(u,d);const g=async()=>{const f=await i.parser.getDependency("material",A);return d.add(f),f};this[Qt].push(new Br(t,A,!1,this[ce],d,l.name,new cp(s,n,u,g)))}}const r=new Map,a=new Array;for(const A of i.scene.children)a.push(A);for(;a.length>0;){const A=a.pop();let l=null;A instanceof Ae?(l=new yr(A,this.materials,this[ce],e),this[Xe].push(l)):l=new ch(A.name);const h=r.get(A);h!=null?h.children.push(l):this[tl].push(l),this[vi].push(l);for(const c of A.children)a.push(c),r.set(A,l)}}get materials(){return this[Qt]}[(JA=Qt,WA=vi,jA=tl,XA=Xe,ZA=wr,el=ce,fo)](){const e=Array.from(this[ce].values());return e.sort((t,s)=>t.index-s.index),e.map(t=>t.name)}getMaterialByName(e){const t=this[Qt].filter(s=>s.name===e);return t.length>0?t[0]:null}[gh](e,t){const s=this[vi].find(i=>{if(i instanceof yr){const{meshes:n,primitives:r}=i.mesh.userData.associations;if(n==e&&r==t)return!0}return!1});return s??null}[go](e){return this[vi].find(t=>t instanceof yr&&t.mesh===e.object)}[dh](e){return this[go](e).getActiveMaterial()}async[uh](e){for(const t of this[Xe])await t.enableVariant(e);for(const t of this.materials)t[Ws](!1);for(const t of this[Xe])this.materials[t.getActiveMaterial().index][Ws](!0)}async[hh](){const e=new Array;for(const t of this[Xe])e.push(t.instantiateVariants());await Promise.all(e)}[sl](e,t){const s=this.materials[e];s.isLoaded||console.error(`Cloning an unloaded material,
           call 'material.ensureLoaded() before cloning the material.`);const i=s[G],n=new Set;for(const[a,A]of i.entries()){const l=A.clone();l.name=t+(i.size>1?"_inst"+a:""),n.add(l)}const r=new Br(this[wr],this[Qt].length,!1,this[ce],n,t);return this[Qt].push(r),r}createMaterialInstanceForVariant(e,t,s,i=!0){let n=null;for(const r of this[Xe]){const a=this[ce].get(s);a!=null&&r.variantInfo.has(a.index)||r.getMaterial(e)!=null&&(this.hasVariant(s)||this.createVariant(s),n==null&&(n=this[sl](e,t)),r.addVariant(n,s))}if(i&&n!=null){n[Ws](!0),this.materials[e][Ws](!1);for(const r of this[Xe])r.enableVariant(s)}return n}createVariant(e){this[ce].has(e)?console.warn(`Variant '${e}'' already exists`):this[ce].set(e,{name:e,index:this[ce].size})}hasVariant(e){return this[ce].has(e)}setMaterialToVariant(e,t){if(this[fo]().find(s=>s===t)==null){console.warn(`Can't add material to '${t}', the variant does not exist.'`);return}if(e<0||e>=this.materials.length){console.error("setMaterialToVariant(): materialIndex is out of bounds.");return}for(const s of this[Xe]){const i=s.getMaterial(e);i!=null&&s.addVariant(i,t)}}updateVariantName(e,t){const s=this[ce].get(e);s!=null&&(s.name=t,this[ce].set(t,s),this[ce].delete(e))}deleteVariant(e){const t=this[ce].get(e);if(t!=null){for(const s of this.materials)s.hasVariant(e)&&s[ls].delete(t.index);for(const s of this[Xe])s.deleteVariant(t.index);this[ce].delete(e)}}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qr=function(o,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(o,e,t,s);else for(var a=o.length-1;a>=0;a--)(r=o[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const Yi=Symbol("currentGLTF"),Ji=Symbol("originalGltfJson"),Tt=Symbol("model"),Sr=Symbol("getOnUpdateMethod"),Fs=Symbol("buildTexture"),up=o=>{var e,t,s;class i extends o{constructor(){super(...arguments),this[e]=void 0,this[t]=null,this[s]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[Tt]}get availableVariants(){return this.model?this.model[fo]():[]}get originalGltfJson(){return this[Ji]}[(e=Tt,t=Yi,s=Ji,Sr)](){return()=>{this[ue]()}}[Fs](r){return r.colorSpace=Ee,r.wrapS=mt,r.wrapT=mt,new oh(this[Sr](),r)}async createTexture(r,a="image/png"){const{textureUtils:A}=this[Y],l=await A.loadImage(r,this.withCredentials);return l.userData.mimeType=a,this[Fs](l)}async createLottieTexture(r,a=1){const{textureUtils:A}=this[Y],l=await A.loadLottie(r,a,this.withCredentials);return this[Fs](l)}createVideoTexture(r){const a=document.createElement("video");a.crossOrigin=this.withCredentials?"use-credentials":"anonymous",a.src=r,a.muted=!0,a.playsInline=!0,a.loop=!0,a.play();const A=new mu(a);return this[Fs](A)}createCanvasTexture(){const r=document.createElement("canvas"),a=new Xl(r);return this[Fs](a)}async updated(r){if(super.updated(r),r.has("variantName")){const a=this[Ft].beginActivity("variant-update");a(.1);const A=this[Tt],{variantName:l}=this;A!=null&&(await A[uh](l),this[ue](),this.dispatchEvent(new CustomEvent("variant-applied"))),a(1)}if(r.has("orientation")||r.has("scale")){if(!this.loaded)return;const a=this[x];a.applyTransform(),a.updateBoundingBox(),a.updateShadow(),this[Y].arRenderer.onUpdateScene(),this[ue]()}}[Ke](){super[Ke]();const{currentGLTF:r}=this[x];if(r!=null){const{correlatedSceneGraph:a}=r;a!=null&&r!==this[Yi]&&(this[Tt]=new hp(a,this[Sr]()),this[Ji]=JSON.parse(JSON.stringify(a.gltf))),"variants"in r.userData&&this.requestUpdate("variantName")}this[Yi]=r}async exportScene(r){const a=this[x];return new Promise(async(A,l)=>{const h={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(h,r),h.animations=a.animations,h.truncateDrawRange=!0;const c=a.shadow;let u=!1;c!=null&&(u=c.visible,c.visible=!1),await this[Tt][hh](),new _o().register(g=>new Rg(g)).parse(a.model,g=>A(new Blob([h.binary?g:JSON.stringify(g)],{type:h.binary?"application/octet-stream":"application/json"})),()=>l("glTF export failed"),h),c!=null&&(c.visible=u)})}materialFromPoint(r,a){const A=this[Tt];if(A==null)return null;const l=this[x],h=l.getNDC(r,a),c=l.hitFromPoint(h);return c==null||c.face==null?null:A[dh](c)}}return Qr([k({type:String,attribute:"variant-name"})],i.prototype,"variantName",void 0),Qr([k({type:String,attribute:"orientation"})],i.prototype,"orientation",void 0),Qr([k({type:String,attribute:"scale"})],i.prototype,"scale",void 0),i};/* @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp extends Ae{constructor(){super(void 0,new Ge({depthWrite:!1})),this.height=0,this.radius=0,this.resolution=0,this.userData.noHit=!0}get map(){return this.material.map}set map(e){this.material.map=e}isUsable(){return this.height>0&&this.radius>0&&this.geometry!=null&&this.map!=null}updateGeometry(e=this.height,t=this.radius,s=128){(e!=this.height||t!=this.radius||s!=this.resolution)&&(this.height=e,this.radius=t,this.resolution=s,e>0&&t>0&&(this.geometry.dispose(),this.geometry=gp(e,t,s)))}}function gp(o,e,t){const s=new Iu(e,2*t,t);s.scale(1,1,-1);const i=s.getAttribute("position"),n=new F;for(let r=0;r<i.count;++r)if(n.fromBufferAttribute(i,r),n.y<0){const a=-o*3/2,A=n.y<a?-o/n.y:1-n.y*n.y/(3*a*a);n.multiplyScalar(A),n.toArray(i.array,3*r)}return i.needsUpdate=!0,s}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bi=new F,xr=new F,vr=new F,Ti=new To,il=new sc,nl=new Is;class fh extends og{constructor(e){super(document.createElement("div")),this.normal=new F(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=e.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(e.position),this.updateNormal(e.normal),this.surface=e.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){(!this.facingCamera||!this.initialized)&&this.updateVisibility(!0)}hide(){(this.facingCamera||!this.initialized)&&this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,this.referenceCount===0}updatePosition(e){if(e==null)return;const t=nt(e)[0].terms;for(let s=0;s<3;++s)this.position.setComponent(s,He(t[s]).number);this.updateMatrixWorld()}updateNormal(e){if(e==null)return;const t=nt(e)[0].terms;for(let s=0;s<3;++s)this.normal.setComponent(s,t[s].number)}updateSurface(){const{mesh:e,tri:t,bary:s}=this;if(e==null||t==null||s==null)return;e.getVertexPosition(t.x,bi),e.getVertexPosition(t.y,xr),e.getVertexPosition(t.z,vr),bi.toArray(Ti.elements,0),xr.toArray(Ti.elements,3),vr.toArray(Ti.elements,6),this.position.copy(s).applyMatrix3(Ti);const i=this.parent;i.worldToLocal(e.localToWorld(this.position)),il.set(bi,xr,vr),il.getNormal(this.normal).transformDirection(e.matrixWorld);const n=i.parent;nl.setFromAxisAngle(bi.set(0,1,0),-n.rotation.y),this.normal.applyQuaternion(nl)}orient(e){this.pivot.style.transform=`rotate(${e}rad)`}updateVisibility(e){this.element.classList.toggle("hide",!e),this.slot.assignedNodes().forEach(t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const s=t,i=s.dataset.visibilityAttribute;if(i!=null){const n=`data-${i}`;s.toggleAttribute(n,e)}s.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))}),this.initialized=!0}}const fp={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},pp={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};function rl(o,e,t){return(1-t)*o+t*e}/* @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ol=9,mp=6,br=2,Ip=.3;class Ep extends hs{constructor(e,t,s){super(),this.camera=new gn,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new Eu,this.horizontalBlurMaterial=new us(fp),this.verticalBlurMaterial=new us(pp),this.intensity=0,this.softness=1,this.boundingBox=new Rt,this.size=new F,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:i}=this;i.rotation.x=Math.PI/2,i.left=-.5,i.right=.5,i.bottom=-.5,i.top=.5,this.add(i);const n=new Cs,r=new Ge({opacity:1,transparent:!0,side:Mo});this.floor=new Ae(n,r),this.floor.userData.noHit=!0,i.add(this.floor),this.blurPlane=new Ae(n),this.blurPlane.visible=!1,i.add(this.blurPlane),e.target.add(this),this.depthMaterial.onBeforeCompile=function(a){a.fragmentShader=a.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(e,t,s)}setScene(e,t,s){const{boundingBox:i,size:n,rotation:r,position:a}=this;if(this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),this.maxDimension=Math.max(n.x,n.y,n.z)*(this.isAnimated?br:1),this.boundingBox.getCenter(a),s==="back"){const{min:A,max:l}=i;[A.y,A.z]=[A.z,A.y],[l.y,l.z]=[l.z,l.y],[n.y,n.z]=[n.z,n.y],r.x=Math.PI/2,r.y=Math.PI}else r.x=0,r.y=0;if(this.isAnimated){const A=i.min.y,l=i.max.y;n.y=this.maxDimension,i.expandByVector(n.subScalar(this.maxDimension).multiplyScalar(-.5)),i.min.y=A,i.max.y=l,n.set(this.maxDimension,l-A,this.maxDimension)}s==="bottom"?a.y=i.min.y:a.z=i.min.y,this.setSoftness(t)}setSoftness(e){this.softness=e;const{size:t,camera:s}=this,i=this.isAnimated?br:1,n=i*Math.pow(2,ol-e*(ol-mp));this.setMapSize(n);const r=t.y/2,a=t.y*i;s.near=0,s.far=rl(a,r,e),this.depthMaterial.opacity=1/e,s.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(e){const{size:t}=this;this.isAnimated&&(e*=br);const s=Math.floor(t.x>t.z?e:e*t.x/t.z),i=Math.floor(t.x>t.z?e*t.z/t.x:e),n=10,r=n+s,a=n+i;if(this.renderTarget!=null&&(this.renderTarget.width!==r||this.renderTarget.height!==a)&&(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),this.renderTarget==null){const A={format:Qe};this.renderTarget=new ii(r,a,A),this.renderTargetBlur=new ii(r,a,A),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(t.x*(1+n/s),t.z*(1+n/i),1),this.needsUpdate=!0}setIntensity(e){this.intensity=e,e>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=e*rl(Ip,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(e){this.floor.position.z=-e+this.gap()}gap(){return .001*this.maxDimension}render(e,t){t.overrideMaterial=this.depthMaterial;const s=e.getClearAlpha();e.setClearAlpha(0),this.floor.visible=!1;const i=e.xr.enabled;e.xr.enabled=!1;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.render(t,this.camera),t.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(e),e.xr.enabled=i,e.setRenderTarget(n),e.setClearAlpha(s)}blurShadow(e){const{camera:t,horizontalBlurMaterial:s,verticalBlurMaterial:i,renderTarget:n,renderTargetBlur:r,blurPlane:a}=this;a.visible=!0,a.material=s,s.uniforms.h.value=1/this.renderTarget.width,s.uniforms.tDiffuse.value=this.renderTarget.texture,e.setRenderTarget(r),e.render(a,t),a.material=i,i.uniforms.v.value=1/this.renderTarget.height,i.uniforms.tDiffuse.value=this.renderTargetBlur.texture,e.setRenderTarget(n),e.render(a,t),a.visible=!1}dispose(){this.renderTarget!=null&&this.renderTarget.dispose(),this.renderTargetBlur!=null&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const al=10,Tr=100,Mr=new F,Al=new F,ll=new F,Mi=new Cu,Cp=new F,Ns=new Re;class Bp extends It{constructor({canvas:e,element:t,width:s,height:i}){super(),this.annotationRenderer=new ag,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.camera=new si(45,1,.1,100),this.xrCamera=null,this.url=null,this.pivot=new hs,this.target=new hs,this.animationNames=[],this.boundingBox=new Rt,this.boundingSphere=new vo,this.size=new F,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.toneMapping=Qo,this.canScale=!0,this.isDirty=!1,this.goalTarget=new F,this.targetDamperX=new Ie,this.targetDamperY=new Ie,this.targetDamperZ=new Ie,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.groundedSkybox=new dp,this.name="ModelScene",this.element=t,this.canvas=e,this.camera=new si(45,1,.1,100),this.camera.name="MainCamera",this.add(this.pivot),this.pivot.name="Pivot",this.pivot.add(this.target),this.setSize(s,i),this.target.name="Target",this.mixer=new Bu(this.target);const{domElement:n}=this.annotationRenderer,{style:r}=n;r.display="none",r.pointerEvents="none",r.position="absolute",r.top="0",this.element.shadowRoot.querySelector(".default").appendChild(n),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return this.xrCamera!=null?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}async setObject(e){this.reset(),this._model=e,this.target.add(e),await this.setupScene()}async setSource(e,t=()=>{}){if(!e||e===this.url){t(1);return}if(this.reset(),this.url=e,this.externalRenderer!=null){const a=await this.externalRenderer.load(t);this.boundingSphere.radius=a.framedRadius,this.idealAspect=a.fieldOfViewAspect;return}this.cancelPendingSourceChange!=null&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);let s;try{s=await new Promise(async(a,A)=>{this.cancelPendingSourceChange=()=>A();try{const l=await this.element[Y].loader.load(e,this.element,t);a(l)}catch(l){A(l)}})}catch(a){if(a==null)return;throw a}this.cancelPendingSourceChange=null,this.reset(),this.url=e,this._currentGLTF=s,s!=null&&(this._model=s.scene,this.target.add(s.scene));const{animations:i}=s,n=new Map,r=[];for(const a of i)n.set(a.name,a),r.push(a.name);this.animations=i,this.animationsByName=n,this.animationNames=r,await this.setupScene()}async setupScene(){this.applyTransform(),this.updateBoundingBox(),await this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity),this.setGroundedSkybox()}reset(){this.url=null,this.renderCount=0,this.queueRender(),this.shadow!=null&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:e}=this;e!=null&&(e.removeFromParent(),this._model=null);const t=this._currentGLTF;t!=null&&(t.dispose(),this._currentGLTF=null),this.currentAnimationAction!=null&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),this.shadow!=null&&(this.shadow.dispose(),this.shadow=null),this.element[Yi]=null,this.element[Ji]=null,this.element[Tt]=null}get currentGLTF(){return this._currentGLTF}setSize(e,t){if(!(this.width===e&&this.height===t)){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,this.externalRenderer!=null){const s=window.devicePixelRatio;this.externalRenderer.resize(e*s,t*s)}this.queueRender()}}markBakedShadow(e){e.userData.noHit=!0,this.bakedShadows.add(e)}unmarkBakedShadow(e){e.userData.noHit=!1,e.visible=!0,this.bakedShadows.delete(e),this.boundingBox.expandByObject(e)}findBakedShadows(e){const t=new Rt;e.traverse(s=>{const i=s;if(!i.material||!i.material.transparent)return;t.setFromObject(i);const r=t.getSize(Cp),a=Math.min(r.x,r.y,r.z);Math.max(r.x,r.y,r.z)<Tr*a||this.markBakedShadow(i)})}checkBakedShadows(){const{min:e,max:t}=this.boundingBox,s=new Rt;this.boundingBox.getSize(this.size);for(const i of this.bakedShadows)s.setFromObject(i),!(s.min.y<e.y+this.size.y/Tr&&s.min.x<=e.x&&s.max.x>=t.x&&s.min.z<=e.z&&s.max.z>=t.z)&&(s.min.z<e.z+this.size.z/Tr&&s.min.x<=e.x&&s.max.x>=t.x&&s.min.y<=e.y&&s.max.y>=t.y||this.unmarkBakedShadow(i))}applyTransform(){const{model:e}=this;if(e==null)return;const t=nt(this.element.orientation)[0].terms,s=He(t[0]).number,i=He(t[1]).number,n=He(t[2]).number;e.quaternion.setFromEuler(new ec(i,n,s,"YXZ"));const r=nt(this.element.scale)[0].terms;e.scale.set(r[0].number,r[1].number,r[2].number)}updateBoundingBox(){const{model:e}=this;if(e==null)return;this.target.remove(e),this.findBakedShadows(e);const t=(s,i)=>s.expandByPoint(i);this.setBakedShadowVisibility(!1),this.boundingBox=di(e,t,new Rt),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach(s=>this.unmarkBakedShadow(s)),this.boundingBox=di(e,t,new Rt)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(e)}async updateFraming(){const{model:e}=this;if(e==null)return;this.target.remove(e),this.setBakedShadowVisibility(!1);const{center:t}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),await this.element.updateComplete,t.copy(this.getTarget());const s=(n,r)=>Math.max(n,t.distanceToSquared(r));this.boundingSphere.radius=Math.sqrt(di(e,s,0));const i=(n,r)=>{r.sub(t);const a=Math.sqrt(r.x*r.x+r.z*r.z);return Math.max(n,a/(this.idealCameraDistance()-Math.abs(r.y)))};this.idealAspect=di(e,i,0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(e)}setBakedShadowVisibility(e=this.shadowIntensity<=0){for(const t of this.bakedShadows)t.visible=e}idealCameraDistance(){const e=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(e)}adjustedFoV(e){const t=Math.tan(e/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(t)*180/Math.PI}getNDC(e,t){if(this.xrCamera!=null)Ns.set(e/window.screen.width,t/window.screen.height);else{const s=this.element.getBoundingClientRect();Ns.set((e-s.x)/this.width,(t-s.y)/this.height)}return Ns.multiplyScalar(2).subScalar(1),Ns.y*=-1,Ns}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(e,t){this.element[Y].arRenderer.presentedScene!==this&&(this.environment=e,this.setBackground(t),this.queueRender())}setBackground(e){this.groundedSkybox.map=e,this.groundedSkybox.isUsable()?(this.target.add(this.groundedSkybox),this.background=null):(this.target.remove(this.groundedSkybox),this.background=e)}farRadius(){return this.boundingSphere.radius*(this.groundedSkybox.parent!=null?al:1)}setGroundedSkybox(){const e=nt(this.element.skyboxHeight)[0].terms[0],t=He(e).number,s=al*this.boundingSphere.radius;this.groundedSkybox.updateGeometry(t,s),this.groundedSkybox.position.y=t-(this.shadow?2*this.shadow.gap():0),this.setBackground(this.groundedSkybox.map)}setTarget(e,t,s){this.goalTarget.set(-e,-t,-s)}setTargetDamperDecayTime(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}getDynamicTarget(){return this.target.position.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(kc)}updateTarget(e){const t=this.goalTarget,s=this.target.position;if(t.equals(s))return!1;{const i=this.boundingSphere.radius/10;let{x:n,y:r,z:a}=s;return n=this.targetDamperX.update(n,t.x,e,i),r=this.targetDamperY.update(r,t.y,e,i),a=this.targetDamperZ.update(a,t.z,e,i),this.groundedSkybox.position.x=-n,this.groundedSkybox.position.z=-a,this.target.position.set(n,r,a),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(e,t){const{x:s,z:i}=this.position;this.yaw=Math.atan2(e-s,t-i)}get model(){return this._model}set yaw(e){this.pivot.rotation.y=e,this.groundedSkybox.rotation.y=-e,this.queueRender()}get yaw(){return this.pivot.rotation.y}set animationTime(e){this.mixer.setTime(e),this.queueShadowRender()}get animationTime(){if(this.currentAnimationAction!=null){const e=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop===ic&&(e&1)===1?this.duration-this.currentAnimationAction.time:this.currentAnimationAction.time}return 0}set animationTimeScale(e){this.mixer.timeScale=e}get animationTimeScale(){return this.mixer.timeScale}get duration(){return this.currentAnimationAction!=null&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return this.currentAnimationAction!=null}playAnimation(e=null,t=0,s=nc,i=1/0){if(this._currentGLTF==null)return;const{animations:n}=this;if(n==null||n.length===0)return;let r=null;if(e!=null&&(r=this.animationsByName.get(e),r==null)){const a=parseInt(e);!isNaN(a)&&a>=0&&a<n.length&&(r=n[a])}r==null&&(r=n[0]);try{const{currentAnimationAction:a}=this,A=this.mixer.clipAction(r,this);this.currentAnimationAction=A,this.element.paused?this.mixer.stopAllAction():(A.paused=!1,a!=null&&A!==a?A.crossFadeFrom(a,t,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),A.setLoop(s,i),A.enabled=!0,A.clampWhenFinished=!0,A.play()}catch(a){console.error(a)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(e){this.mixer.update(e),this.queueShadowRender()}subscribeMixerEvent(e,t){this.mixer.addEventListener(e,t)}updateShadow(){const e=this.shadow;if(e!=null){const t=this.element.arPlacement==="wall"?"back":"bottom";e.setScene(this,this.shadowSoftness,t),e.needsUpdate=!0}}renderShadow(e){const t=this.shadow;t!=null&&t.needsUpdate==!0&&(t.render(e,this),t.needsUpdate=!1)}queueShadowRender(){this.shadow!=null&&(this.shadow.needsUpdate=!0)}setShadowIntensity(e){if(this.shadowIntensity=e,this._currentGLTF!=null&&(this.setBakedShadowVisibility(),!(e<=0&&this.shadow==null))){if(this.shadow==null){const t=this.element.arPlacement==="wall"?"back":"bottom";this.shadow=new Ep(this,this.shadowSoftness,t)}this.shadow.setIntensity(e)}}setShadowSoftness(e){this.shadowSoftness=e;const t=this.shadow;t!=null&&t.setSoftness(e)}setShadowOffset(e){const t=this.shadow;t!=null&&t.setOffset(e)}getHit(e=this){return Mi.intersectObject(e,!0).find(s=>s.object.visible&&!s.object.userData.noHit)}hitFromController(e,t=this){return Mi.setFromXRController(e),this.getHit(t)}hitFromPoint(e,t=this){return Mi.setFromCamera(e,this.getCamera()),this.getHit(t)}positionAndNormalFromPoint(e,t=this){var s;const i=this.hitFromPoint(e,t);if(i==null)return null;const n=i.point,r=i.face!=null?i.face.normal.clone().applyNormalMatrix(new To().getNormalMatrix(i.object.matrixWorld)):Mi.ray.direction.clone().multiplyScalar(-1),a=(s=i.uv)!==null&&s!==void 0?s:null;return{position:n,normal:r,uv:a}}surfaceFromPoint(e,t=this){const s=this.element.model;if(s==null)return null;const i=this.hitFromPoint(e,t);if(i==null||i.face==null)return null;const n=s[go](i),{meshes:r,primitives:a}=n.mesh.userData.associations,A=new F,l=new F,h=new F,{a:c,b:u,c:d}=i.face,g=i.object;g.getVertexPosition(c,A),g.getVertexPosition(u,l),g.getVertexPosition(d,h);const f=new sc(A,l,h),p=new F;return f.getBarycoord(g.worldToLocal(i.point),p),`${r} ${a} ${c} ${u} ${d} ${p.x.toFixed(3)} ${p.y.toFixed(3)} ${p.z.toFixed(3)}`}addHotspot(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element),this.updateSurfaceHotspot(e)}removeHotspot(e){this.target.remove(e)}forHotspots(e){const{children:t}=this.target;for(let s=0,i=t.length;s<i;s++){const n=t[s];n instanceof fh&&e(n)}}updateSurfaceHotspot(e){if(e.surface==null||this.element.model==null)return;const t=nt(e.surface)[0].terms;if(t.length!=8){console.warn(e.surface+" does not have exactly 8 numbers.");return}const s=this.element.model[gh](t[0].number,t[1].number);if(s==null){console.warn(e.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");return}const i=s.mesh.geometry.attributes.position.count,n=new F(t[2].number,t[3].number,t[4].number);if(n.x>=i||n.y>=i||n.z>=i){console.warn(e.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");return}const r=new F(t[5].number,t[6].number,t[7].number);e.mesh=s.mesh,e.tri=n,e.bary=r,e.updateSurface()}animateSurfaceHotspots(){this.element.paused||this.forHotspots(e=>{e.updateSurface()})}updateHotspotsVisibility(e){this.forHotspots(t=>{Mr.copy(e),Al.setFromMatrixPosition(t.matrixWorld),Mr.sub(Al),ll.copy(t.normal).transformDirection(this.target.matrixWorld),Mr.dot(ll)<0?t.hide():t.show()})}orientHotspots(e){this.forHotspots(t=>{t.orient(e)})}setHotspotsVisibility(e){this.forHotspots(t=>{t.visible=e})}updateSchema(e){var t;const{schemaElement:s,element:i}=this,{alt:n,poster:r,iosSrc:a}=i;if(e!=null){const A=[{"@type":"MediaObject",contentUrl:e,encodingFormat:((t=e.split(".").pop())===null||t===void 0?void 0:t.toLowerCase())==="gltf"?"model/gltf+json":"model/gltf-binary"}];a&&A.push({"@type":"MediaObject",contentUrl:a,encodingFormat:"model/vnd.usdz+zip"});const l={"@context":"http://schema.org/","@type":"3DModel",image:r??void 0,name:n??void 0,encoding:A};s.textContent=JSON.stringify(l),document.head.appendChild(s)}else s.parentElement!=null&&s.parentElement.removeChild(s)}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(e){const t={progress:0,completed:!1};return this.ongoingActivities.add(t),this.ongoingActivityCount===1&&this.announceTotalProgress(t,0,e),s=>{let i;return i=Math.max(Ue(s,0,1),t.progress),i!==t.progress&&this.announceTotalProgress(t,i,e),t.progress}}announceTotalProgress(e,t,s){let i=0,n=0;t==1&&(e.completed=!0);for(const A of this.ongoingActivities){const{progress:l}=A;i+=1-l,A.completed&&n++}const r=e.progress;e.progress=t,this.totalProgress+=(t-r)*(1-this.totalProgress)/i;const a=n===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:a,reason:s}})),n===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qn=function(o,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(o,e,t,s);else for(var a=o.length-1;a>=0;a--)(r=o[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n},cl,hl,ul,dl,gl,fl,pl,ml,Il,El,Cl,Bl,yl;const wp=10,Qp=50,Sp=0,xp=300,vp=150,dt=document.createElement("canvas"),Rr=Symbol("fallbackResizeHandler"),wl=Symbol("defaultAriaLabel"),Ri=Symbol("resizeObserver"),jt=Symbol("clearModelTimeout"),Dr=Symbol("onContextLost"),Xt=Symbol("loaded"),_r=Symbol("status"),Lr=Symbol("onFocus"),Fr=Symbol("onBlur"),ns=Symbol("updateSize"),Di=Symbol("intersectionObserver"),Mt=Symbol("isElementInViewport"),an=Symbol("announceModelVisibility"),as=Symbol("ariaLabel"),po=Symbol("altDefaulted"),ks=Symbol("statusElement"),An=Symbol("updateStatus"),js=Symbol("loadedTime"),cs=Symbol("updateSource"),Ql=Symbol("markLoaded"),Wi=Symbol("container"),_e=Symbol("input"),mo=Symbol("canvas"),x=Symbol("scene"),ue=Symbol("needsRender"),qe=Symbol("tick"),Ke=Symbol("onModelLoad"),ln=Symbol("onResize"),Y=Symbol("renderer"),Ft=Symbol("progressTracker"),Sl=Symbol("getLoaded"),Nt=Symbol("getModelIsVisible"),ps=Symbol("shouldAttemptPreload"),ut=o=>({x:o.x,y:o.y,z:o.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),Io=o=>({u:o.x,v:o.y,toString(){return`${this.u} ${this.v}`}});class li extends Dt{constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[cl]=!1,this[hl]=!1,this[ul]=0,this[dl]="",this[gl]=null,this[fl]=Aa(()=>{const i=this.getBoundingClientRect();this[ns](i)},Qp),this[pl]=Aa(i=>{const n=this.modelIsVisible;n!==i&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:n}}))},Sp),this[ml]=null,this[Il]=null,this[El]=new yp,this[Cl]=()=>{this[ks].textContent=this[_r]},this[Bl]=()=>{this[ks].textContent=""},this[yl]=i=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:i.sourceEvent}}))},this.attachShadow({mode:"open"});const e=this.shadowRoot;nd(e),this[Wi]=e.querySelector(".container"),this[_e]=e.querySelector(".userInput"),this[mo]=e.querySelector("canvas"),this[ks]=e.querySelector("#status"),this[wl]=this[_e].getAttribute("aria-label");let t,s;if(this.isConnected){const i=this.getBoundingClientRect();t=i.width,s=i.height}else t=xp,s=vp;this[x]=new Bp({canvas:this[mo],element:this,width:t,height:s}),Promise.resolve().then(()=>{this[ns](this.getBoundingClientRect())}),Nn&&(this[Ri]=new ResizeObserver(i=>{if(!this[Y].isPresenting)for(let n of i)n.target===this&&this[ns](n.contentRect)})),kn?this[Di]=new IntersectionObserver(i=>{for(let n of i)if(n.target===this){const r=this.modelIsVisible;this[Mt]=n.isIntersecting,this[an](r),this[Mt]&&!this.loaded&&this[cs]()}},{root:null,rootMargin:"0px",threshold:1e-5}):this[Mt]=!0}static get is(){return"model-viewer"}static set modelCacheSize(e){me[lt].evictionThreshold=e}static get modelCacheSize(){return me[lt].evictionThreshold}static set minimumRenderScale(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),Le.singleton.minScale=e}static get minimumRenderScale(){return Le.singleton.minScale}get loaded(){return this[Sl]()}get[(cl=Mt,hl=Xt,ul=js,dl=_r,gl=jt,fl=Rr,pl=an,ml=Ri,Il=Di,El=Ft,Y)](){return Le.singleton}get modelIsVisible(){return this[Nt]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),Nn?this[Ri].observe(this):self.addEventListener("resize",this[Rr]),kn&&this[Di].observe(this),this.addEventListener("focus",this[Lr]),this.addEventListener("blur",this[Fr]);const e=this[Y];e.addEventListener("contextlost",this[Dr]),e.registerScene(this[x]),this[jt]!=null&&(self.clearTimeout(this[jt]),this[jt]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),Nn?this[Ri].unobserve(this):self.removeEventListener("resize",this[Rr]),kn&&this[Di].unobserve(this),this.removeEventListener("focus",this[Lr]),this.removeEventListener("blur",this[Fr]);const e=this[Y];e.removeEventListener("contextlost",this[Dr]),e.unregisterScene(this[x]),this[jt]=self.setTimeout(()=>{this[x].dispose(),this[jt]=null},wp)}updated(e){super.updated(e),e.has("src")&&(this.src==null?(this[Xt]=!1,this[js]=0,this[x].reset()):this.src!==this[x].url&&(this[Xt]=!1,this[js]=0,this[cs]())),e.has("alt")&&this[_e].setAttribute("aria-label",this[as]),e.has("generateSchema")&&(this.generateSchema?this[x].updateSchema(this.src):this[x].updateSchema(null))}toDataURL(e,t){return this[Y].displayCanvas(this[x]).toDataURL(e,t)}async toBlob(e){const t=e?e.mimeType:void 0,s=e?e.qualityArgument:void 0,i=e?e.idealAspect:void 0,{width:n,height:r,idealAspect:a,aspect:A}=this[x],{dpr:l,scaleFactor:h}=this[Y];let c=n*h*l,u=r*h*l,d=0,g=0;if(i===!0)if(a>A){const f=u;u=Math.round(c/a),g=(f-u)/2}else{const f=c;c=Math.round(u*a),d=(f-c)/2}dt.width=c,dt.height=u;try{return new Promise(async(f,p)=>{dt.getContext("2d").drawImage(this[Y].displayCanvas(this[x]),d,g,c,u,0,0,c,u),dt.toBlob(I=>{if(!I)return p(new Error("Unable to retrieve canvas blob"));f(I)},t,s)})}finally{this[ns]({width:n,height:r})}}registerEffectComposer(e){e.setRenderer(this[Y].threeRenderer),e.setMainCamera(this[x].getCamera()),e.setMainScene(this[x]),this[x].effectRenderer=e}unregisterEffectComposer(){this[x].effectRenderer=null}registerRenderer(e){this[x].externalRenderer=e}unregisterRenderer(){this[x].externalRenderer=null}get[as](){return this[po]}get[po](){return this.alt==null||this.alt==="null"?this[wl]:this.alt}[Sl](){return this[Xt]}[Nt](){return this.loaded&&this[Mt]}[ps](){return!!this.src&&this[Mt]}[ns]({width:e,height:t}){e===0||t===0||(this[Wi].style.width=`${e}px`,this[Wi].style.height=`${t}px`,this[ln]({width:e,height:t}))}[qe](e,t){var s;(s=this[x].effectRenderer)===null||s===void 0||s.beforeRender(e,t)}[Ql](){this[Xt]||(this[Xt]=!0,this[js]=performance.now())}[ue](){this[x].queueRender()}[Ke](){}[An](e){this[_r]=e;const t=this.getRootNode();t!=null&&t.activeElement===this&&this[ks].textContent!=e&&(this[ks].textContent=e)}[(Cl=Lr,Bl=Fr,ln)](e){this[x].setSize(e.width,e.height)}async[(yl=Dr,cs)](){const e=this[x];if(this.loaded||!this[ps]()||this.src===e.url)return;this.generateSchema&&e.updateSchema(this.src),this[An]("Loading"),e.stopAnimation();const t=this[Ft].beginActivity("model-load"),s=this.src;try{const i=e.setSource(s,r=>t(Ue(r,0,1)*.95)),n=this[nn]();await Promise.all([i,n]),this[Ql](),this[Ke](),this.updateComplete.then(()=>{this.dispatchEvent(new CustomEvent("before-render"))}),await new Promise(r=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:s}})),r()})})})}catch(i){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:i}}))}finally{t(1)}}}Qn([k({type:String})],li.prototype,"alt",void 0);Qn([k({type:String})],li.prototype,"src",void 0);Qn([k({type:Boolean,attribute:"with-credentials"})],li.prototype,"withCredentials",void 0);Qn([k({type:Boolean,attribute:"generate-schema"})],li.prototype,"generateSchema",void 0);/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nr=function(o,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(o,e,t,s);else for(var a=o.length-1;a>=0;a--)(r=o[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const xl=1e3,_i=Symbol("changeAnimation"),Ze=Symbol("paused"),bp={repetitions:1/0,pingpong:!1},Tp=o=>{var e;class t extends o{constructor(...i){super(i),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[e]=!0,this[x].subscribeMixerEvent("loop",n=>{const r=n.action._loopCount;this.dispatchEvent(new CustomEvent("loop",{detail:{count:r}}))}),this[x].subscribeMixerEvent("finished",()=>{this[Ze]=!0,this.dispatchEvent(new CustomEvent("finished"))})}get availableAnimations(){return this.loaded?this[x].animationNames:[]}get duration(){return this[x].duration}get paused(){return this[Ze]}get currentTime(){return this[x].animationTime}set currentTime(i){this[x].animationTime=i,this[ue]()}get timeScale(){return this[x].animationTimeScale}set timeScale(i){this[x].animationTimeScale=i}pause(){this[Ze]||(this[Ze]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(i){this.availableAnimations.length>0&&(this[Ze]=!1,this[_i](i),this.dispatchEvent(new CustomEvent("play")))}[(e=Ze,Ke)](){super[Ke](),this[Ze]=!0,this.animationName!=null&&this[_i](),this.autoplay&&this.play()}[qe](i,n){super[qe](i,n),!(this[Ze]||!this[Nt]()&&!this[Y].isPresenting)&&(this[x].updateAnimation(n/xl),this[ue]())}updated(i){super.updated(i),i.has("autoplay")&&this.autoplay&&this.play(),i.has("animationName")&&this[_i]()}[_i](i=bp){var n;const r=(n=i.repetitions)!==null&&n!==void 0?n:1/0,a=i.pingpong?ic:r===1?yu:nc;this[x].playAnimation(this.animationName,this.animationCrossfadeDuration/xl,a,r),this[Ze]&&(this[x].updateAnimation(0),this[ue]())}}return Nr([k({type:Boolean})],t.prototype,"autoplay",void 0),Nr([k({type:String,attribute:"animation-name"})],t.prototype,"animationName",void 0),Nr([k({type:Number,attribute:"animation-crossfade-duration"})],t.prototype,"animationCrossfadeDuration",void 0),t};/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const St=Symbol("hotspotMap"),kr=Symbol("mutationCallback"),Us=Symbol("observer"),Ur=Symbol("addHotspot"),vl=Symbol("removeHotspot"),Gr=new Ve,Mp=o=>{var e,t,s;class i extends o{constructor(){super(...arguments),this[e]=new Map,this[t]=r=>{r.forEach(a=>{(!(a instanceof MutationRecord)||a.type==="childList")&&(a.addedNodes.forEach(A=>{this[Ur](A)}),a.removedNodes.forEach(A=>{this[vl](A)}),this[ue]())})},this[s]=new MutationObserver(this[kr])}connectedCallback(){super.connectedCallback();for(let a=0;a<this.children.length;++a)this[Ur](this.children[a]);const{ShadyDOM:r}=self;r==null?this[Us].observe(this,{childList:!0}):this[Us]=r.observeChildren(this,this[kr])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:r}=self;r==null?this[Us].disconnect():r.unobserveChildren(this[Us])}[(e=St,t=kr,s=Us,Ke)](){super[Ke]();const r=this[x];r.forHotspots(a=>{r.updateSurfaceHotspot(a)})}[qe](r,a){super[qe](r,a);const A=this[x],{annotationRenderer:l}=A,h=A.getCamera();A.shouldRender()&&(A.animateSurfaceHotspots(),A.updateHotspotsVisibility(h.position),l.domElement.style.display="",l.render(A,h))}updateHotspot(r){const a=this[St].get(r.name);a!=null&&(a.updatePosition(r.position),a.updateNormal(r.normal),a.surface=r.surface,this[x].updateSurfaceHotspot(a),this[ue]())}queryHotspot(r){const a=this[St].get(r);if(a==null)return null;const A=ut(a.position),l=ut(a.normal),h=a.facingCamera,c=this[x],u=c.getCamera(),d=new F;d.setFromMatrixPosition(a.matrixWorld),d.project(u);const g=c.width/2,f=c.height/2;d.x=d.x*g+g,d.y=-(d.y*f)+f;const p=ut(new F(d.x,d.y,d.z));return!Number.isFinite(p.x)||!Number.isFinite(p.y)?null:{position:A,normal:l,canvasPosition:p,facingCamera:h}}positionAndNormalFromPoint(r,a){const A=this[x],l=A.getNDC(r,a),h=A.positionAndNormalFromPoint(l);if(h==null)return null;Gr.copy(A.target.matrixWorld).invert();const c=ut(h.position.applyMatrix4(Gr)),u=ut(h.normal.transformDirection(Gr));let d=null;return h.uv!=null&&(d=Io(h.uv)),{position:c,normal:u,uv:d}}surfaceFromPoint(r,a){const A=this[x],l=A.getNDC(r,a);return A.surfaceFromPoint(l)}[Ur](r){if(!(r instanceof HTMLElement&&r.slot.indexOf("hotspot")===0))return;let a=this[St].get(r.slot);a!=null?a.increment():(a=new fh({name:r.slot,position:r.dataset.position,normal:r.dataset.normal,surface:r.dataset.surface}),this[St].set(r.slot,a),this[x].addHotspot(a)),this[x].queueRender()}[vl](r){if(!(r instanceof HTMLElement))return;const a=this[St].get(r.slot);a&&(a.decrement()&&(this[x].removeHotspot(a),this[St].delete(r.slot)),this[x].queueRender())}}return i};/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var ge=Uint8Array,xe=Uint16Array,Fo=Int32Array,No=new ge([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ko=new ge([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bl=new ge([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ph=function(o,e){for(var t=new xe(31),s=0;s<31;++s)t[s]=e+=1<<o[s-1];for(var i=new Fo(t[30]),s=1;s<30;++s)for(var n=t[s];n<t[s+1];++n)i[n]=n-t[s]<<5|s;return{b:t,r:i}},mh=ph(No,2),Rp=mh.b,Eo=mh.r;Rp[28]=258,Eo[258]=28;var Dp=ph(ko,0),Tl=Dp.r,Co=new xe(32768);for(var j=0;j<32768;++j){var at=(j&43690)>>1|(j&21845)<<1;at=(at&52428)>>2|(at&13107)<<2,at=(at&61680)>>4|(at&3855)<<4,Co[j]=((at&65280)>>8|(at&255)<<8)>>1}var ei=function(o,e,t){for(var s=o.length,i=0,n=new xe(e);i<s;++i)o[i]&&++n[o[i]-1];var r=new xe(e);for(i=1;i<e;++i)r[i]=r[i-1]+n[i-1]<<1;var a;if(t){a=new xe(1<<e);var A=15-e;for(i=0;i<s;++i)if(o[i])for(var l=i<<4|o[i],h=e-o[i],c=r[o[i]-1]++<<h,u=c|(1<<h)-1;c<=u;++c)a[Co[c]>>A]=l}else for(a=new xe(s),i=0;i<s;++i)o[i]&&(a[i]=Co[r[o[i]-1]++]>>15-o[i]);return a},kt=new ge(288);for(var j=0;j<144;++j)kt[j]=8;for(var j=144;j<256;++j)kt[j]=9;for(var j=256;j<280;++j)kt[j]=7;for(var j=280;j<288;++j)kt[j]=8;var cn=new ge(32);for(var j=0;j<32;++j)cn[j]=5;var _p=ei(kt,9,0),Lp=ei(cn,5,0),Ih=function(o){return(o+7)/8|0},Eh=function(o,e,t){return(t==null||t>o.length)&&(t=o.length),new ge(o.subarray(e,t))},Fp=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Sn=function(o,e,t){var s=new Error(e||Fp[o]);if(s.code=o,Error.captureStackTrace&&Error.captureStackTrace(s,Sn),!t)throw s;return s},et=function(o,e,t){t<<=e&7;var s=e/8|0;o[s]|=t,o[s+1]|=t>>8},Gs=function(o,e,t){t<<=e&7;var s=e/8|0;o[s]|=t,o[s+1]|=t>>8,o[s+2]|=t>>16},Or=function(o,e){for(var t=[],s=0;s<o.length;++s)o[s]&&t.push({s,f:o[s]});var i=t.length,n=t.slice();if(!i)return{t:Bh,l:0};if(i==1){var r=new ge(t[0].s+1);return r[t[0].s]=1,{t:r,l:1}}t.sort(function(m,y){return m.f-y.f}),t.push({s:-1,f:25001});var a=t[0],A=t[1],l=0,h=1,c=2;for(t[0]={s:-1,f:a.f+A.f,l:a,r:A};h!=i-1;)a=t[t[l].f<t[c].f?l++:c++],A=t[l!=h&&t[l].f<t[c].f?l++:c++],t[h++]={s:-1,f:a.f+A.f,l:a,r:A};for(var u=n[0].s,s=1;s<i;++s)n[s].s>u&&(u=n[s].s);var d=new xe(u+1),g=Bo(t[h-1],d,0);if(g>e){var s=0,f=0,p=g-e,I=1<<p;for(n.sort(function(y,Q){return d[Q.s]-d[y.s]||y.f-Q.f});s<i;++s){var C=n[s].s;if(d[C]>e)f+=I-(1<<g-d[C]),d[C]=e;else break}for(f>>=p;f>0;){var w=n[s].s;d[w]<e?f-=1<<e-d[w]++-1:++s}for(;s>=0&&f;--s){var B=n[s].s;d[B]==e&&(--d[B],++f)}g=e}return{t:new ge(d),l:g}},Bo=function(o,e,t){return o.s==-1?Math.max(Bo(o.l,e,t+1),Bo(o.r,e,t+1)):e[o.s]=t},Ml=function(o){for(var e=o.length;e&&!o[--e];);for(var t=new xe(++e),s=0,i=o[0],n=1,r=function(A){t[s++]=A},a=1;a<=e;++a)if(o[a]==i&&a!=e)++n;else{if(!i&&n>2){for(;n>138;n-=138)r(32754);n>2&&(r(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(r(i),--n;n>6;n-=6)r(8304);n>2&&(r(n-3<<5|8208),n=0)}for(;n--;)r(i);n=1,i=o[a]}return{c:t.subarray(0,s),n:e}},Os=function(o,e){for(var t=0,s=0;s<e.length;++s)t+=o[s]*e[s];return t},Ch=function(o,e,t){var s=t.length,i=Ih(e+2);o[i]=s&255,o[i+1]=s>>8,o[i+2]=o[i]^255,o[i+3]=o[i+1]^255;for(var n=0;n<s;++n)o[i+n+4]=t[n];return(i+4+s)*8},Rl=function(o,e,t,s,i,n,r,a,A,l,h){et(e,h++,t),++i[256];for(var c=Or(i,15),u=c.t,d=c.l,g=Or(n,15),f=g.t,p=g.l,I=Ml(u),C=I.c,w=I.n,B=Ml(f),m=B.c,y=B.n,Q=new xe(19),E=0;E<C.length;++E)++Q[C[E]&31];for(var E=0;E<m.length;++E)++Q[m[E]&31];for(var S=Or(Q,7),v=S.t,R=S.l,_=19;_>4&&!v[bl[_-1]];--_);var N=l+5<<3,T=Os(i,kt)+Os(n,cn)+r,M=Os(i,u)+Os(n,f)+r+14+3*_+Os(Q,v)+2*Q[16]+3*Q[17]+7*Q[18];if(A>=0&&N<=T&&N<=M)return Ch(e,h,o.subarray(A,A+l));var L,D,H,$;if(et(e,h,1+(M<T)),h+=2,M<T){L=ei(u,d,0),D=u,H=ei(f,p,0),$=f;var V=ei(v,R,0);et(e,h,w-257),et(e,h+5,y-1),et(e,h+10,_-4),h+=14;for(var E=0;E<_;++E)et(e,h+3*E,v[bl[E]]);h+=3*_;for(var K=[C,m],J=0;J<2;++J)for(var se=K[J],E=0;E<se.length;++E){var we=se[E]&31;et(e,h,V[we]),h+=v[we],we>15&&(et(e,h,se[E]>>5&127),h+=se[E]>>12)}}else L=_p,D=kt,H=Lp,$=cn;for(var E=0;E<a;++E){var le=s[E];if(le>255){var we=le>>18&31;Gs(e,h,L[we+257]),h+=D[we+257],we>7&&(et(e,h,le>>23&31),h+=No[we]);var Ut=le&31;Gs(e,h,H[Ut]),h+=$[Ut],Ut>3&&(Gs(e,h,le>>5&8191),h+=ko[Ut])}else Gs(e,h,L[le]),h+=D[le]}return Gs(e,h,L[256]),h+D[256]},Np=new Fo([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Bh=new ge(0),kp=function(o,e,t,s,i,n){var r=n.z||o.length,a=new ge(s+r+5*(1+Math.ceil(r/7e3))+i),A=a.subarray(s,a.length-i),l=n.l,h=(n.r||0)&7;if(e){h&&(A[0]=n.r>>3);for(var c=Np[e-1],u=c>>13,d=c&8191,g=(1<<t)-1,f=n.p||new xe(32768),p=n.h||new xe(g+1),I=Math.ceil(t/3),C=2*I,w=function(bn){return(o[bn]^o[bn+1]<<I^o[bn+2]<<C)&g},B=new Fo(25e3),m=new xe(288),y=new xe(32),Q=0,E=0,S=n.i||0,v=0,R=n.w||0,_=0;S+2<r;++S){var N=w(S),T=S&32767,M=p[N];if(f[T]=M,p[N]=T,R<=S){var L=r-S;if((Q>7e3||v>24576)&&(L>423||!l)){h=Rl(o,A,0,B,m,y,E,v,_,S-_,h),v=Q=E=0,_=S;for(var D=0;D<286;++D)m[D]=0;for(var D=0;D<30;++D)y[D]=0}var H=2,$=0,V=d,K=T-M&32767;if(L>2&&N==w(S-K))for(var J=Math.min(u,L)-1,se=Math.min(32767,S),we=Math.min(258,L);K<=se&&--V&&T!=M;){if(o[S+H]==o[S+H-K]){for(var le=0;le<we&&o[S+le]==o[S+le-K];++le);if(le>H){if(H=le,$=K,le>J)break;for(var Ut=Math.min(K,le-2),Uo=0,D=0;D<Ut;++D){var xn=S-K+D&32767,xh=f[xn],Go=xn-xh&32767;Go>Uo&&(Uo=Go,M=xn)}}}T=M,M=f[T],K+=T-M&32767}if($){B[v++]=268435456|Eo[H]<<18|Tl[$];var Oo=Eo[H]&31,Po=Tl[$]&31;E+=No[Oo]+ko[Po],++m[257+Oo],++y[Po],R=S+H,++Q}else B[v++]=o[S],++m[o[S]]}}for(S=Math.max(S,R);S<r;++S)B[v++]=o[S],++m[o[S]];h=Rl(o,A,l,B,m,y,E,v,_,S-_,h),l||(n.r=h&7|A[h/8|0]<<3,h-=7,n.h=p,n.p=f,n.i=S,n.w=R)}else{for(var S=n.w||0;S<r+l;S+=65535){var vn=S+65535;vn>=r&&(A[h/8|0]=l,vn=r),h=Ch(A,h+1,o.subarray(S,vn))}n.i=r}return Eh(a,0,s+Ih(h)+i)},Up=function(){for(var o=new Int32Array(256),e=0;e<256;++e){for(var t=e,s=9;--s;)t=(t&1&&-306674912)^t>>>1;o[e]=t}return o}(),Gp=function(){var o=-1;return{p:function(e){for(var t=o,s=0;s<e.length;++s)t=Up[t&255^e[s]]^t>>>8;o=t},d:function(){return~o}}},Op=function(o,e,t,s,i){if(!i&&(i={l:1},e.dictionary)){var n=e.dictionary.subarray(-32768),r=new ge(n.length+o.length);r.set(n),r.set(o,n.length),o=r,i.w=n.length}return kp(o,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(o.length)))*1.5):20:12+e.mem,t,s,i)},yh=function(o,e){var t={};for(var s in o)t[s]=o[s];for(var s in e)t[s]=e[s];return t},re=function(o,e,t){for(;t;++e)o[e]=t,t>>>=8};function Pp(o,e){return Op(o,e||{},0,0)}var wh=function(o,e,t,s){for(var i in o){var n=o[i],r=e+i,a=s;Array.isArray(n)&&(a=yh(s,n[1]),n=n[0]),n instanceof ge?t[r]=[n,a]:(t[r+="/"]=[new ge(0),a],wh(n,r,t,s))}},Dl=typeof TextEncoder<"u"&&new TextEncoder,Hp=typeof TextDecoder<"u"&&new TextDecoder,$p=0;try{Hp.decode(Bh,{stream:!0}),$p=1}catch{}function hn(o,e){var t;if(Dl)return Dl.encode(o);for(var s=o.length,i=new ge(o.length+(o.length>>1)),n=0,r=function(l){i[n++]=l},t=0;t<s;++t){if(n+5>i.length){var a=new ge(n+8+(s-t<<1));a.set(i),i=a}var A=o.charCodeAt(t);A<128||e?r(A):A<2048?(r(192|A>>6),r(128|A&63)):A>55295&&A<57344?(A=65536+(A&1047552)|o.charCodeAt(++t)&1023,r(240|A>>18),r(128|A>>12&63),r(128|A>>6&63),r(128|A&63)):(r(224|A>>12),r(128|A>>6&63),r(128|A&63))}return Eh(i,0,n)}var yo=function(o){var e=0;if(o)for(var t in o){var s=o[t].length;s>65535&&Sn(9),e+=s+4}return e},_l=function(o,e,t,s,i,n,r,a){var A=s.length,l=t.extra,h=a&&a.length,c=yo(l);re(o,e,r!=null?33639248:67324752),e+=4,r!=null&&(o[e++]=20,o[e++]=t.os),o[e]=20,e+=2,o[e++]=t.flag<<1|(n<0&&8),o[e++]=i&&8,o[e++]=t.compression&255,o[e++]=t.compression>>8;var u=new Date(t.mtime==null?Date.now():t.mtime),d=u.getFullYear()-1980;if((d<0||d>119)&&Sn(10),re(o,e,d<<25|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>1),e+=4,n!=-1&&(re(o,e,t.crc),re(o,e+4,n<0?-n-2:n),re(o,e+8,t.size)),re(o,e+12,A),re(o,e+14,c),e+=16,r!=null&&(re(o,e,h),re(o,e+6,t.attrs),re(o,e+10,r),e+=14),o.set(s,e),e+=A,c)for(var g in l){var f=l[g],p=f.length;re(o,e,+g),re(o,e+2,p),o.set(f,e+4),e+=4+p}return h&&(o.set(a,e),e+=h),e},Vp=function(o,e,t,s,i){re(o,e,101010256),re(o,e+8,t),re(o,e+10,t),re(o,e+12,s),re(o,e+16,i)};function qp(o,e){e||(e={});var t={},s=[];wh(o,"",t,e);var i=0,n=0;for(var r in t){var a=t[r],A=a[0],l=a[1],h=l.level==0?0:8,c=hn(r),u=c.length,d=l.comment,g=d&&hn(d),f=g&&g.length,p=yo(l.extra);u>65535&&Sn(11);var I=h?Pp(A,l):A,C=I.length,w=Gp();w.p(A),s.push(yh(l,{size:A.length,crc:w.d(),c:I,f:c,m:g,u:u!=r.length||g&&d.length!=f,o:i,compression:h})),i+=30+u+p+C,n+=76+2*(u+p)+(f||0)+C}for(var B=new ge(n+22),m=i,y=n-i,Q=0;Q<s.length;++Q){var c=s[Q];_l(B,c.o,c,c.f,c.u,c.c.length);var E=30+c.f.length+yo(c.extra);B.set(c.c,c.o+E),_l(B,i,c,c.f,c.u,c.c.length,c.o,c.m),i+=16+E+(c.m?c.m.length:0)}return Vp(B,i,s.length,y,m),B}class Kp{parse(e,t,s,i){this.parseAsync(e,i).then(t).catch(s)}async parseAsync(e,t={}){t=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},includeAnchoringProperties:!0,quickLookCompatible:!1,maxTextureSize:1024},t);const s={},i="model.usda";s[i]=null;let n=Qh();n+=Yp(t);const r={},a={};e.traverseVisible(l=>{if(l.isMesh){const h=l.geometry,c=l.material;if(c.isMeshStandardMaterial){const u="geometries/Geometry_"+h.id+".usda";if(!(u in s)){const d=Xp(h);s[u]=Wp(d)}c.uuid in r||(r[c.uuid]=c),n+=jp(l,h,c)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",l)}else l.isCamera&&(n+=am(l))}),n+=Jp(),n+=nm(r,a,t.quickLookCompatible),s[i]=hn(n),n=null;for(const l in a){let h=a[l];h.isCompressedTexture===!0&&(h=Vi(h));const c=zp(h.image,h.flipY,t.maxTextureSize),u=await new Promise(d=>c.toBlob(d,"image/png",1));s[`textures/Texture_${l}.png`]=new Uint8Array(await u.arrayBuffer())}let A=0;for(const l in s){const h=s[l],c=34+l.length;A+=c;const u=A&63;if(u!==4){const d=64-u,g=new Uint8Array(d);s[l]=[h,{extra:{12345:g}}]}A=h.length}return qp(s,{level:0})}}function zp(o,e,t){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const s=t/Math.max(o.width,o.height),i=document.createElement("canvas");i.width=o.width*Math.min(1,s),i.height=o.height*Math.min(1,s);const n=i.getContext("2d");return e===!0&&(n.translate(0,i.height),n.scale(1,-1)),n.drawImage(o,0,0,i.width,i.height),i}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const he=7;function Qh(){return`#usda 1.0
(
	customLayerData = {
		string creator = "Three.js USDZExporter"
	}
	defaultPrim = "Root"
	metersPerUnit = 1
	upAxis = "Y"
)

`}function Yp(o){return`def Xform "Root"
{
	def Scope "Scenes" (
		kind = "sceneLibrary"
	)
	{
		def Xform "Scene" (
			customData = {
				bool preliminary_collidesWithEnvironment = 0
				string sceneName = "Scene"
			}
			sceneName = "Scene"
		)
		{${o.includeAnchoringProperties===!0?`
		token preliminary:anchoring:type = "${o.ar.anchoring.type}"
		token preliminary:planeAnchoring:alignment = "${o.ar.planeAnchoring.alignment}"
	`:""}
`}function Jp(){return`
		}
	}
}

`}function Wp(o){let e=Qh();return e+=o,hn(e)}function jp(o,e,t){const s="Object_"+o.id,i=Sh(o.matrixWorld);return o.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",o),`def Xform "${s}" (
	prepend references = @./geometries/Geometry_${e.id}.usda@</Geometry>
	prepend apiSchemas = ["MaterialBindingAPI"]
)
{
	matrix4d xformOp:transform = ${i}
	uniform token[] xformOpOrder = ["xformOp:transform"]

	rel material:binding = </Materials/Material_${t.id}>
}

`}function Sh(o){const e=o.elements;return`( ${Li(e,0)}, ${Li(e,4)}, ${Li(e,8)}, ${Li(e,12)} )`}function Li(o,e){return`(${o[e+0]}, ${o[e+1]}, ${o[e+2]}, ${o[e+3]})`}function Xp(o){return`
def "Geometry"
{
${Zp(o)}
}
`}function Zp(o){const e="Geometry",t=o.attributes,s=t.position.count;return`
	def Mesh "${e}"
	{
		int[] faceVertexCounts = [${em(o)}]
		int[] faceVertexIndices = [${tm(o)}]
		normal3f[] normals = [${wo(t.normal,s)}] (
			interpolation = "vertex"
		)
		point3f[] points = [${wo(t.position,s)}]
${im(t)}
		uniform token subdivisionScheme = "none"
	}
`}function em(o){const e=o.index!==null?o.index.count:o.attributes.position.count;return Array(e/3).fill(3).join(", ")}function tm(o){const e=o.index,t=[];if(e!==null)for(let s=0;s<e.count;s++)t.push(e.getX(s));else{const s=o.attributes.position.count;for(let i=0;i<s;i++)t.push(i)}return t.join(", ")}function wo(o,e){if(o===void 0)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const t=[];for(let s=0;s<o.count;s++){const i=o.getX(s),n=o.getY(s),r=o.getZ(s);t.push(`(${i.toPrecision(he)}, ${n.toPrecision(he)}, ${r.toPrecision(he)})`)}return t.join(", ")}function sm(o){const e=[];for(let t=0;t<o.count;t++){const s=o.getX(t),i=o.getY(t);e.push(`(${s.toPrecision(he)}, ${1-i.toPrecision(he)})`)}return e.join(", ")}function im(o){let e="";for(let s=0;s<4;s++){const i=s>0?s:"",n=o["uv"+i];n!==void 0&&(e+=`
		texCoord2f[] primvars:st${i} = [${sm(n)}] (
			interpolation = "vertex"
		)`)}const t=o.color;if(t!==void 0){const s=t.count;e+=`
	color3f[] primvars:displayColor = [${wo(t,s)}] (
		interpolation = "vertex"
		)`}return e}function nm(o,e,t=!1){const s=[];for(const i in o){const n=o[i];s.push(rm(n,e,t))}return`def "Materials"
{
${s.join("")}
}

`}function rm(o,e,t=!1){const s="			",i=[],n=[];function r(a,A,l){const h=a.source.id+"_"+a.flipY;e[h]=a;const c=a.channel>0?"st"+a.channel:"st",u={1e3:"repeat",1001:"clamp",1002:"mirror"},d=a.repeat.clone(),g=a.offset.clone(),f=a.rotation,p=Math.sin(f),I=Math.cos(f);return g.y=1-g.y-d.y,t?(g.x=g.x/d.x,g.y=g.y/d.y,g.x+=p/d.x,g.y+=I-1):(g.x+=p*d.x,g.y+=(1-I)*d.y),`
		def Shader "PrimvarReader_${A}"
		{
			uniform token info:id = "UsdPrimvarReader_float2"
			float2 inputs:fallback = (0.0, 0.0)
			token inputs:varname = "${c}"
			float2 outputs:result
		}

		def Shader "Transform2d_${A}"
		{
			uniform token info:id = "UsdTransform2d"
			token inputs:in.connect = </Materials/Material_${o.id}/PrimvarReader_${A}.outputs:result>
			float inputs:rotation = ${(f*(180/Math.PI)).toFixed(he)}
			float2 inputs:scale = ${Fl(d)}
			float2 inputs:translation = ${Fl(g)}
			float2 outputs:result
		}

		def Shader "Texture_${a.id}_${A}"
		{
			uniform token info:id = "UsdUVTexture"
			asset inputs:file = @textures/Texture_${h}.png@
			float2 inputs:st.connect = </Materials/Material_${o.id}/Transform2d_${A}.outputs:result>
			${l!==void 0?"float4 inputs:scale = "+om(l):""}
			token inputs:sourceColorSpace = "${a.colorSpace===Zi?"raw":"sRGB"}"
			token inputs:wrapS = "${u[a.wrapS]}"
			token inputs:wrapT = "${u[a.wrapT]}"
			float outputs:r
			float outputs:g
			float outputs:b
			float3 outputs:rgb
			${o.transparent||o.alphaTest>0?"float outputs:a":""}
		}`}return o.side===ft&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",o),o.map!==null?(i.push(`${s}color3f inputs:diffuseColor.connect = </Materials/Material_${o.id}/Texture_${o.map.id}_diffuse.outputs:rgb>`),o.transparent?i.push(`${s}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${o.map.id}_diffuse.outputs:a>`):o.alphaTest>0&&(i.push(`${s}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${o.map.id}_diffuse.outputs:a>`),i.push(`${s}float inputs:opacityThreshold = ${o.alphaTest}`)),n.push(r(o.map,"diffuse",o.color))):i.push(`${s}color3f inputs:diffuseColor = ${Ll(o.color)}`),o.emissiveMap!==null?(i.push(`${s}color3f inputs:emissiveColor.connect = </Materials/Material_${o.id}/Texture_${o.emissiveMap.id}_emissive.outputs:rgb>`),n.push(r(o.emissiveMap,"emissive",new oe(o.emissive.r*o.emissiveIntensity,o.emissive.g*o.emissiveIntensity,o.emissive.b*o.emissiveIntensity)))):o.emissive.getHex()>0&&i.push(`${s}color3f inputs:emissiveColor = ${Ll(o.emissive)}`),o.normalMap!==null&&(i.push(`${s}normal3f inputs:normal.connect = </Materials/Material_${o.id}/Texture_${o.normalMap.id}_normal.outputs:rgb>`),n.push(r(o.normalMap,"normal"))),o.aoMap!==null&&(i.push(`${s}float inputs:occlusion.connect = </Materials/Material_${o.id}/Texture_${o.aoMap.id}_occlusion.outputs:r>`),n.push(r(o.aoMap,"occlusion",new oe(o.aoMapIntensity,o.aoMapIntensity,o.aoMapIntensity)))),o.roughnessMap!==null?(i.push(`${s}float inputs:roughness.connect = </Materials/Material_${o.id}/Texture_${o.roughnessMap.id}_roughness.outputs:g>`),n.push(r(o.roughnessMap,"roughness",new oe(o.roughness,o.roughness,o.roughness)))):i.push(`${s}float inputs:roughness = ${o.roughness}`),o.metalnessMap!==null?(i.push(`${s}float inputs:metallic.connect = </Materials/Material_${o.id}/Texture_${o.metalnessMap.id}_metallic.outputs:b>`),n.push(r(o.metalnessMap,"metallic",new oe(o.metalness,o.metalness,o.metalness)))):i.push(`${s}float inputs:metallic = ${o.metalness}`),o.alphaMap!==null?(i.push(`${s}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${o.alphaMap.id}_opacity.outputs:r>`),i.push(`${s}float inputs:opacityThreshold = 0.0001`),n.push(r(o.alphaMap,"opacity"))):i.push(`${s}float inputs:opacity = ${o.opacity}`),o.isMeshPhysicalMaterial&&(o.clearcoatMap!==null?(i.push(`${s}float inputs:clearcoat.connect = </Materials/Material_${o.id}/Texture_${o.clearcoatMap.id}_clearcoat.outputs:r>`),n.push(r(o.clearcoatMap,"clearcoat",new oe(o.clearcoat,o.clearcoat,o.clearcoat)))):i.push(`${s}float inputs:clearcoat = ${o.clearcoat}`),o.clearcoatRoughnessMap!==null?(i.push(`${s}float inputs:clearcoatRoughness.connect = </Materials/Material_${o.id}/Texture_${o.clearcoatRoughnessMap.id}_clearcoatRoughness.outputs:g>`),n.push(r(o.clearcoatRoughnessMap,"clearcoatRoughness",new oe(o.clearcoatRoughness,o.clearcoatRoughness,o.clearcoatRoughness)))):i.push(`${s}float inputs:clearcoatRoughness = ${o.clearcoatRoughness}`),i.push(`${s}float inputs:ior = ${o.ior}`)),`
	def Material "Material_${o.id}"
	{
		def Shader "PreviewSurface"
		{
			uniform token info:id = "UsdPreviewSurface"
${i.join(`
`)}
			int inputs:useSpecularWorkflow = 0
			token outputs:surface
		}

		token outputs:surface.connect = </Materials/Material_${o.id}/PreviewSurface.outputs:surface>

${n.join(`
`)}

	}
`}function Ll(o){return`(${o.r}, ${o.g}, ${o.b})`}function om(o){return`(${o.r}, ${o.g}, ${o.b}, 1.0)`}function Fl(o){return`(${o.x}, ${o.y})`}function am(o){const e=o.name?o.name:"Camera_"+o.id,t=Sh(o.matrixWorld);return o.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",o),o.isOrthographicCamera?`def Camera "${e}"
		{
			matrix4d xformOp:transform = ${t}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${o.near.toPrecision(he)}, ${o.far.toPrecision(he)})
			float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(he)}
			float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(he)}
			token projection = "orthographic"
		}
	
	`:`def Camera "${e}"
		{
			matrix4d xformOp:transform = ${t}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${o.near.toPrecision(he)}, ${o.far.toPrecision(he)})
			float focalLength = ${o.getFocalLength().toPrecision(he)}
			float focusDistance = ${o.focus.toPrecision(he)}
			float horizontalAperture = ${o.getFilmWidth().toPrecision(he)}
			token projection = "perspective"
			float verticalAperture = ${o.getFilmHeight().toPrecision(he)}
		}
	
	`}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Am=o=>e=>{try{const t=nt(e),s=(t.length?t[0].terms:[]).filter(i=>i&&i.type==="ident").map(i=>i.value).filter(i=>o.indexOf(i)>-1);return new Set(s)}catch{}return new Set};/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zt=function(o,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(o,e,t,s);else for(var a=o.length-1;a>=0;a--)(r=o[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};let Nl=!1,kl=!1;const Ul="#model-viewer-no-ar-fallback",lm=Am(["quick-look","scene-viewer","webxr","none"]),cm="webxr scene-viewer quick-look",ve={QUICK_LOOK:"quick-look",SCENE_VIEWER:"scene-viewer",WEBXR:"webxr",NONE:"none"},tt=Symbol("arButtonContainer"),Gl=Symbol("enterARWithWebXR"),Ol=Symbol("openSceneViewer"),Pl=Symbol("openIOSARQuickLook"),hm=Symbol("canActivateAR"),Fi=Symbol("arMode"),Pr=Symbol("arModes"),es=Symbol("arAnchor"),Ni=Symbol("preload"),ki=Symbol("onARButtonContainerClick"),Hr=Symbol("onARStatus"),$r=Symbol("onARTracking"),Vr=Symbol("onARTap"),Ps=Symbol("selectARMode"),qr=Symbol("triggerLoad"),um=o=>{var e,t,s,i,n,r,a,A,l,h;class c extends o{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arPlacement="floor",this.arModes=cm,this.iosSrc=null,this.xrEnvironment=!1,this[e]=!1,this[t]=this.shadowRoot.querySelector(".ar-button"),this[s]=document.createElement("a"),this[i]=new Set,this[n]=ve.NONE,this[r]=!1,this[a]=d=>{d.preventDefault(),this.activateAR()},this[A]=({status:d})=>{(d===ht.NOT_PRESENTING||this[Y].arRenderer.presentedScene===this[x])&&(this.setAttribute("ar-status",d),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:d}})),d===ht.NOT_PRESENTING?this.removeAttribute("ar-tracking"):d===ht.SESSION_STARTED&&this.setAttribute("ar-tracking",co.TRACKING))},this[l]=({status:d})=>{this.setAttribute("ar-tracking",d),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:d}}))},this[h]=d=>{d.data=="_apple_ar_quicklook_button_tapped"&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[Fi]!==ve.NONE}connectedCallback(){super.connectedCallback(),this[Y].arRenderer.addEventListener("status",this[Hr]),this.setAttribute("ar-status",ht.NOT_PRESENTING),this[Y].arRenderer.addEventListener("tracking",this[$r]),this[es].addEventListener("message",this[Vr])}disconnectedCallback(){super.disconnectedCallback(),this[Y].arRenderer.removeEventListener("status",this[Hr]),this[Y].arRenderer.removeEventListener("tracking",this[$r]),this[es].removeEventListener("message",this[Vr])}update(d){super.update(d),d.has("arScale")&&(this[x].canScale=this.arScale!=="fixed"),d.has("arPlacement")&&(this[x].updateShadow(),this[ue]()),d.has("arModes")&&(this[Pr]=lm(this.arModes)),(d.has("ar")||d.has("arModes")||d.has("src")||d.has("iosSrc"))&&this[Ps]()}async activateAR(){switch(this[Fi]){case ve.QUICK_LOOK:await this[Pl]();break;case ve.WEBXR:await this[Gl]();break;case ve.SCENE_VIEWER:this[Ol]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities");break}}async[(e=hm,t=tt,s=es,i=Pr,n=Fi,r=Ni,a=ki,A=Hr,l=$r,h=Vr,Ps)](){var d;let g=ve.NONE;if(this.ar){if(this.src!=null)for(const f of this[Pr]){if(f==="webxr"&&fc&&!Nl&&await this[Y].arRenderer.supportsPresentation()){g=ve.WEBXR;break}if(f==="scene-viewer"&&!kl&&($u||navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues&&(!((d=(await navigator.userAgentData.getHighEntropyValues(["formFactor"])).formFactor)===null||d===void 0)&&d.includes("XR")))){g=ve.SCENE_VIEWER;break}if(f==="quick-look"&&oa){g=ve.QUICK_LOOK;break}}g===ve.NONE&&this.iosSrc!=null&&oa&&(g=ve.QUICK_LOOK)}if(g!==ve.NONE)this[tt].classList.add("enabled"),this[tt].addEventListener("click",this[ki]);else if(this[tt].classList.contains("enabled")){this[tt].removeEventListener("click",this[ki]),this[tt].classList.remove("enabled");const f=ht.FAILED;this.setAttribute("ar-status",f),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:f}}))}this[Fi]=g}async[Gl](){console.log("Attempting to present in AR with WebXR..."),await this[qr]();try{this[tt].removeEventListener("click",this[ki]);const{arRenderer:d}=this[Y];d.placeOnWall=this.arPlacement==="wall",await d.present(this[x],this.xrEnvironment)}catch(d){console.warn("Error while trying to present in AR with WebXR"),console.error(d),await this[Y].arRenderer.stopPresenting(),Nl=!0,console.warn("Falling back to next ar-mode"),await this[Ps](),this.activateAR()}finally{this[Ps]()}}async[qr](){this.loaded||(this[Ni]=!0,this[cs](),await Yu(this,"load"),this[Ni]=!1)}[ps](){return super[ps]()||this[Ni]}[Ol](){const d=self.location.toString(),g=new URL(d),f=new URL(this.src,d);f.hash&&(f.hash="");const p=new URLSearchParams(f.search);if(g.hash=Ul,p.set("mode","ar_preferred"),p.has("disable_occlusion")||p.set("disable_occlusion","true"),this.arScale==="fixed"&&p.set("resizable","false"),this.arPlacement==="wall"&&p.set("enable_vertical_placement","true"),p.has("sound")){const w=new URL(p.get("sound"),d);p.set("sound",w.toString())}if(p.has("link")){const w=new URL(p.get("link"),d);p.set("link",w.toString())}const I=`intent://arvr.google.com/scene-viewer/1.2?${p.toString()+"&file="+encodeURIComponent(f.toString())}#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(g.toString())};end;`,C=()=>{self.location.hash===Ul&&(kl=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[Ps]())};self.addEventListener("hashchange",C,{once:!0}),this[es].setAttribute("href",I),console.log("Attempting to present in AR with Scene Viewer..."),this[es].click()}async[Pl](){const d=!this.iosSrc;this[tt].classList.remove("enabled");const g=d?await this.prepareUSDZ():this.iosSrc,f=new URL(g,self.location.toString());if(d){const C=self.location.toString(),w=new URL(C),B=new URL(this.src,w);B.hash&&(f.hash=B.hash)}this.arScale==="fixed"&&(f.hash&&(f.hash+="&"),f.hash+="allowsContentScaling=0");const p=this[es];p.setAttribute("rel","ar");const I=document.createElement("img");p.appendChild(I),p.setAttribute("href",f.toString()),d&&p.setAttribute("download","model.usdz"),p.style.display="none",p.isConnected||this.shadowRoot.appendChild(p),console.log("Attempting to present in AR with Quick Look..."),p.click(),p.removeChild(I),d&&URL.revokeObjectURL(g),this[tt].classList.add("enabled")}async prepareUSDZ(){const d=this[Ft].beginActivity("usdz-conversion");await this[qr]();const{model:g,shadow:f,target:p}=this[x];if(g==null)return"";let I=!1;f!=null&&(I=f.visible,f.visible=!1),d(.2);const C=new Kp;p.remove(g),g.position.copy(p.position),g.updateWorldMatrix(!1,!0);const w=await C.parseAsync(g);g.position.set(0,0,0),p.add(g);const B=new Blob([w],{type:"model/vnd.usdz+zip"}),m=URL.createObjectURL(B);return d(1),f!=null&&(f.visible=I),m}}return Zt([k({type:Boolean,attribute:"ar"})],c.prototype,"ar",void 0),Zt([k({type:String,attribute:"ar-scale"})],c.prototype,"arScale",void 0),Zt([k({type:String,attribute:"ar-placement"})],c.prototype,"arPlacement",void 0),Zt([k({type:String,attribute:"ar-modes"})],c.prototype,"arModes",void 0),Zt([k({type:String,attribute:"ios-src"})],c.prototype,"iosSrc",void 0),Zt([k({type:Boolean,attribute:"xr-environment"})],c.prototype,"xrEnvironment",void 0),c};/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kr=function(o,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(o,e,t,s);else for(var a=o.length-1;a>=0;a--)(r=o[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const dm=100,gm="https://www.gstatic.com/draco/versioned/decoders/1.5.6/",fm="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/",pm="https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js",zr={AUTO:"auto",MANUAL:"manual"},Hl={AUTO:"auto",LAZY:"lazy",EAGER:"eager"},ts=Symbol("defaultProgressBarElement"),Yr=Symbol("posterContainerElement"),ss=Symbol("defaultPosterElement"),Hs=Symbol("shouldDismissPoster"),Jr=Symbol("hidePoster"),Ui=Symbol("modelIsRevealed"),Wr=Symbol("updateProgressBar"),mm=Symbol("ariaLabelCallToAction"),jr=Symbol("onProgress"),Im=o=>{var e,t,s,i,n,r,a,A;class l extends o{constructor(...c){super(...c),this.poster=null,this.reveal=zr.AUTO,this.loading=Hl.AUTO,this[e]=!1,this[t]=!1,this[s]=this.shadowRoot.querySelector(".slot.poster"),this[i]=this.shadowRoot.querySelector("#default-poster"),this[n]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[r]=this[ss].getAttribute("aria-label"),this[a]=Ku(p=>{const I=this[ts].parentNode;requestAnimationFrame(()=>{this[ts].style.transform=`scaleX(${p})`,p===0&&(I.removeChild(this[ts]),I.appendChild(this[ts])),this[ts].classList.toggle("hide",p===1)})},dm),this[A]=p=>{const I=p.detail.totalProgress,C=p.detail.reason;I===1&&(this[Wr].flush(),this.loaded&&(this[Hs]||this.reveal===zr.AUTO)&&this[Jr]()),this[Wr](I),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:I,reason:C}}))};const u=self.ModelViewerElement||{},d=u.dracoDecoderLocation||gm;me.setDRACODecoderLocation(d);const g=u.ktx2TranscoderLocation||fm;me.setKTX2TranscoderLocation(g),u.meshoptDecoderLocation&&me.setMeshoptDecoderLocation(u.meshoptDecoderLocation);const f=u.lottieLoaderLocation||pm;Le.singleton.textureUtils.lottieLoaderUrl=f}static set dracoDecoderLocation(c){me.setDRACODecoderLocation(c)}static get dracoDecoderLocation(){return me.getDRACODecoderLocation()}static set ktx2TranscoderLocation(c){me.setKTX2TranscoderLocation(c)}static get ktx2TranscoderLocation(){return me.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(c){me.setMeshoptDecoderLocation(c)}static get meshoptDecoderLocation(){return me.getMeshoptDecoderLocation()}static set lottieLoaderLocation(c){Le.singleton.textureUtils.lottieLoaderUrl=c}static get lottieLoaderLocation(){return Le.singleton.textureUtils.lottieLoaderUrl}static mapURLs(c){Le.singleton.loader[xt].manager.setURLModifier(c)}dismissPoster(){this.loaded?this[Jr]():(this[Hs]=!0,this[cs]())}showPoster(){const c=this[Yr];if(c.classList.contains("show"))return;c.classList.add("show"),this[_e].classList.remove("show");const u=this[ss];u.removeAttribute("tabindex"),u.removeAttribute("aria-hidden");const d=this.modelIsVisible;this[Ui]=!1,this[an](d)}getDimensions(){return ut(this[x].size)}getBoundingBoxCenter(){return ut(this[x].boundingBox.getCenter(new F))}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[Ft].addEventListener("progress",this[jr])}disconnectedCallback(){super.disconnectedCallback(),this[Ft].removeEventListener("progress",this[jr])}async updated(c){super.updated(c),c.has("poster")&&this.poster!=null&&(this[ss].style.backgroundImage=`url(${this.poster})`),c.has("alt")&&this[ss].setAttribute("aria-label",this[po]),(c.has("reveal")||c.has("loading"))&&this[cs]()}[(e=Ui,t=Hs,s=Yr,i=ss,n=ts,r=mm,a=Wr,A=jr,ps)](){return!!this.src&&(this[Hs]||this.loading===Hl.EAGER||this.reveal===zr.AUTO&&this[Mt])}[Jr](){this[Hs]=!1;const c=this[Yr];if(!c.classList.contains("show"))return;c.classList.remove("show"),this[_e].classList.add("show");const u=this.modelIsVisible;this[Ui]=!0,this[an](u);const d=this.getRootNode();d&&d.activeElement===this&&this[_e].focus();const g=this[ss];g.setAttribute("aria-hidden","true"),g.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[Nt](){return super[Nt]()&&this[Ui]}}return Kr([k({type:String})],l.prototype,"poster",void 0),Kr([k({type:String})],l.prototype,"reveal",void 0),Kr([k({type:String})],l.prototype,"loading",void 0),l};/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xr=function(o,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(o,e,t,s);else for(var a=o.length-1;a>=0;a--)(r=o[a])&&(n=(i<3?r(n):i>3?r(e,t,n):r(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n};const Em=Math.PI/32,Cm=3e3,Bm={basis:[wn(de(Em,"rad"))],keywords:{auto:[null]}},is=Symbol("autoRotateStartTime"),Zr=Symbol("radiansPerSecond"),$l=Symbol("syncRotationRate"),eo=Symbol("onCameraChange"),ym=o=>{var e,t,s;class i extends o{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=Cm,this.rotationPerSecond="auto",this[e]=performance.now(),this[t]=0,this[s]=r=>{this.autoRotate&&r.detail.source==="user-interaction"&&(this[is]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[eo]),this[is]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[eo]),this[is]=performance.now()}updated(r){super.updated(r),r.has("autoRotate")&&(this[is]=performance.now())}[(e=is,t=Zr,$l)](r){this[Zr]=r[0]}[qe](r,a){if(super[qe](r,a),!this.autoRotate||!this[Nt]()||this[Y].isPresenting)return;const A=Math.min(a,r-this[is]-this.autoRotateDelay);A>0&&(this[x].yaw=this.turntableRotation+this[Zr]*A*.001)}get turntableRotation(){return this[x].yaw}resetTurntableRotation(r=0){this[x].yaw=r}}return s=eo,Xr([k({type:Boolean,attribute:"auto-rotate"})],i.prototype,"autoRotate",void 0),Xr([k({type:Number,attribute:"auto-rotate-delay"})],i.prototype,"autoRotateDelay",void 0),Xr([At({intrinsics:Bm,updateHandler:$l}),k({type:String,attribute:"rotation-per-second"})],i.prototype,"rotationPerSecond",void 0),i};/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wm=Mp(up(ym(Zu(ff(um(Im(Tp(li))))))));customElements.define("model-viewer",wm);export{k as n,$i as s,Dt as u};
